(function(g){var window=this;'use strict';var zzv=function(k){var U=new g.b2("und",new g.AQ("Default","und",!0));U.captionTracks=k.captionTracks;return U},Zi9=function(k){return new g.ws(function(U,D){var b=k.length,N=[];
if(b)for(var H=function(E,I){b--;N[E]=I;b==0&&U(N)},F=function(E){D(E)},p,c=0;c<k.length;c++)p=k[c],g.kk5(p,g.RN(H,c),F);
else U(N)})},LU=function(k){this.Z=k},x1=function(){LU.apply(this,arguments)},aMB=function(){x1.apply(this,arguments)},w$Z=function(){x1.apply(this,arguments)},WBB=function(){x1.apply(this,arguments)},MCZ=function(){x1.apply(this,arguments)},X$c=function(){x1.apply(this,arguments)},dFB=function(){x1.apply(this,arguments)},fMG=function(){LU.apply(this,arguments)},qT6=function(){x1.apply(this,arguments)},tCY=function(){x1.apply(this,arguments)},Oi9=function(){x1.apply(this,arguments)},QUz=function(){x1.apply(this,
arguments)},LBB=function(){x1.apply(this,arguments)},xF9=function(){x1.apply(this,arguments)},Ta9=function(){x1.apply(this,arguments)},ezr=function(){x1.apply(this,arguments)},BaR=function(){x1.apply(this,arguments)},YTB=function(){x1.apply(this,arguments)},JYZ=function(){x1.apply(this,arguments)},u2z=function(){x1.apply(this,arguments)},lMB=function(){LU.apply(this,arguments)},rYI=function(){x1.apply(this,arguments)},STI=function(){x1.apply(this,arguments)},Cb9=function(){x1.apply(this,arguments)},
hzB=function(){x1.apply(this,arguments)},$Fc=function(){x1.apply(this,arguments)},Rzr=function(){x1.apply(this,arguments)},vtL=function(){x1.apply(this,arguments)},yYG=function(){x1.apply(this,arguments)},kGY=function(){x1.apply(this,arguments)},Uz9=function(){LU.apply(this,arguments)},DzG=function(){LU.apply(this,arguments)},bS6=function(){LU.apply(this,arguments)},N6r=function(){x1.apply(this,arguments)},HSL=function(){x1.apply(this,arguments)},gRZ=function(){x1.apply(this,arguments)},FrF=function(){x1.apply(this,
arguments)},AVZ=function(){x1.apply(this,arguments)},p6F=function(){x1.apply(this,arguments)},cVI=function(){x1.apply(this,arguments)},ER6=function(){x1.apply(this,arguments)},IKc=function(){x1.apply(this,arguments)},GG9=function(){x1.apply(this,arguments)},KrZ=function(){x1.apply(this,arguments)},PHB=function(){x1.apply(this,arguments)},sPc=function(){x1.apply(this,arguments)},oR9=function(){x1.apply(this,arguments)},VTL=function(){x1.apply(this,arguments)},mzZ=function(){x1.apply(this,arguments)},
jPL=function(){x1.apply(this,arguments)},nR9=function(){x1.apply(this,arguments)},iSv=function(){x1.apply(this,arguments)},zUY=function(){x1.apply(this,arguments)},ZSZ=function(){x1.apply(this,arguments)},aKB=function(){x1.apply(this,arguments)},w69=function(){x1.apply(this,arguments)},WrY=function(){x1.apply(this,arguments)},MT9=function(){x1.apply(this,arguments)},X6F=function(){LU.apply(this,arguments)},dzv=function(){x1.apply(this,arguments)},fKR=function(){x1.apply(this,arguments)},q$c=function(){x1.apply(this,
arguments)},tTr=function(){x1.apply(this,arguments)},OSr=function(){x1.apply(this,arguments)},QP6=function(){x1.apply(this,arguments)},LrG=function(){x1.apply(this,arguments)},xzI=function(){x1.apply(this,arguments)},T6G=function(){x1.apply(this,arguments)},eUB=function(){x1.apply(this,arguments)},B6Y=function(){x1.apply(this,arguments)},Y$L=function(){x1.apply(this,arguments)},JVr=function(){x1.apply(this,arguments)},u79=function(){x1.apply(this,arguments)},lKI=function(){x1.apply(this,arguments)},
rVr=function(){x1.apply(this,arguments)},S$Y=function(){x1.apply(this,arguments)},CHY=function(){x1.apply(this,arguments)},hUR=function(){x1.apply(this,arguments)},$zc=function(){x1.apply(this,arguments)},RUv=function(){x1.apply(this,arguments)},vRr=function(){x1.apply(this,arguments)},yV9=function(){x1.apply(this,arguments)},kxY=function(){x1.apply(this,arguments)},UK9=function(){x1.apply(this,arguments)},DKB=function(){x1.apply(this,arguments)},bpF=function(){x1.apply(this,arguments)},NBY=function(){x1.apply(this,
arguments)},Hpv=function(){x1.apply(this,arguments)},gM9=function(k){k=k.key||k.id;
if(!k)throw Error("Entity key is missing");return k},FuF=function(){if(TQ)return TQ();
var k={};TQ=g.GT("PersistentEntityStoreDb",{mp:(k.EntityStore={yk:1},k.EntityAssociationStore={yk:2},k),shared:!1,upgrade:function(U,D){D(1)&&g.hw(g.Jw(U,"EntityStore",{keyPath:"key"}),"entityType","entityType");D(2)&&(U=g.Jw(U,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.hw(U,"byParentEntityKey","parentEntityKey"),g.hw(U,"byChildEntityKey","childEntityKey"))},
version:3});return TQ()},ApB=function(k){return g.bp(FuF(),k)},pS6=function(k){return g.bp((0,g.NNr)(),k)},eX=function(k){this.token=k},Bc=function(k,U){U=U===void 0?{}:U;
g.gv.call(this,g.Hjv[k],Object.assign({},{name:"PESEncoderError",type:k},U));this.type=k;this.level="WARNING";Object.setPrototypeOf(this,Bc.prototype)},cp9=function(k){return new Bc("WRONG_DATA_TYPE",{U_:k})},EMF=function(k){return k instanceof Error?new Bc("UNKNOWN_ENCODE_ERROR",{nf:k.message}):new Bc("UNKNOWN_ENCODE_ERROR")},IoZ=function(k){return k instanceof Error?new Bc("UNKNOWN_DECODE_ERROR",{nf:k.message}):new Bc("UNKNOWN_DECODE_ERROR")},Gx9=function(k,U){k=k instanceof Bc?k:U(k);
g.lD(k);throw k;},KuB=function(){},PVr=function(k,U,D){try{return k.j(U,D)}catch(b){Gx9(b,EMF)}},sz6=function(k){k=(new TextEncoder).encode(k).subarray(0,16);
var U=new Uint8Array(16);U.set(k);return U},Y1=function(k){this.Z=k},V86=function(k){var U=oMY[k];
if(U)return U;g.rV(new g.gv("Entity model not found.",{entityType:k}))},mKF=function(k,U){this.Z=k;
this.S=U;this.j={}},nMr=function(k,U){a:{k=jzz(k.S,U.version);
try{var D=k.S(U.data,U.key);break a}catch(b){Gx9(b,IoZ)}D=void 0}return D},Jt=function(k,U,D){return k.Z.objectStore("EntityStore").get(U).then(function(b){if(b){if(D&&b.entityType!==D)throw Error("Incorrect entity type");
return nMr(k,b)}})},ua=function(k,U,D){return D?(D=D.map(function(b){return Jt(k,b,U)}),g.Ls.all(D)):k.Z.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(U)).then(function(b){return b.map(function(N){return nMr(k,N)})})},r4=function(k,U,D){var b=gM9(U),N=jzz(k.S,1),H=Object.assign({},U);
return k.Z.objectStore("EntityStore").get(b).then(function(F){if(F){if(F.entityType!==D)throw Error("Incorrect entity type");H.entityMetadata||(F=nMr(k,F),H.entityMetadata=F.entityMetadata)}}).then(function(){var F={key:b,
entityType:D,data:PVr(N,H,b),version:1};return g.Ls.all([g.rv(k.Z.objectStore("EntityStore"),F),ipI(k,H,D)])}).then(function(){la(k,b,D);
return b})},zTB=function(k,U,D){U=U.map(function(b){return r4(k,b,D)});
return g.Ls.all(U)},SX=function(k,U,D){if(D==null?0:D.UA){var b=new Set;
return Zp9(k,U,b).then(function(){for(var H=[],F=g.z(b),p=F.next();!p.done;p=F.next())H.push(SX(k,p.value));return g.Ls.all(H).then(function(){})})}var N=g.sy(U).entityType;
return g.Ls.all([k.Z.objectStore("EntityStore").delete(U),aoB(k,U)]).then(function(){la(k,U,N)})},wSB=function(k,U){return g.yK(k.Z.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(U)},function(D){return g.Ls.all([D.delete(),
aoB(k,D.cursor.primaryKey)]).then(function(){la(k,D.cursor.primaryKey,U);return g.Rk(D)})})},Wuz=function(k,U,D,b){var N=jzz(k.S,1);
return Jt(k,U,b).then(function(H){if(H){H=g.w8(H,D);var F={key:U,entityType:b,data:PVr(N,H,U),version:1};return g.Ls.all([g.rv(k.Z.objectStore("EntityStore"),F),ipI(k,H,b)])}}).then(function(){la(k,U,b);
return U})},la=function(k,U,D){var b=k.j[D];
b||(b=new Set,k.j[D]=b);b.add(U)},M8r=function(k,U,D){var b=gM9(U);
D=V86(D);if(!D)return g.Ls.resolve([]);D=new D(U);k=k.Z.objectStore("EntityAssociationStore");U=[];D=g.z(D.S());for(var N=D.next();!N.done;N=D.next())U.push(g.rv(k,{parentEntityKey:b,childEntityKey:N.value}));return g.Ls.all(U).then(function(H){return H.map(function(F){return F[1]})})},aoB=function(k,U){return k.Z.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(U))},ipI=function(k,U,D){var b=gM9(U);
return aoB(k,b).then(function(){return M8r(k,U,D)})},Zp9=function(k,U,D){if(D.has(U))return g.Ls.resolve(void 0);
D.add(U);return XSY(k,U).then(function(b){return k.Z.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(U)).then(function(){return b})}).then(function(b){var N=g.Ls.resolve(void 0);
b=g.z(b);for(var H=b.next(),F={};!H.done;F={E9:void 0},H=b.next())F.E9=H.value,N=N.then(function(p){return function(){return Zp9(k,p.E9,D)}}(F));
return N}).then(function(){})},XSY=function(k,U){var D=k.Z.objectStore("EntityAssociationStore");
return D.index("byParentEntityKey").getAll(IDBKeyRange.only(U)).then(function(b){var N=[];b=g.z(b);for(var H=b.next();!H.done;H=b.next())H=H.value,N.push(D.index("byChildEntityKey").getAll(H.childEntityKey));return g.Ls.all(N)}).then(function(b){var N=[];
b=g.z(b);for(var H=b.next();!H.done;H=b.next())H=H.value,H.length===1&&N.push(H[0].childEntityKey);return N})},CU=function(){},dKZ=function(){this.Z={};
this.Z[0]=new CU;if(!g.Os("aes_pes_encoder_killswitch")){var k=this.Z;try{var U=g.Fx();var D=sz6(U);var b=new Y1(new g.qV(D),new g.fV(D))}catch(N){throw k=N instanceof Error?new Bc("KEY_CREATION_FAILED",{nf:N.message}):new Bc("KEY_CREATION_FAILED"),g.lD(k),k;}k[1]=b}},jzz=function(k,U){U=U===void 0?0:U;
k=k.Z[U];if(!k)throw U=new Bc("INVALID_ENCODER_VERSION",{U_:U}),g.lD(U),U;return k},ht=function(k,U){g.B.call(this);
this.token=k;this.Z=U;this.observers=[];k=new g.TY.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.Fx());k.onmessage=this.S.bind(this);this.channel=k},$1=function(k,U,D){var b,N,H,F;
return g.O(function(p){if(p.Z==1)return g.q(p,ApB(k.token),2);if(p.Z!=3)return b=p.S,g.q(p,g.lO(b,["EntityStore","EntityAssociationStore"],U,function(c){N=new mKF(c,k.Z);return D(N)}),3);
H=p.S;N&&(F=N.j,Object.keys(F).length>0&&(k.channel.postMessage(F),fov(k,F)));return p.return(H)})},Ro=function(k,U,D){return $1(k,{mode:"readwrite",
mV:!0},function(b){return r4(b,U,D)})},qqz=function(k,U){return $1(k,{mode:"readwrite",
mV:!0},function(D){return zTB(D,U,"offlineOrchestrationActionWrapperEntity")})},t8Y=function(k,U){return $1(k,{mode:"readwrite",
mV:!0},function(D){return SX(D,U)})},OpR=function(k){return $1(k,{mode:"readwrite",
mV:!0},function(U){return wSB(U,"videoPlaybackPositionEntity")})},vc=function(k,U,D){return $1(k,{mode:"readonly",
mV:!0},function(b){return Jt(b,U,D)})},y2=function(k,U,D){return $1(k,{mode:"readonly",
mV:!0},function(b){return ua(b,U,D)})},fov=function(k,U){k=g.z(k.observers);
for(var D=k.next();!D.done;D=k.next())D=D.value,D(U)},QzG=function(){var k,U,D;
return g.O(function(b){if(b.Z==1)return g.jh(b,2),g.q(b,g.Eg(),4);if(b.Z!=2){k=b.S;if(!k||!g.Aw()||typeof g.TY.BroadcastChannel==="undefined")return b.return();U=new dKZ;return b.return(new ht(k,U))}D=g.zY(b);D instanceof Error&&g.lD(D);return b.return()})},kY=function(){LuG||(LuG=QzG());
return LuG},xKG=function(k){var U;
k=(U=k.options)==null?void 0:U.persistenceOption;return k==="ENTITY_PERSISTENCE_OPTION_PERSIST"||k==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},TB9=function(k){var U;
return g.O(function(D){return D.Z==1?g.q(D,kY(),2):(U=D.S)?g.q(D,$1(U,"readwrite",function(b){for(var N={},H=g.z(k),F=H.next(),p={};!F.done;p={fV:void 0,o2:void 0},F=H.next())p.fV=F.value,p.fV.entityKey&&xKG(p.fV)&&(p.o2=g.MG(p.fV.payload),F=void 0,p.fV.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(F=function(c){return function(){return r4(b,c.fV.payload[c.o2],c.o2)}}(p)),p.fV.type==="ENTITY_MUTATION_TYPE_DELETE"&&(F=function(c){return function(){return SX(b,c.fV.entityKey)}}(p)),p.fV.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(F=function(c){return function(){return Wuz(b,c.fV.entityKey,c.fV.payload[c.o2],c.o2)}}(p)),F&&(N[p.fV.entityKey]=N[p.fV.entityKey]?N[p.fV.entityKey].then(F):F()));
return g.Ls.all(Object.values(N))}),0):D.return()})},eTY=function(k){var U;
return g.O(function(D){if(D.Z==1){U=k.mutations;if(!U||U.length<=0)return D.return();if(g.kT){var b={type:"ENTITY_LOADED"};U!==void 0&&(b.payload=U);g.kT.dispatch(b)}return g.q(D,TB9(U),2)}U.length=0;g.mI(D)})},BB9=function(k){return k!==void 0},YqB=function(k){var U=g.Wh();
U=Object.assign({},U);k=Object.assign({},k);for(var D in U)k[D]?(U[D]!==4&&(U[D]=k[D]),delete k[D]):U[D]!==2&&(U[D]=4);Object.assign(U,k);g.ru9(U);JSON.stringify(U);return U},JpB=function(k){var U,D;
return g.O(function(b){if(b.Z==1)return g.q(b,g.Eg(),2);if(b.Z!=3)return(U=b.S)?g.q(b,g.dG(U),3):b.return();D=b.S;return b.return(g.lO(D,["index","media","captions"],{mode:"readwrite",mV:!0},function(N){var H=IDBKeyRange.bound(k+"|",k+"~");N=[N.objectStore("index").delete(H),N.objectStore("media").delete(H),N.objectStore("captions").delete(H)];return g.Ls.all(N).then(function(){})}))})},urB=function(){var k,U;
return g.O(function(D){if(D.Z==1)return g.q(D,g.Eg(),2);if(D.Z!=3){k=D.S;if(!k)throw g.OS("rvdfd");return g.q(D,g.dG(k),3)}U=D.S;return D.return(g.lO(U,["index","media"],{mode:"readwrite",mV:!0},function(b){var N={};return g.$9(b.objectStore("index"),{},function(H){var F=H.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),p=g.Ls.resolve(void 0);if(F){var c=F[1];F=F[2];N[c]=N[c]||{};var E;N[c][F]=g.R3Y((E=H.getValue())==null?void 0:E.fmts)}else p=H.delete().then(function(){});
return g.Ls.all([g.Rk(H),p]).then(function(I){return g.z(I).next().value})}).then(function(){for(var H={},F=g.z(Object.keys(N)),p=F.next();!p.done;p=F.next()){p=p.value;
var c=N[p].v;H[p]=N[p].a&&c?1:2}var E=YqB(H);return g.fg9(b.objectStore("media"),{},function(I){var G=I.cursor.key.match(g.U29);G&&H[G[1]]||b.objectStore("media").delete(I.cursor.key);return g.iC0(I)}).then(function(){return E})})}))})},loB=function(k,U){var D,b;
return g.O(function(N){if(N.Z==1)return g.q(N,g.Eg(),2);if(N.Z!=3){D=N.S;if(!D)throw g.OS("wct");return g.q(N,g.dG(D),3)}b=N.S;return g.q(N,g.lO(b,["captions"],{mode:"readwrite",mV:!0},function(H){var F=[];H=H.objectStore("captions");for(var p=0;p<U.length;p++){var c=g.rv(H,U[p],k+"|"+U[p].metadata.vss_id);F.push(c)}return g.Ls.all(F)}),0)})},rp9=function(k){var U,D,b;
return g.O(function(N){if(N.Z==1)return U=IDBKeyRange.bound(k+"|",k+"~"),g.q(N,g.Eg(),2);if(N.Z!=3){D=N.S;if(!D)throw g.OS("gactfv");return g.q(N,g.dG(D),3)}b=N.S;return N.return(b.getAll("captions",U))})},SqF=function(k){return g.O(function(U){g.XM(k,0);
return U.return(JpB(k))})},CVz=function(k){return{context:g.VF(),
videoIds:k}},hT6=function(k){return{context:g.VF(),
playlistIds:k}},$Kc=function(k){return{context:g.VF(),
offlinePlaylistSyncChecks:k}},RTY=function(){this.Z=new Map},ypZ=function(){vM6||(vM6=new RTY);
return vM6},kC9=function(k,U){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:k},metadata:U,statusCode:void 0,csn:void 0,can:void 0}},UPz=function(k,U,D){if(!D){var b=b===void 0?!1:b;
D=k.Z.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!D||b)D=g.Oe(16),k.Z.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",D)}k={flowNonce:D,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:U.eventType};U.metadata&&(k.flowMetadata=U.metadata);U.statusCode!==void 0&&(k.flowEventStatus=U.statusCode);U.csn&&(k.csn=U.csn);U.can&&(k.can=U.can);g.iO("flowEvent",k,void 0)},DPG=function(k){var U,D,b,N,H,F,p,c,E,I,G,K,P,V,Z,w,M,d,t,L,e,l,C,N9,Fv,kU,u,R,n,r,yW,n9,Ur,W9,$U,b9,sr,W,X,f;
return g.O(function(Q){if(Q.Z==1)return g.q(Q,$1(k,{mode:"readonly",mV:!0},function(T){return ua(T,"playbackData").then(function(Dh){var H9=Dh.map(function(s5){return s5.transfer}).filter(function(s5){return!!s5}),g0=Dh.map(function(s5){return s5.offlineVideoPolicy}).filter(function(s5){return!!s5}),x=Dh.filter(function(s5){return!!s5.key}).map(function(s5){return g.oY(g.sy(s5.key).entityId,"downloadStatusEntity")});
H9=ua(T,"transfer",H9);g0=ua(T,"offlineVideoPolicy",g0);x=ua(T,"downloadStatusEntity",x);var E5=H9.then(function(s5){s5=s5.reduce(function(pY,fY){(fY==null?0:fY.offlineVideoStreams)&&pY.push.apply(pY,g.a(fY.offlineVideoStreams));return pY},[]).filter(function(pY){return!!pY});
return ua(T,"offlineVideoStreams",s5)});
return g.Ls.all([H9,g0,E5,x]).then(function(s5){var pY=g.z(s5);s5=pY.next().value;var fY=pY.next().value;var GZ=pY.next().value;pY=pY.next().value;return[Dh,s5,fY,GZ,pY]})})}),2);
if(Q.Z!=3)return U=Q.S,g.q(Q,$1(k,{mode:"readonly",mV:!0},function(T){return ua(T,"mainDownloadsListEntity").then(function(Dh){var H9,g0;return(g0=(H9=Dh[0])==null?void 0:H9.downloads)!=null?g0:[]})}),3);
D=Q.S;b=g.z(U);N=b.next().value;H=b.next().value;F=b.next().value;p=b.next().value;c=b.next().value;E=N;I=H;G=F;K=p;P=c;V={};Z={};w={};M={};d={};t=[];L=g.z(I);for(e=L.next();!e.done;e=L.next())(l=e.value)&&(V[l.key]=l);C=g.z(G);for(N9=C.next();!N9.done;N9=C.next())(Fv=N9.value)&&(Z[Fv.key]=Fv);kU=g.z(P);for(u=kU.next();!u.done;u=kU.next())(R=u.value)&&(w[R.key]=R);n=g.z(K);for(r=n.next();!r.done;r=n.next())(yW=r.value)&&(M[yW.key]=yW);n9=g.z(D);for(Ur=n9.next();!Ur.done;Ur=n9.next())W9=Ur.value,$U=
void 0,d[($U=W9.videoItem)!=null?$U:""]=!0,W9.videoItem&&(sr=b9=void 0,W=(sr=(b9=g.sy(W9.videoItem))==null?void 0:b9.entityId)!=null?sr:"",t.push({externalVideoId:W}));X=E.filter(function(T){if(!T||!T.key||!T.offlineVideoPolicy)return!1;T=g.sy(T.key).entityId;T=g.oY(T,"downloadStatusEntity");var Dh;return!(T&&((Dh=w[T])==null?void 0:Dh.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
f=X.map(function(T){var Dh=V[T.transfer],H9=[];if(Dh==null?0:Dh.offlineVideoStreams)for(var g0=g.z(Dh.offlineVideoStreams),x=g0.next();!x.done;x=g0.next())(x=M[x.value])&&H9.push(x);g0=Z[T.offlineVideoPolicy];x=d;var E5=T==null?void 0:T.playerResponseTimestamp,s5=g.sy(g0.key).entityId;T=g.oY(s5,"mainVideoEntity");if(g0.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var pY="OFFLINE_VIDEO_STATE_DISABLED";g0.expirationTimestamp&&Number(g0.expirationTimestamp)<Date.now()/1E3&&(pY="OFFLINE_VIDEO_STATE_EXPIRED")}else if(g0.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")pY="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Dh==null?void 0:Dh.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":pY="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":pY="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":pY="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":pY="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":pY="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":pY="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:pY="OFFLINE_VIDEO_STATE_UNKNOWN"}if(pY==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Dh==null?void 0:Dh.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":pY="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":pY="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":pY=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}s5={id:s5,videoState:pY};if(Dh==null?0:Dh.cotn)s5.cotn=Dh.cotn;if(Dh==null?0:Dh.maximumDownloadQuality)s5.selectedVideoQuality=Dh==null?void 0:Dh.maximumDownloadQuality;if(Dh==null?0:Dh.lastProgressTimeMs)s5.lastProgressTimeMs=Dh.lastProgressTimeMs;E5&&(s5.playerResponseSavedTimeMs=String(Number(E5)*1E3));Dh=String;E5=0;H9=g.z(H9);for(pY=H9.next();!pY.done;pY=H9.next())if(pY=pY.value,pY.streamsProgress){pY=g.z(pY.streamsProgress);for(var fY=pY.next();!fY.done;fY=
pY.next()){var GZ=void 0;E5+=Number((GZ=fY.value.numBytesDownloaded)!=null?GZ:0)}}s5.downloadedBytes=Dh(E5);s5.selectedOfflineMode=x[T]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";g0.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(s5.offlinePlaybackDisabledReason=g0.offlinePlaybackDisabledReason);return s5});
return Q.return({offlineVideos:f,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:t}}})})},b6z=function(){this.locks=navigator.locks},Nfv=function(){try{var k=g.B9("ytglobal.locks_");
if(k)return k;var U;if(U=navigator){var D=navigator;U="locks"in D&&!!D.locks}if(U)return g.TY.localStorage&&g.TY.localStorage.getItem("noop"),k=new b6z,g.eh("ytglobal.locks_",k),k}catch(b){}},U0=function(){},H69=function(){},gjG=function(k){if(k.includes(":"))throw Error("Invalid user cache name: "+k);
return k+":"+g.Fx("CacheStorage get")},Fo9=function(){return g.O(function(k){if(DN!==void 0)return k.return(DN);
DN=new Promise(function(U){var D;return g.O(function(b){switch(b.Z){case 1:return g.jh(b,2),g.q(b,b7.open("test-only"),4);case 4:return g.q(b,b7.delete("test-only"),5);case 5:g.io(b,3);break;case 2:if(D=g.zY(b),D instanceof Error&&D.name==="SecurityError")return U(!1),b.return();case 3:U("caches"in window),g.mI(b)}})});
return k.return(DN)})},psI=function(){return g.O(function(k){if(k.Z==1)return g.q(k,Fo9(),2);
if(!k.S)return k.return(void 0);Af6||(Af6=new H69);return k.return(Af6)})},ND=function(k,U,D){g.rV(new g.gv("Woffle: "+k,D?{cotn:D}:""));
U instanceof Error&&g.rV(U)},cfL=function(k){var U;
return g.O(function(D){if(D.Z==1)return g.q(D,DPG(k),2);U=D.S;g.iO("offlineStateSnapshot",U);g.mI(D)})},H_=function(k){g.B.call(this);
var U=this;this.api=k;this.dg={vmQ:function(){return U.Z},
uOr:function(){return U.S}};
typeof g.TY.BroadcastChannel!=="undefined"&&(this.Z=new g.TY.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.Fx()),this.Z.onmessage=this.j.bind(this),this.S=new g.TY.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.Fx()),this.S.onmessage=this.W.bind(this))},gM=function(k,U){k.api.f2("onOfflineOperationFailure",U);
var D;(D=k.Z)==null||D.postMessage(U)},Ejz=function(k,U,D,b){var N=this;
this.V=k;this.D=U;this.visibility=D;this.U=b;this.K=this.B=this.N=this.j=this.Z=!1;this.W=new g.Ec(function(){N.EV()});
this.dg={Yy:function(){return N.S},
EV:function(){N.EV()},
G2N:function(){return N.W}};
this.visibility.subscribe("visibilitystatechange",function(){N.Za()})},I7c=function(k){if(!k.j&&!k.Z){var U=Nfv();
if(U){k.j=!0;var D=g.Fx("OfflineLockManager");U.request("woffle_orchestration_leader:"+D,{},function(){var b,N,H,F;return g.O(function(p){switch(p.Z){case 1:return g.jh(p,2),k.S=new g.MF,k.Z=!0,k.j=!1,g.q(p,k.V(),4);case 4:return g.q(p,k.S.promise,5);case 5:g.io(p,0);break;case 2:b=g.zY(p),((H=(N=k).U)==null?0:H.call(N,"wo_relinquish_leadership_on_lock_request_error"))||k.EV(),b instanceof Error&&(F=b,F.args=[{name:"WoLockManagerError",WO:b.name}],g.lD(F)),g.mI(p)}})})}}},GCc=function(k){k.Z&&(k.K=
!0,FA(k))},KoB=function(k,U){k.Z&&(k.N=U,FA(k))},P66=function(k,U){k.Z&&(k.B=U,FA(k))},FA=function(k){k.B&&k.N&&k.K&&k.visibility.isBackground()?g.IB(k.W,6E4):k.W.stop()},AO=function(k){var U;
k.offlineDeleteReason=(U=k.offlineDeleteReason)!=null?U:"OFFLINE_DELETE_REASON_UNKNOWN";var D;k.offlineModeType=(D=k.offlineModeType)!=null?D:"OFFLINE_NOW";g.iO("offlineDeleteEvent",k)},pu=function(k,U){var D=U.videoId;
var b=U.dT;U=U.offlineModeType;k.encryptedVideoId=D;k.cotn=b==null?void 0:b.cotn;k.offlineabilityFormatType=b==null?void 0:b.maximumDownloadQuality;var N;k.isRefresh=(N=b==null?void 0:b.isRefresh)!=null?N:!1;var H;k.softErrorCount=(H=b==null?void 0:b.transferRetryCount)!=null?H:0;k.offlineModeType=U!=null?U:"OFFLINE_NOW";(k.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&k.statusType==="UNKNOWN_STATUS_TYPE"||!k.transferStatusType&&!k.statusType)&&g.rV(Error("Woffle unknown transfer status"));
g.iO("offlineTransferStatusChanged",k)},sDv=function(k,U,D,b){b={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!b};U&&D&&(U=Math.floor(U/1024).toFixed(),D=Math.floor(D/1024).toFixed(),b.alreadyDownloadedKbytes=U,b.totalFetchedKbytes=U,b.totalContentKbytes=D);pu(b,k)},ojr=function(k){pu({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},k)},Vo6=function(k){switch(k){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
c_=function(k){var U,D,b;
return((b=(U=k.actionMetadata)==null?void 0:(D=U.retryScheduleIntervalsInSeconds)==null?void 0:D.length)!=null?b:0)>0},E0=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!k.entityKey},I3=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!k.entityKey},Gg=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!k.entityKey},mPc=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!k.entityKey},
Ku=function(k,U,D,b,N){N=N===void 0?!1:N;
var H,F,p,c,E,I;return g.O(function(G){if(G.Z==1)return H=g.oY(k,U),F=g.oY(k,"downloadStatusEntity"),g.q(G,$1(D,{mode:"readonly",mV:!0},function(K){return g.Ls.all([Jt(K,H,U),Jt(K,F,"downloadStatusEntity")])}),2);
p=G.S;c=p.length?p[0]:void 0;if(!c)return G.Xt(0);E=jDc;if(I=p.length>1?p[1]:void 0){if(I.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!N)return G.return();I.downloadState=b}else I={key:F,downloadState:b};g.RR(c,E,I);return g.q(G,$1(D,{mode:"readwrite",mV:!0},function(K){return g.Ls.all([r4(K,c,U),r4(K,I,"downloadStatusEntity")])}),0)})},P_=function(k,U){return k.actionType===U.actionType&&k.entityKey===U.entityKey},s0=function(k,U){if(k&&k.transferState!=="TRANSFER_STATE_COMPLETE"&&k.transferState!==
"TRANSFER_STATE_FAILED"){var D=g.sy(k.key).entityId;
pu({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:D,dT:k,offlineModeType:U})}},o3=function(k){if(!k||!k.thumbnails)return[];
var U=[];k=g.z(k.thumbnails);for(var D=k.next();!D.done;D=k.next())D=D.value,D.url&&U.push(D.url);return U},njG=function(k,U,D){D=D===void 0?[]:D;
var b,N,H,F,p,c,E,I,G,K,P,V,Z;return g.O(function(w){if(w.Z==1)return D.length?g.q(w,y2(k,U),2):w.return([]);b=w.S;N=new Set;H=g.z(b);for(F=H.next();!F.done;F=H.next())if(p=F.value,c=p.id||p.key)E=g.sy(c).entityId,N.add(E);I=[];G=g.z(D);for(K=G.next();!K.done;K=G.next())P=K.value,V=P.offlineVideoData,Z=void 0,((Z=V)==null?0:Z.videoId)&&!N.has(V.videoId)&&I.push(P);return w.return(I)})},i6Y=function(k,U,D){return new g.JM(k,{cotn:U,
raw_player_response:D,download_media:!0,start:Infinity,disable_watch_next:!0})},zfv=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},V$=function(k,U,D,b,N,H,F,p,c,E,I){this.entityType=k;
this.actionId=U;this.action=D;this.parentActionId=b;this.rootActionId=N===void 0?U:N;this.childActionIds=H;this.prereqActionId=F;this.postreqActionIds=p;this.hasChildActionFailed=E;this.retryScheduleIndex=0;this.Z=I||Date.now();this.retryScheduleIndex=c||0},m1=function(k){if(!k.key)throw Error("Entity key is required.");
if(!k.actionProto)throw Error("OfflineOrchestrationAction is required.");var U=g.sy(k.key),D=g.sy(k.actionProto.entityKey);return new V$(D.entityType,U.entityId,k.actionProto,k.parentActionId,k.rootActionId,k.childActionIds,k.prereqActionId,k.postreqActionIds,k.retryScheduleIndex,k.hasChildActionFailed,Number(k.enqueueTimeSec)*1E3)},jv=function(k){return{key:g.oY(k.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:k.action,parentActionId:k.parentActionId,rootActionId:k.rootActionId,childActionIds:k.childActionIds,prereqActionId:k.prereqActionId,postreqActionIds:k.postreqActionIds,retryScheduleIndex:k.retryScheduleIndex,hasChildActionFailed:k.hasChildActionFailed,enqueueTimeSec:(k.Z/1E3).toFixed()}},Z6B=function(){var k;
return g.O(function(U){return U.Z==1?g.q(U,psI(),2):(k=U.S)?U.return(k.delete("yt-player-local-img")):U.return(!0)})},nu=function(k){var U,D;
return g.O(function(b){if(b.Z==1)return g.q(b,psI(),2);if(b.Z!=3){U=b.S;if(!U)throw Error("Cache API not supported");return k.length?g.q(b,U.open("yt-player-local-img"),3):b.return()}D=b.S;return g.q(b,Promise.all(k.map(function(N){return D.delete(N)})),0)})},i7=function(k){var U,D;
return g.O(function(b){if(b.Z==1)return g.q(b,psI(),2);if(b.Z!=3){U=b.S;if(!U)throw Error("Cache API not supported");return k.length?g.q(b,U.open("yt-player-local-img"),3):b.return()}D=b.S;return g.q(b,D.addAll(k),0)})},zg=function(k,U,D,b,N){var H,F,p,c,E,I,G,K,P,V,Z,w,M,d,t,L,e,l,C,N9,Fv,kU,u,R,n,r,yW,n9,Ur,W9,$U;
return g.O(function(b9){switch(b9.Z){case 1:return H=g.oY(k,"mainVideoEntity"),F=g.oY(k,"ytMainChannelEntity"),p=g.oY(k,"transfer"),c=g.oY(k,"videoDownloadContextEntity"),g.q(b9,$1(U,{mode:"readonly",mV:!0},function(sr){return g.Ls.all([Jt(sr,H,"mainVideoEntity"),Jt(sr,F,"ytMainChannelEntity"),Jt(sr,p,"transfer"),Jt(sr,c,"videoDownloadContextEntity"),ua(sr,"ytMainChannelEntity"),ua(sr,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:E=b9.S;I=g.z(E);G=I.next().value;K=I.next().value;P=I.next().value;V=I.next().value;Z=I.next().value;w=I.next().value;M=G;d=K;t=P;L=V;e=Z;l=w;if(!M&&!d){b9.Xt(3);break}C=M?o3(M.thumbnail):[];if(!d){N9=[];b9.Xt(4);break}return g.q(b9,a79(d,e),5);case 5:N9=b9.S;case 4:return Fv=N9,g.q(b9,nu(C.concat(Fv)),3);case 3:kU=[];u=g.oY(k,"downloadStatusEntity");R=g.z(l);for(n=R.next();!n.done;n=R.next())r=n.value,yW=g.sy(r.key).entityId,n9=m1(r),Ur=g.sy(n9.action.entityKey).entityId,yW!==k&&Ur!==k||P_(D,
r.actionProto)||kU.push(r.key);return g.q(b9,$1(U,{mode:"readwrite",mV:!0},function(sr){var W=kU.map(function(X){return SX(sr,X)});
W.push(SX(sr,H,{UA:!0}));W.push(SX(sr,u,{UA:!0}));return g.Ls.all(W)}),7);
case 7:$U=(W9=L)==null?void 0:W9.offlineModeType,N&&(AO(N),N.offlineModeType&&($U=N.offlineModeType)),s0(t,$U),gM(b,{entityKey:H,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.mI(b9)}})},MoF=function(k,U,D,b){var N,H,F,p,c,E,I,G,K,P,V,Z,w,M,d,t,L,e,l,C,N9,Fv,kU,u,R,n,r,yW,n9,Ur,W9,$U,b9,sr,W,X,f,Q,T,Dh,H9,g0,x,E5,s5,pY,fY,GZ,Bz,GW;
return g.O(function(lo){switch(lo.Z){case 1:return N=g.oY(k,"mainPlaylistEntity"),H=g.oY(k,"ytMainChannelEntity"),g.q(lo,$1(U,{mode:"readonly",mV:!0},function(TW){return g.Ls.all([Jt(TW,N,"mainPlaylistEntity"),Jt(TW,H,"ytMainChannelEntity"),ua(TW,"mainPlaylistEntity"),ua(TW,"mainDownloadsListEntity"),ua(TW,"ytMainChannelEntity"),ua(TW,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:F=lo.S;p=g.z(F);c=p.next().value;E=p.next().value;I=p.next().value;G=p.next().value;K=p.next().value;P=p.next().value;V=c;Z=E;w=I;M=G;d=K;t=P;if(!V&&!Z){lo.Xt(3);break}L=V?wsv(V):[];if(!Z){e=[];lo.Xt(4);break}return g.q(lo,a79(Z,d),5);case 5:e=lo.S;case 4:return l=e,g.q(lo,nu(L.concat(l)),3);case 3:C=[];N9=new Map;if(!V){lo.Xt(7);break}return g.q(lo,WoY(V,w,M),8);case 8:C=lo.S;Fv=g.z(C);for(kU=Fv.next();!kU.done;kU=Fv.next())u=kU.value,N9.set(u,{videoId:u,playlistId:k,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.q(lo,$1(U,{mode:"readonly",mV:!0},function(TW){return g.Ls.all([ua(TW,"transfer"),ua(TW,"videoDownloadContextEntity")])}),9);
case 9:R=lo.S;n=g.z(R);r=n.next().value;yW=n.next().value;n9=r;Ur=yW;W9=g.z(n9);for($U=W9.next();!$U.done;$U=W9.next())b9=$U.value,sr=g.sy(b9.key).entityId,(W=N9.get(sr))&&b9&&(W.cotn=b9.cotn);X=g.z(Ur);for(f=X.next();!f.done;f=X.next())Q=f.value,T=g.sy(Q.key).entityId,(Dh=N9.get(T))&&Q&&(Dh.offlineModeType=Q.offlineModeType);case 7:H9=[];g0=g.z(t);for(x=g0.next();!x.done;x=g0.next())E5=x.value,s5=g.sy(E5.key).entityId,pY=m1(E5),s5!==k&&pY.rootActionId!==k||P_(D,E5.actionProto)||H9.push(E5.key);fY=
g.oY(k,"mainPlaylistEntity");return g.q(lo,$1(U,{mode:"readwrite",mV:!0},function(TW){var EV=H9.map(function(tr){return SX(TW,tr)});
EV.push(SX(TW,fY,{UA:!0}));return g.Ls.all(EV)}),10);
case 10:if(!V){lo.Xt(0);break}C.reverse();if(!C){lo.Xt(0);break}GZ=g.z(C);Bz=GZ.next();case 13:if(Bz.done){lo.Xt(0);break}GW=Bz.value;return g.q(lo,zg(GW,U,D,b,N9.get(GW)),14);case 14:Bz=GZ.next(),lo.Xt(13)}})},dP9=function(k,U,D,b){var N,H,F,p,c,E,I,G,K;
return g.O(function(P){if(P.Z==1)return N=g.oY("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),H=new Map,g.q(P,$1(k,{mode:"readwrite",mV:!0},function(V){var Z=ua(V,"transfer"),w=ua(V,"offlineOrchestrationActionWrapperEntity"),M=ua(V,"videoDownloadContextEntity"),d=Jt(V,N,"mainDownloadsListEntity");return g.Ls.all([Z,w,M,d]).then(function(t){t=g.z(t);var L=t.next().value;var e=t.next().value;var l=t.next().value;var C=t.next().value;t=XsR.map(function(Fv){return wSB(V,Fv)});
e=g.z(e);for(var N9=e.next();!N9.done;N9=e.next())N9=N9.value,P_(U,N9.actionProto)||t.push(SX(V,N9.key,{UA:!0}));C&&(C.downloads=[],t.push(r4(V,C,"mainDownloadsListEntity")));if(l)for(l=g.z(l),C=l.next();!C.done;C=l.next())C=C.value,e=g.sy(C.key).entityId,e=g.oY(e,"transfer"),H.set(e,C.offlineModeType);return g.Ls.all(t).then(function(){return L})})}),2);
F=P.S;p=g.z(F);for(c=p.next();!c.done;c=p.next())E=c.value,s0(E,H.get(E.key)),I=g.sy(E.key).entityId,G={videoId:I,offlineDeleteReason:b,cotn:E.cotn,offlineModeType:H.get(E.key)},AO(G),K=g.oY(I,"mainVideoEntity"),gM(D,{entityKey:K,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.q(P,Z6B(),0)})},wsv=function(k,U){var D=[];
if(k.thumbnailStyleData){k=g.z(k.thumbnailStyleData);for(var b=k.next();!b.done;b=k.next()){var N=void 0,H=void 0,F=void 0;D=D.concat(o3((N=b.value)==null?void 0:(H=N.value)==null?void 0:(F=H.collageThumbnail)==null?void 0:F.coverThumbnail))}}U=o3(U);return D.concat(U)},WoY=function(k,U,D){var b,N,H,F,p,c,E,I,G,K,P,V,Z,w,M,d,t,L,e,l,C,N9,Fv;
return g.O(function(kU){b=[];N=new Set;if(D.length)for(H=g.z(D),F=H.next();!F.done;F=H.next())if(p=F.value,c=void 0,(c=p.downloads)==null?0:c.length)for(E=g.z(p.downloads),I=E.next();!I.done;I=E.next())G=I.value,G.videoItem&&(K=g.sy(G.videoItem).entityId,N.add(K));if(k.videos){P=g.z(k.videos);for(V=P.next();!V.done;V=P.next())Z=V.value,w=JSON.parse(g.sy(Z).entityId),w.videoId&&!N.has(w.videoId)&&b.push(w.videoId);M=g.z(U);for(d=M.next();!d.done;d=M.next())if(t=d.value,t.key!==k.key&&(L=t.videos))for(e=
g.z(L),l=e.next();!l.done;l=e.next())C=l.value,N9=JSON.parse(g.sy(C).entityId),N9.videoId&&(Fv=b.indexOf(N9.videoId),Fv!==-1&&b.splice(Fv,1))}return kU.return(b)})},a79=function(k,U){var D,b,N,H,F,p,c,E;
return g.O(function(I){D=o3(k.avatar);b=g.z(U);for(N=b.next();!N.done;N=b.next())if(H=N.value,H.id!==k.id)for(F=g.z(o3(H.avatar)),p=F.next();!p.done;p=F.next())c=p.value,E=D.indexOf(c),E!==-1&&D.splice(E,1);return I.return(D)})},f79=function(k){var U;
return g.O(function(D){U=g.J(k.frameworkUpdates,ZN);return k.frameworkUpdates&&U?g.q(D,eTY(U),0):D.return()})},toz=function(k){var U;
if((U=k.onResponseReceivedActions)!=null&&U.length){var D;k=(D=g.J(g.J(k.onResponseReceivedActions[0],q9G),g.kWG))==null?void 0:D.actions;if(k!=null&&k.length)return k}},O69=function(k){var U,D,b;
return g.O(function(N){if(N.Z==1)return k?g.q(N,vc(k,g.Q7,"mainDownloadsListEntity"),2):N.return([]);U=N.S;return((D=U)==null?0:(b=D.downloads)==null?0:b.length)?N.return(U.downloads.map(function(H){var F;return(F=H.videoItem)!=null?F:""})):N.return([])})},Lo6=function(k,U){var D;
return g.O(function(b){return b.Z==1?g.q(b,QD6(k,U),2):(D=b.S)?g.q(b,$1(k,{mode:"readwrite",mV:!0},function(N){var H=[r4(N,D.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];D.mainDownloadsListEntity&&H.push(r4(N,D.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.Ls.all(H)}),0):b.Xt(0)})},QD6=function(k,U){var D,b,N,H,F,p,c,E,I,G,K,P,V,Z,w,M,d,t;
return g.O(function(L){if(L.Z==1)return D=g.oY("main_downloads_library_id","mainDownloadsLibraryEntity"),b=g.oY("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.q(L,$1(k,{mode:"readonly",mV:!0},function(e){return g.Ls.all([Jt(e,D,"mainDownloadsLibraryEntity"),Jt(e,b,"mainDownloadsListEntity")])}),2);
N=L.S;H=g.z(N);F=H.next().value;p=H.next().value;c=F;E=p;c||(c={id:D});I=g.z(U);for(G=I.next();!G.done;G=I.next())if(K=G.value,K===g.Q7){if(c.smartDownloadsList)return L.return();c.smartDownloadsList=K}else if(P=g.sy(K).entityType,V={},P==="mainPlaylistEntity"?V.playlistItem=K:P==="mainVideoEntity"&&(V.videoItem=K),!g.Oz(V)){Z=void 0;if((Z=E)==null?0:Z.downloads){w=!1;M=g.z(E.downloads);for(d=M.next();!d.done;d=M.next())if(t=d.value,t.playlistItem===K||t.videoItem===K){w=!0;break}w||E.downloads.push(V)}else E=
{id:b,downloads:[V]};c.downloadsList=b}return L.return({mainDownloadsLibraryEntity:c,mainDownloadsListEntity:E})})},xPc=function(k,U){var D,b,N,H,F,p,c,E,I,G,K,P,V,Z,w;
return g.O(function(M){if(M.Z==1)return D=g.oY("main_downloads_library_id","mainDownloadsLibraryEntity"),b=g.oY("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.q(M,$1(k,{mode:"readonly",mV:!0},function(d){return g.Ls.all([Jt(d,D,"mainDownloadsLibraryEntity"),Jt(d,b,"mainDownloadsListEntity"),Jt(d,g.Q7,"mainDownloadsListEntity")])}),2);
N=M.S;H=g.z(N);F=H.next().value;p=H.next().value;c=H.next().value;E=F;I=p;G=c;if(!E)return M.Xt(0);if(U===g.Q7&&((K=G)==null?0:K.downloads))G.downloads=[];else if((P=I)==null?0:P.downloads)for(V=g.sy(U).entityType,Z=0;Z<I.downloads.length;Z++)if(w=I.downloads[Z],V==="mainVideoEntity"&&w.videoItem===U){I.downloads.splice(Z,1);break}else if(V==="mainPlaylistEntity"&&w.playlistItem===U){I.downloads.splice(Z,1);break}return g.q(M,$1(k,{mode:"readwrite",mV:!0},function(d){var t=[r4(d,E,"mainDownloadsLibraryEntity")];
I&&t.push(r4(d,I,"mainDownloadsListEntity"));G&&t.push(r4(d,G,"mainDownloadsListEntity"));return g.Ls.all(t)}),0)})},a3=function(k,U){var D,b,N,H,F,p,c,E,I,G,K;
return g.O(function(P){if(P.Z==1)return D=g.oY(U,"transfer"),b=g.oY(U,"videoDownloadContextEntity"),g.q(P,$1(k,{mode:"readonly",mV:!0},function(V){return g.Ls.all([Jt(V,D,"transfer"),Jt(V,b,"videoDownloadContextEntity")])}),2);
N=P.S;H=g.z(N);F=H.next().value;p=H.next().value;c=F;E=p;K={videoId:U,cotn:(I=c)==null?void 0:I.cotn,offlineModeType:(G=E)==null?void 0:G.offlineModeType};return P.return(K)})},wM=function(k,U,D,b,N){var H,F,p,c,E,I,G,K,P,V,Z,w,M,d,t,L,e,l,C,N9;
return g.O(function(Fv){switch(Fv.Z){case 1:return H=g.oY(k,"musicTrack"),F=g.oY(k,"transfer"),g.q(Fv,$1(U,{mode:"readonly",mV:!0},function(kU){return g.Ls.all([Jt(kU,H,"musicTrack"),Jt(kU,F,"transfer"),ua(kU,"musicTrack"),ua(kU,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:p=Fv.S;c=g.z(p);E=c.next().value;I=c.next().value;G=c.next().value;K=c.next().value;P=E;V=I;Z=G;w=K;if(!P){Fv.Xt(3);break}return g.q(Fv,TfL(P,Z),4);case 4:return M=Fv.S,g.q(Fv,nu(M),3);case 3:d=[];t=g.z(w);for(L=t.next();!L.done;L=t.next())e=L.value,l=g.sy(e.key).entityId,C=m1(e),N9=g.sy(C.action.entityKey).entityId,l!==k&&N9!==k||P_(D,e.actionProto)||d.push(e.key);return g.q(Fv,$1(U,{mode:"readwrite",mV:!0},function(kU){var u=d.map(function(R){return SX(kU,R)});
u.push(SX(kU,H,{UA:!0}));return g.Ls.all(u)}),6);
case 6:s0(V),N&&AO(N),gM(b,{entityKey:H,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.mI(Fv)}})},W_=function(k,U,D,b,N){var H,F,p,c,E,I,G,K,P,V,Z,w,M,d,t,L,e,l,C,N9,Fv,kU,u,R,n,r,yW,n9,Ur,W9,$U,b9,sr,W,X,f;
return g.O(function(Q){switch(Q.Z){case 1:return H=g.oY(k,U),F=g.oY("music_downloads_library_id","musicDownloadsLibraryEntity"),g.q(Q,$1(D,{mode:"readonly",mV:!0},function(T){return g.Ls.all([Jt(T,H,U),Jt(T,F,"musicDownloadsLibraryEntity"),ua(T,U),ua(T,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:p=Q.S;c=g.z(p);E=c.next().value;I=c.next().value;G=c.next().value;K=c.next().value;P=E;V=I;Z=G;w=K;if(!P){Q.Xt(3);break}return g.q(Q,TfL(P,Z),4);case 4:return M=Q.S,g.q(Q,nu(M),3);case 3:d=[];t=new Map;if(!P){Q.Xt(6);break}return g.q(Q,efv(P,Z,V),7);case 7:d=Q.S;L=g.z(d);for(e=L.next();!e.done;e=L.next())l=e.value,C=g.sy(l).entityId,t.set(C,{videoId:C,playlistId:k,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.q(Q,y2(D,"transfer"),8);case 8:for(N9=Q.S,Fv=g.z(N9),
kU=Fv.next();!kU.done;kU=Fv.next())u=kU.value,R=g.sy(u.key).entityId,(n=t.get(R))&&u&&(n.cotn=u.cotn);case 6:r=[];yW=g.z(w);for(n9=yW.next();!n9.done;n9=yW.next())Ur=n9.value,W9=g.sy(Ur.key).entityId,$U=m1(Ur),W9!==k&&$U.rootActionId!==k||P_(b,Ur.actionProto)||r.push(Ur.key);b9=g.oY(k,U);return g.q(Q,$1(D,{mode:"readwrite",mV:!0},function(T){var Dh=r.map(function(H9){return SX(T,H9)});
Dh.push(SX(T,b9,{UA:!0}));return g.Ls.all(Dh)}),9);
case 9:if(!P){Q.Xt(0);break}d.reverse();if(!d.length){Q.Xt(0);break}sr=g.z(d);W=sr.next();case 12:if(W.done){Q.Xt(0);break}X=W.value;f=g.sy(X).entityId;if(!f){Q.Xt(13);break}return g.q(Q,wM(f,D,b,N,t.get(f)),13);case 13:W=sr.next(),Q.Xt(12)}})},MD=function(k,U,D){var b,N,H,F,p,c,E;
return g.O(function(I){if(I.Z==1)return g.q(I,$1(k,{mode:"readwrite",mV:!0},function(G){var K=ua(G,"transfer"),P=ua(G,"offlineOrchestrationActionWrapperEntity");return g.Ls.all([K,P]).then(function(V){V=g.z(V);var Z=V.next().value;var w=V.next().value;V=Bfc.map(function(L){return wSB(G,L)});
w=g.z(w);for(var M=w.next();!M.done;M=w.next()){M=M.value;var d=g.sy(M.actionProto.entityKey).entityType==="musicTrack",t=M.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";P_(U,M.actionProto)||d&&(!d||t)||V.push(SX(G,M.key,{UA:!0}))}return g.Ls.all(V).then(function(){return Z})})}),2);
b=I.S;N=g.z(b);for(H=N.next();!H.done;H=N.next())F=H.value,s0(F),p=g.sy(F.key).entityId,c={videoId:p,offlineDeleteReason:void 0,cotn:F.cotn},AO(c),E=g.oY(p,"musicTrack"),gM(D,{entityKey:E,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.q(I,Z6B(),0)})},Y96=function(k){for(var U,D=g.z(k.additionalMetadatas),b=D.next();!b.done;b=D.next())b=b.value,b.offlineMusicVideoData&&(U=b.offlineMusicVideoData);
var N,H,F,p,c;return{id:g.oY(k.videoId,"musicTrack"),videoId:k.videoId,title:k.title,thumbnailDetails:k.thumbnail,lengthMs:String(Number(k.lengthSeconds)*1E3),albumTitle:(N=U)==null?void 0:N.releaseTitle,musicVideoType:(H=U)==null?void 0:H.musicVideoType,contentRating:{explicitType:(F=U)==null?void 0:F.explicitType},artistNames:((p=U)==null?void 0:p.byline)||((c=U)==null?void 0:c.channelName),downloadMetadata:g.oY(k.videoId,"musicTrackDownloadMetadataEntity")}},efv=function(k,U,D){var b,N,H,F,p,c,
E,I,G,K,P,V,Z,w,M,d,t,L;
return g.O(function(e){b=[];N=new Set;if((H=D)==null?0:(F=H.downloadedTracks)==null?0:F.length)for(p=g.z(D.downloadedTracks),c=p.next();!c.done;c=p.next())E=c.value,N.add(E);if(k.tracks){I=g.z(k.tracks);for(G=I.next();!G.done;G=I.next())K=G.value,N.has(K)||b.push(K);P=g.z(U);for(V=P.next();!V.done;V=P.next())if(Z=V.value,Z.id!==k.id&&(w=Z.tracks))for(M=g.z(w),d=M.next();!d.done;d=M.next())t=d.value,L=b.indexOf(t),L!==-1&&b.splice(L,1)}return e.return(b)})},TfL=function(k,U){var D,b,N,H,F,p,c,E;
return g.O(function(I){D=o3(k.thumbnailDetails);b=g.z(U);for(N=b.next();!N.done;N=b.next())if(H=N.value,H.id!==k.id)for(F=g.z(o3(H.thumbnailDetails)),p=F.next();!p.done;p=F.next())c=p.value,E=D.indexOf(c),E!==-1&&D.splice(E,1);return I.return(D)})},JfZ=function(k,U){var D,b,N,H,F,p,c,E,I;
return g.O(function(G){if(G.Z==1)return D=g.oY("music_downloads_library_id","musicDownloadsLibraryEntity"),g.q(G,vc(k,D,"musicDownloadsLibraryEntity"),2);(b=G.S)||(b={id:D});N=g.sy(U).entityType;N==="musicTrack"?(H=b.downloadedTracks)!=null&&H.includes(U)||(b.downloadedTracks=((F=b.downloadedTracks)!=null?F:[]).concat(U)):N==="musicPlaylist"?(p=b.downloadedPlaylists)!=null&&p.includes(U)||(b.downloadedPlaylists=((c=b.downloadedPlaylists)!=null?c:[]).concat(U)):N!=="musicAlbumRelease"||(E=b.downloadedAlbumReleases)!=
null&&E.includes(U)||(b.downloadedAlbumReleases=((I=b.downloadedAlbumReleases)!=null?I:[]).concat(U));return g.q(G,Ro(k,b,"musicDownloadsLibraryEntity"),0)})},uFc=function(k,U){var D,b,N,H,F,p,c;
return g.O(function(E){if(E.Z==1)return D=g.oY("music_downloads_library_id","musicDownloadsLibraryEntity"),g.q(E,vc(k,D,"musicDownloadsLibraryEntity"),2);b=E.S;if(!b)return E.Xt(0);N=g.sy(U).entityType;N==="musicTrack"?H=b.downloadedTracks:N==="musicPlaylist"&&(H=b.downloadedPlaylists);if((F=H)==null?0:F.length)for(p=0;p<H.length;p++)if(c=H[p],c===U){H.splice(p,1);break}return g.q(E,Ro(k,b,"musicDownloadsLibraryEntity"),0)})},l7I=function(k){var U=k.videos;
k=[];var D=[];if(U){U=g.z(U);for(var b=U.next();!b.done;b=U.next()){var N=b.value.offlineVideoData.videoId;b=g.oY(N,"musicTrack");N=g.oY(N,"musicTrackDownloadMetadataEntity");k.push(b);D.push(N)}}return{Y1:k,zU:D}},XA=function(k,U,D){U={track:Y96(U)};
D&&(U.playlistId=D);if(k=g.J(k.actionMetadata,rf9))U.maximumDownloadQuality=k.maximumDownloadQuality;return{musicTrackEntityActionMetadata:U}},C6B=function(k){var U,D,b,N,H,F,p,c;
return g.O(function(E){switch(E.Z){case 1:return U=g.Px(),D=CVz(k),b=g.nh(S9Z),g.jh(E,2),H={iE:!0},g.q(E,g.Nr(U,D,b,void 0,H),4);case 4:N=E.S;g.io(E,3);break;case 2:F=g.zY(E);if(F instanceof g.IQ)throw p="GetOffline network manager error: "+F.message,ND(p,F),Error(p);ND("GetOffline fetch request error",F);throw Error("GetOffline fetch request error");case 3:c=dM(N);if(!N)throw ND("Network request failed"),Error("Network request failed");if(c!==void 0)fu(c);else if(!N.videos||!N.videos.length)throw ND("No data"),
Error("No data");return E.return(N.videos.map(function(I){return I.offlineVideoData}))}})},hfL=function(k){var U,D,b,N,H,F,p,c;
return g.O(function(E){switch(E.Z){case 1:return U=g.Px(),D=hT6(k),b=g.nh(S9Z),g.jh(E,2),H={iE:!0},g.q(E,g.Nr(U,D,b,void 0,H),4);case 4:N=E.S;g.io(E,3);break;case 2:F=g.zY(E);if(F instanceof g.IQ)throw p="GetOffline network manager error for playlist: "+F.message,ND(p,F),Error(p);ND("GetOffline fetch request error for playlist",F);throw Error("GetOffline fetch request error for playlist");case 3:c=dM(N);if(!N)throw ND("Network request failed for playlist"),Error("Network request failed for playlist");
if(c!==void 0)fu(c,"playlist");else if(!N.playlists||!N.playlists.length)throw ND("No data for playlist"),Error("No data for playlist");return E.return(N.playlists.map(function(I){return I.offlinePlaylistData}))}})},RfL=function(k,U,D,b){var N,H,F,p,c,E,I,G,K,P,V,Z,w,M,d,t,L,e,l,C,N9,Fv,kU,u,R,n,r,yW,n9,Ur;
return g.O(function(W9){switch(W9.Z){case 1:return g.q(W9,kY(),2);case 2:N=W9.S;if(!N)return W9.return([]);H=[];if((F=b)==null?0:F.length){H=b;W9.Xt(3);break}return g.q(W9,y2(N,"mainPlaylistEntity"),4);case 4:H=W9.S;case 3:if(!H.length)return W9.return([]);p=[];c=Date.now()/1E3;E=g.z(H);I=E.next();case 5:if(I.done)return p.length?g.q(W9,$PI(p),10):W9.return([]);G=I.value;if(!G.downloadState){K=void 0;W9.Xt(8);break}return g.q(W9,vc(N,G.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:K=
W9.S;case 8:P=K;V=void 0;w=(Z=(V=G)==null?void 0:V.entityMetadata)&&Z.nextAutoRefreshIntervalSeconds?Number(Z.nextAutoRefreshIntervalSeconds):NaN;M=Number.isNaN(w)?k:w;t=d=void 0;L=((d=P)==null?0:d.lastSyncedTimestampMillis)?Number((t=P)==null?void 0:t.lastSyncedTimestampMillis)/1E3:0;l=e=void 0;C=((e=P)==null?0:e.addedTimestampMillis)?Number((l=P)==null?void 0:l.addedTimestampMillis)/1E3:0;if(D||!Z||L+M<=c){N9=[];Fv=void 0;if((Fv=G.videos)==null?0:Fv.length)for(kU=g.z(G.videos),u=kU.next();!u.done;u=
kU.next())R=u.value,n=JSON.parse(g.sy(R).entityId),n.videoId&&N9.push(n.videoId);r="0";Z&&(yW=void 0,r=String(Number((yW=Z.offlineLastModifiedTimestampSeconds)!=null?yW:0).toFixed()));n9={playlistId:G.playlistId,videoIds:N9,offlineLastModifiedTimestamp:r,autoSync:U,offlineDateAddedTimestamp:String(C.toFixed())};p.push(n9)}I=E.next();W9.Xt(5);break;case 10:return Ur=W9.S,W9.return(Ur)}})},vjr=function(){var k,U,D,b,N;
return g.O(function(H){if(H.Z==1)return g.q(H,kY(),2);if(H.Z!=3)return(k=H.S)?g.q(H,y2(k,"refresh"),3):H.return(!1);U=H.S;if((D=U[0])==null||!D.refreshTime)return H.return(!1);b=Number(U[0].refreshTime);N=Date.now()/1E3;return H.return(isFinite(b)&&N>=b)})},ktB=function(k,U){var D,b,N;
return g.O(function(H){switch(H.Z){case 1:return g.jh(H,2),g.q(H,yf9(k,U),4);case 4:return b=H.S,g.q(H,f79(b),5);case 5:D=toz(b);g.io(H,3);break;case 2:N=g.zY(H),ND("getAndProcessSmartDownloadsResponse request or processing error",N);case 3:return H.return(D)}})},UyZ=function(k,U,D,b){var N,H,F,p,c,E,I,G,K,P,V,Z,w,M,d,t,L,e,l,C,N9,Fv,kU,u,R,n,r,yW,n9,Ur;
return g.O(function(W9){switch(W9.Z){case 1:return g.q(W9,kY(),2);case 2:N=W9.S;if(!N)return W9.return([]);H=[];if((F=b)==null?0:F.length){H=b;W9.Xt(3);break}return g.q(W9,y2(N,"musicPlaylist"),4);case 4:H=W9.S;case 3:if(!H.length)return W9.return([]);p=[];c=Date.now()/1E3;E=g.z(H);I=E.next();case 5:if(I.done)return p.length?g.q(W9,$PI(p),10):W9.return([]);G=I.value;K=void 0;V=(P=(K=G)==null?void 0:K.entityMetadata)&&P.nextAutoRefreshIntervalSeconds?Number(P.nextAutoRefreshIntervalSeconds):NaN;Z=
Number.isNaN(V)?k:V;M=w=0;d="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!G.downloadMetadata){W9.Xt(8);break}return g.q(W9,vc(N,G.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:t=W9.S,e=L=void 0,w=Number((e=(L=t)==null?void 0:L.addedTimestampMillis)!=null?e:"0")/1E3,C=l=void 0,M=Number((C=(l=t)==null?void 0:l.lastModifiedTimestampMillis)!=null?C:"0")/1E3,Fv=N9=void 0,d=(Fv=(N9=t)==null?void 0:N9.syncState)!=null?Fv:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:kU=void 0;if(D||d!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!P||Number((kU=P.lastSyncedTimestampSeconds)!=null?kU:0)+Z<=c){u=[];R=void 0;if((R=G.tracks)==null?0:R.length)for(n=g.z(G.tracks),r=n.next();!r.done;r=n.next())yW=r.value,u.push(g.sy(yW).entityId);n9={playlistId:G.playlistId,videoIds:u,offlineLastModifiedTimestamp:String(M.toFixed()),autoSync:U,offlineDateAddedTimestamp:String(w.toFixed())};p.push(n9)}I=E.next();W9.Xt(5);break;case 10:return Ur=W9.S,W9.return(Ur)}})},yf9=function(k,U){var D,b,N,H,F,p,c,E,I,G;
return g.O(function(K){switch(K.Z){case 1:return D=g.Px(),g.q(K,kY(),2);case 2:b=K.S;if(!b){K.Xt(3);break}return g.q(K,DPG(b),4);case 4:N=K.S;case 3:var P=N;H={context:g.VF(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:k},offlineClientState:P,clientStateRequestData:{preferredFormatType:U}}}};F=g.nh(Dyv);g.jh(K,5);c={iE:!0};return g.q(K,g.Nr(D,H,F,void 0,c),7);case 7:p=K.S;g.io(K,6);break;case 5:E=g.zY(K);if(E instanceof g.IQ)throw I=
"DPS network manager error for smart downloads: "+E.message,ND(I,E),Error(I);ND("DPS fetch request error for smart downloads",E);throw Error("DPS fetch request error for smart downloads");case 6:G=dM(p);if(p)G!==void 0&&fu(G,"smart downloads");else throw ND("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return K.return(p)}})},N1Z=function(k,U){var D,b,N,H,F,p,c,E;
return g.O(function(I){switch(I.Z){case 1:return D=g.Px(),b={context:g.VF(),videoPlaybackPositionEntities:k,lastSyncTimestampUsec:U},N=g.nh(bB9),g.jh(I,2),F={iE:!0},g.q(I,g.Nr(D,b,N,void 0,F),4);case 4:H=I.S;g.io(I,3);break;case 2:p=g.zY(I);if(p instanceof g.IQ)throw c="VPPS network manager error: "+p.message,ND(c,p),Error(c);ND("VPPS fetch request error",p);throw Error("VPPS fetch request error");case 3:E=dM(H);if(H)E!==void 0&&fu(E,"position sync");else throw ND("Network request failed for position sync"),
Error("Network request failed for position sync");return I.return(H)}})},gfz=function(k,U,D){var b,N,H,F,p,c,E,I;
return g.O(function(G){switch(G.Z){case 1:b=g.Px();var K=D.refreshData,P=D.isEnqueuedForExpiredStreamUrlRefetch,V=D.gM,Z=D.offlineSourceData,w=D.mediaCapabilities,M={entityKey:k};K&&(M.refreshData=K);P&&(M.isExpiredStreamUrlRefetch=P);V&&(M.downloadParameters=V);Z&&(M.offlineSourceData=Z);K={context:g.bx(U),signatureTimestamp:20117,videos:[M]};w&&(K.mediaCapabilities=w);N=K;H=g.nh(HBr);g.jh(G,2);p={iE:!0};return g.q(G,g.Nr(b,N,H,void 0,p),4);case 4:F=G.S;g.io(G,3);break;case 2:c=g.zY(G);if(c instanceof
g.IQ)throw E="GetPDE network manager error: "+c.message,ND(E,c),Error(E);ND("GetPDE fetch request error",c);throw Error("GetPDE fetch request error");case 3:I=dM(F);if(F)I!==void 0&&fu(I,"PDE");else throw ND("Network request failed for PDE"),Error("Network request failed for PDE");return G.return(F)}})},dM=function(k){var U;
return(U=k.errorMetadata)==null?void 0:U.status},fu=function(k,U){U=U?" for "+U:"";
if(k===0)throw k="Empty response body"+U,ND(k),Error(k);k="Response with error"+U;ND(k);throw Error(k);},$PI=function(k){var U,D,b,N,H,F,p,c;
return g.O(function(E){switch(E.Z){case 1:return U=g.Px(),D=$Kc(k),b=g.nh(F$9),g.jh(E,2),H={iE:!0},g.q(E,g.Nr(U,D,b,void 0,H),4);case 4:N=E.S;g.io(E,3);break;case 2:F=g.zY(E);if(F instanceof g.IQ)throw p="offlinePlaylistSyncCheck network manager error: "+F.message,ND(p,F),Error(p);ND("offlinePlaylistSyncCheck fetch request error",F);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:c=dM(N);if(!N)throw ND("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(c!==void 0)fu(c,"playlist sync");else if(!N.offlinePlaylistSyncCheckDatas||!N.offlinePlaylistSyncCheckDatas.length)throw ND("No data for playlist sync"),Error("No data for playlist sync");return E.return(N.offlinePlaylistSyncCheckDatas.map(function(I){return I.offlinePlaylistSyncCheckData}))}})},qD=function(k){this.Z=k},Am9=function(k,U){var D,b,N,H,F,p;
return g.O(function(c){switch(c.Z){case 1:D=new Map,b=g.z(U),N=b.next();case 2:if(N.done){c.Xt(4);break}H=N.value;F=D;p=F.set;return g.q(c,k.S(H),5);case 5:p.call(F,H,c.S);N=b.next();c.Xt(2);break;case 4:return c.return(D)}})},tO=function(k,U,D,b,N,H){U=g.oY(U,D);
b=Object.assign({},H,{priority:b,retryScheduleIntervalsInSeconds:N});return{actionType:k,entityKey:U,actionMetadata:b}},O0=function(k,U,D,b,N,H){this.status=k;
this.Z=U;this.W=D;this.S=b;this.j=N;this.downloadState=H},pjz=function(k,U,D){this.Z=k;
this.ZN=U;this.j=D},IuL=function(k,U){var D,b,N,H,F,p,c,E,I;
return g.O(function(G){switch(G.Z){case 1:return D=U.entityKey,N=(b=g.J(U.actionMetadata,Q$))==null?void 0:b.isEnqueuedForExpiredStreamUrlRefetch,g.jh(G,2),H=void 0,g.q(G,cmZ(k,U),4);case 4:H=G.S;g.jh(G,5);var K=(K=g.J(U.actionMetadata,Q$))?{maximumDownloadQuality:K.maximumDownloadQuality}:void 0;return g.q(G,gfz(D,k.ZN,{isEnqueuedForExpiredStreamUrlRefetch:N,gM:K,offlineSourceData:H}),7);case 7:F=G.S;g.io(G,6,2);break;case 5:return g.zY(G,2),p=c_(U)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",ND("PDE handleAdd error"),G.return(Lu(U,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",p,"DOWNLOAD_STATE_FAILED"));case 6:return g.q(G,Efr(k,F,U),8);case 8:return G.return(Lu(U,!0,F.orchestrationActions));case 2:return c=g.zY(G),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",I="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.Xx&&c.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
I="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ND("PDE handleAdd error"),G.return(Lu(U,!1,void 0,E,I,"DOWNLOAD_STATE_FAILED"))}})},PjB=function(k,U){var D,b,N,H,F,p,c,E,I,G,K,P,V,Z,w,M,d,t,L,e,l,C,N9,Fv;
return g.O(function(kU){switch(kU.Z){case 1:return D=U.entityKey,b=g.sy(D).entityId,g.q(kU,$1(k.Z,{mode:"readonly",mV:!0},function(u){var R=Jt(u,D,"playbackData"),n=Jt(u,g.oY(b,"offlineVideoPolicy"),"offlineVideoPolicy");u=Jt(u,g.oY(b,"transfer"),"transfer");return g.Ls.all([R,n,u])}),2);
case 2:N=kU.S;H=g.z(N);F=H.next().value;p=H.next().value;c=H.next().value;E=F;I=p;G=c;if(!E||!I)return kU.return(Lu(U,!0));K=[];Z=((V=E)==null?0:V.playerResponseJson)?JSON.parse(E.playerResponseJson):null;if(!(G&&Z&&k.ZN.U("html5_refresh_deprecated_downloads"))){kU.Xt(3);break}P=GtR(k,Z,G);return g.q(kU,K$B(k,G),4);case 4:K=kU.S;case 3:w={lastPlayerResponseTimestampSeconds:E.playerResponseTimestamp,offlineToken:I.offlineToken,formatIds:K};M={};if((d=G)==null?0:d.maximumDownloadQuality)M.maximumDownloadQuality=
G.maximumDownloadQuality;g.jh(kU,5);t=void 0;return g.q(kU,cmZ(k,U),7);case 7:return t=kU.S,g.jh(kU,8),g.q(kU,gfz(D,k.ZN,{refreshData:w,gM:M,offlineSourceData:t,mediaCapabilities:P}),10);case 10:L=kU.S;g.io(kU,9,5);break;case 8:return g.zY(kU,5),e=c_(U)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",ND("PDE handleRefresh error"),kU.return(Lu(U,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",e,
"DOWNLOAD_STATE_FAILED"));case 9:return g.q(kU,Efr(k,L,U),11);case 11:return kU.return(Lu(U,!0,L.orchestrationActions));case 5:return l=g.zY(kU),C="PDE handleRefresh error",l instanceof Error&&(C="PDE handleRefresh error: "+l.message),N9="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Fv="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.Xx&&l.type==="QUOTA_EXCEEDED"&&(N9="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Fv="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
ND(C),kU.return(Lu(U,!1,void 0,N9,Fv,"DOWNLOAD_STATE_FAILED"))}})},cmZ=function(k,U){var D,b,N,H;
return g.O(function(F){if(F.Z==1)return D=g.sy(U.entityKey).entityId,b=g.oY(D,"videoDownloadContextEntity"),g.q(F,vc(k.Z,b,"videoDownloadContextEntity"),2);N=F.S;return(H=N)!=null&&H.offlineModeType?F.return({offlineModeType:N.offlineModeType}):F.return(void 0)})},Efr=function(k,U,D){var b,N,H,F,p;
return g.O(function(c){if(c.Z==1){if(!U.frameworkUpdates||!g.J(U.frameworkUpdates,ZN))return c.return();if(!(g.J(U.frameworkUpdates,ZN).mutations&&g.J(U.frameworkUpdates,ZN).mutations.length>0&&g.J(U.frameworkUpdates,ZN).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return c.Xt(2);b=g.sy(g.J(U.frameworkUpdates,ZN).mutations[0].entityKey).entityId;return g.q(c,a3(k.Z,b),3)}if(c.Z!=2){N=c.S;H=g.J(D.actionMetadata,Q$);if(p=(F=H)==null?void 0:F.playlistId)N.playlistId=p;N.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.$8(k.ZN)?g.q(c,zg(b,k.Z,D,k.j,N),2):g.Cz(k.ZN)?g.q(c,wM(b,k.Z,D,k.j),2):c.Xt(2)}return g.q(c,eTY(g.J(U.frameworkUpdates,ZN)),0)})},Lu=function(k,U,D,b,N,H){return new O0(U?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c_(k),D,b,N,H)},GtR=function(k,U,D){U=i6Y(k.ZN,D.cotn,U);
D=g.gA(U);return g.fdY(U,D,k.ZN)},K$B=function(k,U){var D,b,N,H,F,p,c,E,I,G,K;
return g.O(function(P){if(P.Z==1)return D=[],g.q(P,$1(k.Z,{mode:"readonly",mV:!0},function(V){var Z=[],w=U.offlineVideoStreams;if(w){w=g.z(w);for(var M=w.next();!M.done;M=w.next())Z.push(Jt(V,M.value,"offlineVideoStreams"))}return g.Ls.all(Z)}),2);
if(b=P.S)for(N=g.z(b),H=N.next();!H.done;H=N.next())if(F=H.value,p=void 0,(p=F)==null?0:p.streamsProgress)for(c=F.streamsProgress,E=0;E<c.length;E++)I=c[E],G=JSON.parse(I.formatStreamBytes),K={itag:G.itag,lmt:G.lastModified,xtags:G.xtags},D.push(K);return P.return(D)})},sZ9=function(k,U){this.Z=k;
this.ZN=U},of6=function(k,U){var D,b,N,H,F,p,c,E,I,G,K,P;
return g.O(function(V){switch(V.Z){case 1:return D=c_(U),g.q(V,y2(k.Z,"videoPlaybackPositionEntity"),2);case 2:b=V.S;if(b.length===0)return V.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D));g.jh(V,3);return g.q(V,eX.getInstance(),5);case 5:N=V.S;if(!N)throw Error("prefStorage is undefined");return g.q(V,N.get("psi"),6);case 6:return H=V.S,c=(p=(F=H)==null?void 0:F.y6)!=null?p:"0",g.q(V,N1Z(b,c),7);case 7:return E=V.S,I={isPaused:E.watchHistoryPaused,y6:E.syncTimestampUsec},g.q(V,N.set("psi",
I),8);case 8:if(I.isPaused){V.Xt(9);break}G=g.J(E.frameworkUpdates,ZN);if(!E.frameworkUpdates||!G){V.Xt(9);break}return g.q(V,eTY(G),9);case 9:g.io(V,4);break;case 3:return K=g.zY(V),P="PPE handleRefresh error: "+(K instanceof Error?K.message:"unknown error"),ND(P),V.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return V.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
D))}})},myF=function(k,U){var D,b,N,H,F,p,c,E;
return g.O(function(I){switch(I.Z){case 1:return D=c_(U),b=g.sy(U.entityKey).entityId,g.jh(I,2),g.q(I,eX.getInstance(),4);case 4:N=I.S;if(!N)throw Error("prefStorage is undefined");return g.q(I,N.get("psi"),5);case 5:H=I.S;F=g.J(U.actionMetadata,VPB);if(((p=H)==null?void 0:p.isPaused)!==!1||(c=F)==null||!c.lastPlaybackPositionSeconds){I.Xt(6);break}E={key:g.oY(b,"videoPlaybackPositionEntity"),videoId:b,lastPlaybackPositionSeconds:F.lastPlaybackPositionSeconds};return g.q(I,Ro(k.Z,E,"videoPlaybackPositionEntity"),
6);case 6:g.io(I,3);break;case 2:return g.zY(I),I.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return I.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D))}})},jZB=function(k,U){var D,b,N;
return g.O(function(H){switch(H.Z){case 1:D=c_(U);g.jh(H,2);b=g.sy(U.entityKey).entityId;if(b==="!*$_ALL_ENTITIES_!*$")return g.q(H,OpR(k.Z),5);N=g.oY(b,"videoPlaybackPositionEntity");return g.q(H,t8Y(k.Z,N),5);case 5:g.io(H,3);break;case 2:return g.zY(H),H.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
D))}})},nf9=function(k,U){this.api=k;
this.Z=U;this.logger=new g.NC("woffle");this.S=!1;this.dg={qr:this.qr};this.logger.debug("Initialized OfflineMediaManager")},iB6=function(k){return g.O(function(U){return U.return(SqF(k))})},zCr=function(k){var U;
return g.O(function(D){if(D.Z==1)return g.q(D,g.vxo(k),2);U=D.S;return D.return(U.filter(function(b){return!!b.url}).map(function(b){return b.url}))})},xY=function(k,U){var D=g.M3(U);
if(D===1||D===0)return Promise.resolve();(D=ZBB(k,U))&&D.stopVideo();k.j=0;return iB6(U)},Tg=function(k,U,D,b){D=D===void 0?!1:D;
b=b===void 0?!0:b;var N=typeof U==="string"?U:U.videoDetails.videoId;g.M3(N)===2&&((U=ZBB(k,N))?U.stopVideo():k.logger.info(function(){return"Corresponding player for "+N+" not found. Pausing anyway"}),g.XM(N,2),k.j=2,D?auB(k.Z):b&&wjF(k.Z))},ZBB=function(k,U){var D;
return((D=k.player)==null?void 0:D.getVideoData().videoId)===U?k.player:null},W$B=function(k,U,D){U.getPlayerResponse();
g.XM(U.videoId,2);k.j=2;k.S=!1;var b;(b=k.player)==null||b.dispose();k.player=k.api.xi(U);U={};k.player.mZ((U.localmediachange=k.Z_,U.signatureexpired=k.YY,U.statechange=k.qdu,U),k);var N=k.qr(D);k.player.Wc(g.HC(N,N,!0,"m"),!1);k.logger.debug(function(){return"Starting headless playback with quality: "+N});
k.player.SZ(!1)},MPr=function(k,U){this.Z=k;
this.ZN=U},dyR=function(k,U){var D,b;
return g.O(function(N){switch(N.Z){case 1:return D=c_(U),g.q(N,vc(k.Z,U.entityKey,"transfer"),2);case 2:if(b=N.S)return N.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D));g.jh(N,3);return g.q(N,Xj9(k,U),5);case 5:g.io(N,4);break;case 3:return g.zY(N),N.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return N.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
D))}})},fuc=function(k,U){var D,b;
return g.O(function(N){switch(N.Z){case 1:return D=c_(U),g.q(N,vc(k.Z,U.entityKey,"transfer"),2);case 2:b=N.S;if(!b||b.transferState!=="TRANSFER_STATE_COMPLETE")return N.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D));g.jh(N,3);return g.q(N,Xj9(k,U,!0),5);case 5:g.io(N,4);break;case 3:return g.zY(N),N.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return N.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D))}})},qNz=function(k,U){var D,b,N,H,F,p,c,E,I,G;
return g.O(function(K){switch(K.Z){case 1:return D=c_(U),b=g.sy(U.entityKey).entityId,g.q(K,$1(k.Z,{mode:"readonly",mV:!0},function(P){var V=Jt(P,U.entityKey,"transfer");P=Jt(P,g.oY(b,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Ls.all([V,P])}),2);
case 2:N=K.S;H=g.z(N);F=H.next().value;p=H.next().value;c=F;E=p;if(!c||c.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return K.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D));g.jh(K,3);c.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.q(K,Ro(k.Z,c,"transfer"),5);case 5:I=g.sy(c.key).entityId;pu({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:I,dT:c,offlineModeType:(G=E)==null?void 0:G.offlineModeType});g.io(K,
4);break;case 3:return g.zY(K),K.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return K.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D))}})},Xj9=function(k,U,D){D=D===void 0?!1:D;
var b,N,H,F,p,c,E,I,G,K,P,V,Z,w,M;return g.O(function(d){switch(d.Z){case 1:return b=g.J(U.actionMetadata,tPB),N=g.sy(U.entityKey).entityId,H=g.oY(N,"downloadStatusEntity"),g.q(d,$1(k.Z,{mode:"readonly",mV:!0},function(t){var L=Jt(t,H,"downloadStatusEntity");t=Jt(t,g.oY(N,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Ls.all([L,t])}),2);
case 2:return F=d.S,p=g.z(F),c=p.next().value,E=p.next().value,I=c,G=E,K="TRANSFER_STATE_TRANSFER_IN_QUEUE",((P=I)==null?void 0:P.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(K="TRANSFER_STATE_PAUSED_BY_USER"),w={key:U.entityKey,transferState:K,cotn:g.Oe(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(V=b)==null?void 0:V.maximumDownloadQuality,preferredAudioTrack:(Z=b)==null?void 0:Z.preferredAudioTrack,transferRetryCount:0,isRefresh:D,hasLoggedFirstStarted:!1},g.q(d,$1(k.Z,
{mode:"readwrite",mV:!0},function(t){var L=[];D&&L.push(SX(t,g.oY(N,"offlineVideoStreams")));L.push(r4(t,w,"transfer"));return g.Ls.all(L)}),3);
case 3:if(!D){d.Xt(4);break}return g.q(d,iB6(N),4);case 4:pu({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:N,dT:w,offlineModeType:(M=G)==null?void 0:M.offlineModeType}),g.mI(d)}})},QZY=function(k,U,D,b){if(!k.action.entityKey)throw Error("entityKey is missing.");
var N=g.sy(k.action.entityKey);N={entityType:N.HQ,entityId:N.entityId,offlineOrchestrationActionType:k.action.actionType,orchestrationAction:{orchestrationActionId:k.actionId}};U&&(N.offlineOrchestrationActionResult=U.status,N.isRetryable=D?!1:U.Z,U.j&&(N.offlineOrchestrationFailureReason=OBF(U.j,N.isRetryable)));var H,F;if((H=k.action.actionMetadata)==null?0:(F=H.offlineLoggingData)==null?0:F.offlineModeType)N.offlineModeType=k.action.actionMetadata.offlineLoggingData.offlineModeType;b&&(N.additionalOrchestrationActions=
b.map(function(p){return{orchestrationActionId:p.actionId}}));
return N},OBF=function(k,U){return k!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||U?k==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&U?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":k:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},L$c=function(k,U){var D={offlineOrchestrationContext:QZY(k)};
U=kC9(U,D);UPz(ypZ(),U,k.rootActionId)},xyL=function(k,U,D,b){b=b===void 0?[]:b;
U={offlineOrchestrationContext:QZY(k,U,D,b)};U=kC9(3,U);UPz(ypZ(),U,k.rootActionId)},T1z=function(){this.actions=[]},eCB=function(k,U){U=g.z(U);
for(var D=U.next();!D.done;D=U.next())D=D.value,L$c(D,1),k.actions.push(D);k.actions.sort(k.Z)},B1c=function(k,U){if(U)for(var D=0;D<k.actions.length;D++)if(U==="!*$_ALL_ENTITIES_!*$"&&k.actions[D].actionId!==U||U!=="!*$_ALL_ENTITIES_!*$"&&k.actions[D].rootActionId===U&&k.actions[D].actionId!==U)k.actions.splice(D,1),D--},YNz=function(k,U){k=g.z(k.actions);
for(var D=k.next();!D.done;D=k.next())if(D.value.actionId===U)return!0;return!1},ev=function(k,U,D,b,N){g.B.call(this);
var H=this;this.S=k;this.jw=U;this.dP=D;this.B=b;this.ZN=N;this.Z=new T1z;this.N=new g.gS;this.j=new g.Ec(function(){H.retry()});
this.V=NaN;this.K=!1;this.dg={z2I:function(){return H.Z},
MB:function(){return H.N},
MXC:function(){return H.j},
retry:function(){return H.retry()}};
g.Y(this,this.j);this.D=this.S.observe(this.Ft.bind(this))},luG=function(k,U,D,b,N){var H;
return g.O(function(F){if(F.Z==1)return H=new ev(k,U,D,b,N),g.q(F,Jm9(H),2);uS9(H);return F.return(H)})},uS9=function(k){var U=k.Z.actions[0];
return k.W?((U==null?void 0:U.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&k.W[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(k.K=!0),Promise.resolve()):rmF(k)},rmF=function(k){var U,D,b,N,H,F,p,c,E,I,G,K,P,V,Z,w,M;
return g.O(function(d){switch(d.Z){case 1:if(k.W)throw Error("Already processing an action");if(k.K2())return d.return();U=k.Z.actions.shift();KoB(k.dP,!U);if(U===void 0)return d.return();U.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&U.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&B1c(k.Z,U.actionId);D="";U.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&U.rootActionId===U.actionId&&(D=U.actionId);b=[U];k.W=b;if(N=k.jw[U.entityType]){d.Xt(2);break}k.W=
void 0;return g.q(d,rmF(k),3);case 3:return d.return();case 2:H=g.z(b);for(F=H.next();!F.done;F=H.next())p=F.value,L$c(p,2);g.jh(d,4,5);return g.q(d,Am9(N,b.map(function(t){return t.action})),7);
case 7:c=d.S,E=g.z(b),I=E.next();case 8:if(I.done){d.Xt(10);break}G=I.value;K=c.get(G.action);return g.q(d,SN9(k,G,K),9);case 9:I=E.next();d.Xt(8);break;case 10:B1c(k.Z,D);case 5:g.Zh(d);k.W=void 0;g.aN(d,6);break;case 4:return P=g.zY(d),ND("Orchestration error",P),g.jh(d,12),g.q(d,Cjc(k,b),14);case 14:g.io(d,5);break;case 12:V=g.zY(d);ND("Orchestration retry error",V);Z=g.z(b);for(w=Z.next();!w.done;w=Z.next())M=w.value,M.retryScheduleIndex<3&&eCB(k.Z,[M]);d.Xt(5);break;case 6:return g.q(d,rmF(k),
0)}})},SN9=function(k,U,D){var b,N,H,F,p,c,E,I,G,K,P,V;
return g.O(function(Z){switch(Z.Z){case 1:b=U.retryScheduleIndex+2===3;if(D.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){Z.Xt(2);break}if(D.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){Z.Xt(0);break}xyL(U,D,b);if(D.Z&&U.retryScheduleIndex+1<3)return g.q(Z,Cjc(k,[U]),0);H=((N=D)==null?0:N.S)?D.S:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";F={entityKey:U.action.entityKey,failureReason:H};p=void 0;g.$8(k.ZN)?p="mainVideoDownloadStateEntity":g.Cz(k.ZN)&&(p="musicTrackDownloadMetadataEntity");
if(!p||!D.downloadState){Z.Xt(7);break}c=g.sy(U.action.entityKey).entityId;return g.q(Z,Ku(c,p,k.S,D.downloadState),7);case 7:gM(k.B,F);if(D.downloadState==="DOWNLOAD_STATE_FAILED"&&k.ZN.U("html5_auto_retry_failed_pde_actions")){Z.Xt(0);break}ND("Orchestration result is not retryable, deleting action");return g.q(Z,t8Y(k.S,jv(U).key),0);case 2:E=void 0;try{E=(I=D.W)==null?void 0:I.map(function(w){return k.createAction(w,U)})}catch(w){return xyL(U,D,b),G={entityKey:U.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},gM(k.B,G),ND("Orchestration subactions creation error",w),Z.return()}xyL(U,D,b,E);if(!E){Z.Xt(12);break}K=E.map(function(w){return jv(w)});
P=0;case 13:if(!(P<E.length)||k.K){Z.Xt(15);break}return g.q(Z,$1(k.S,{mode:"readwrite",mV:!0},function(w){var M=[];M.push(zTB(w,K.slice(P,P+10),"offlineOrchestrationActionWrapperEntity"));return g.Ls.all(M)}),16);
case 16:P+=10;Z.Xt(13);break;case 15:if(k.K)return k.K=!1,Z.return();case 12:return V=jv(U),g.q(Z,t8Y(k.S,V.key),17);case 17:L$c(U,4),g.mI(Z)}})},vf9=function(k,U){var D,b,N,H,F,p,c,E,I,G,K,P;
return g.O(function(V){D=[];b=Infinity;N=4E3;H=g.z(U);for(F=H.next();!F.done;F=H.next())p=F.value,c=Number(p.enqueueTimeSec),E=hC9(c),I=p.retryScheduleIndex,G=I!=null&&I>0,E>0&&G?(b=Math.min(b,c),N=Math.min(E,N)):D.push(p);isFinite(b)&&(!k.j.isActive()||b<k.V)&&(k.V=b,k.j.start(N));k.N.U$()||(K=D.length,D=D.filter(function(Z){var w;Z=((w=Z.actionProto)==null?void 0:w.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!$y6.includes(Z)}),P=D.length<K,!k.j.isActive()&&P&&k.j.start(1));
D.length>0&&RCB(k,D);return g.q(V,uS9(k),0)})},kfr=function(k){var U,D,b,N,H,F,p;
return g.O(function(c){if(c.Z==1)return g.q(c,ymR(k),2);U=c.S;D=[];b=g.z(U);for(N=b.next();!N.done;N=b.next())H=N.value,F=g.sy(H.key),p=F.entityId,YNz(k.Z,p)||D.push(H);return g.q(c,vf9(k,D),0)})},hC9=function(k){k=k*1E3-Date.now();
return k>4E3?4E3:k},Cjc=function(k,U){var D,b,N;
return g.O(function(H){D=g.z(U);for(b=D.next();!b.done;b=D.next()){N=b.value;var F=void 0,p=void 0,c=((p=N.action)==null?void 0:(F=p.actionMetadata)==null?void 0:F.retryScheduleIntervalsInSeconds)||[1,2,4];F=1;N.retryScheduleIndex<c.length&&(F=c[N.retryScheduleIndex]);N.Z=F*1E3+Date.now();N.retryScheduleIndex++}return g.q(H,UaY(k,U),0)})},Jm9=function(k){var U;
return g.O(function(D){if(D.Z==1)return g.q(D,y2(k.S,"offlineOrchestrationActionWrapperEntity"),2);U=D.S;return g.q(D,vf9(k,U),0)})},RCB=function(k,U){U.length!==0&&U.forEach(function(D){D=m1(D);
D.retryScheduleIndex<3&&eCB(k.Z,[D])})},ymR=function(k,U){var D;
return g.O(function(b){if(b.Z==1)return g.q(b,y2(k.S,"offlineOrchestrationActionWrapperEntity",U),2);D=b.S;return b.return(D.filter(BB9))})},UaY=function(k,U){if(U.length===0)return Promise.resolve([]);
U=U.map(function(D){return jv(D)});
return qqz(k.S,U)},DaI=function(k){this.uK=k;
this.Z=void 0},bNB=function(k,U){var D,b,N,H;
return g.O(function(F){D=U.videoId;b=!0;if(U.captionTracks.length)N=zzv(U),k.Z=new g.tl(k.uK,U,N);else if(U.Qy)H=g.FmI(U),k.Z=new g.QE(k.uK,U.Qy,D,H,U.wh,U.eventId),b=U.wh;else return F.return();return F.return(new Promise(function(p){var c;(c=k.Z)==null||c.GW({Vh:function(){return g.O(function(E){if(E.Z==1)return g.q(E,k.Vh(D,b),2);p();g.mI(E)})},
fO:function(){}})}))})},N9L=function(k){var U;
return g.O(function(D){if(D.Z==1)return g.q(D,rp9(k),2);U=D.S;return D.return(!!U&&U.length>0)})},B_=function(k){g.B.call(this);
this.Z=k;this.S=this.Z.observe(this.j.bind(this))},HNz=function(k,U){var D,b,N,H,F,p,c;
return g.O(function(E){switch(E.Z){case 1:if(U.length===0)return E.return([]);D=U.map(function(I){return g.oY(I,"transfer")});
return g.q(E,y2(k.Z,"transfer",D),2);case 2:b=E.S;N=b.filter(BB9).map(function(I){return g.sy(I.key).entityId});
H=U.filter(function(I){return N.indexOf(I)===-1});
if(H.length===0)return E.return([]);F=g.z(H);p=F.next();case 3:if(p.done){E.Xt(5);break}c=p.value;return g.q(E,iB6(c),4);case 4:p=F.next();E.Xt(3);break;case 5:return E.return(H)}})},AFz=function(k,U,D,b,N,H){var F,p,c;
return g.O(function(E){F="STREAM_TYPE_UNKNOWN";D.video&&D.audio?(F="STREAM_TYPE_AUDIO_AND_VIDEO",ND("unexpected stream type")):D.video&&!D.audio?F="STREAM_TYPE_VIDEO":!D.video&&D.audio&&(F="STREAM_TYPE_AUDIO");p=g.oY(U,"offlineVideoStreams");c={numBytesDownloaded:N.toFixed(),numTotalBytes:H.toFixed(),streamType:F,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(b),itag:F==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(D.itag):void 0};return g.q(E,$1(k,{mode:"readwrite",mV:!0},
function(I){var G=Jt(I,p,"offlineVideoStreams"),K=Jt(I,g.oY(U,"transfer"),"transfer");return g.Ls.all([G,K]).then(function(P){P=g.z(P);var V=P.next().value;P=P.next().value;if(!P)return SX(I,p).then(function(){});
var Z=g_Y(V);V=FRR(V,b,c,p);var w=r4(I,V,"offlineVideoStreams");g_Y(V)>Z&&(P.lastProgressTimeMs=Date.now().toString());Z=[w];P.offlineVideoStreams||(P.offlineVideoStreams=[]);P.offlineVideoStreams.indexOf(p)===-1&&(P.offlineVideoStreams.push(p),Z.push(r4(I,P,"transfer")));return g.Ls.all(Z)})}),0)})},p5r=function(k,U){var D,b,N,H,F;
return g.O(function(p){if(p.Z==1)return D=g.oY(U,"offlineVideoStreams"),g.q(p,vc(k,D,"offlineVideoStreams"),2);b=p.S;if(!b||!b.streamsProgress)return p.return();N=g.z(b.streamsProgress);for(H=N.next();!H.done;H=N.next())F=H.value,F.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",F.numTotalBytes!==F.numBytesDownloaded&&(F.numBytesDownloaded=F.numTotalBytes);return g.q(p,Ro(k,b,"offlineVideoStreams"),0)})},FRR=function(k,U,D,b){if(k&&k.streamsProgress){b=k;
a:{U=U.itag+";"+U.xtags;for(var N=k.streamsProgress,H=0;H<N.length;H++){var F=JSON.parse(N[H].formatStreamBytes);if(F.itag+";"+F.xtags===U){N[H]=D;D=N;break a}}N.push(D);D=N}b.streamsProgress=D}else k={key:b,streamsProgress:[D]};return k},g_Y=function(k){if(k==null?0:k.streamsProgress){var U=0;
k=k.streamsProgress;for(var D=0;D<k.length;D++){var b=k[D];isNaN(Number(b.numBytesDownloaded))?ND("stream progress bytes number invalid"):U+=Number(b.numBytesDownloaded)}return U}return 0},cFz=function(k,U,D,b){g.B.call(this);
var N=this;this.S=k;this.api=U;this.ye=D;this.Ft=b;this.N=new g.gS;this.W=new g.Ec(function(){N.Z&&N.Z.transferState==="TRANSFER_STATE_TRANSFERRING"&&N.N.U$()&&((N.Z.transferRetryCount||0)<3?Tg(N.B,N.K,!1,!1):xY(N.B,N.K.videoDetails.videoId),N.Sl("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.dP=this.L2=0;this.D=this.V=!1;this.zV=g.nP(this.api.T().experiments,"html5_transfer_processing_logs_interval");this.Bg=new g.JI(this);this.dg={fc2:function(){return N.W},
b8V:function(){return N.Ft},
MB:function(){return N.N}};
this.jw=this.S.observe(this.Tq.bind(this));this.B=new nf9(U,this);this.O4=new DaI(U);this.Wg=new B_(this.S);this.tQ=this.N.listen("publicytnetworkstatus-online",this.pN.bind(this));this.U4=this.N.listen("publicytnetworkstatus-offline",this.WUg.bind(this));this.D=this.api.T().U("html5_less_transfer_processing_logs");g.Y(this,this.Bg);this.Bg.G(U,"offlinetransferpause",this.X6I);g.$8(this.api.T())?this.j="mainVideoDownloadStateEntity":g.Cz(this.api.T())&&(this.j="musicTrackDownloadMetadataEntity")},
E_B=function(k){return g.O(function(U){if(U.Z==1)U=g.q(U,urB(),2);
else{var D=k.Wg;var b=g.Wh();b=Object.keys(b);D=HNz(D,b);U=g.q(U,D,0)}return U})},JO=function(k,U){U=U===void 0?!1:U;
var D;return g.O(function(b){if(b.Z==1){if(k.Z)throw Error("Already downloading a video");k.dP=0;k.V=!1;return g.q(b,Iw9(k),2)}return b.Z!=4?(D=b.S,P66(k.ye,!D),D&&k.N.U$()?U?g.q(b,new Promise(function(N){g.Xa(N,1E3)}),4):b.Xt(4):(!D&&k.Z&&YY(k),b.Xt(0))):g.q(b,GfB(k,D),0)})},KRL=function(k){return g.O(function(U){if(U.Z==1)return k.K?g.q(U,xY(k.B,k.K.videoDetails.videoId),3):U.Xt(0);
YY(k);g.mI(U)})},P19=function(k,U){var D,b,N;
return g.O(function(H){switch(H.Z){case 1:return g.jh(H,2),(D=!!U.captionTracks.length||!!U.Qy)?g.q(H,N9L(U.videoId),4):H.return();case 4:return(b=H.S)?H.return():g.q(H,bNB(k.O4,U),5);case 5:g.io(H,0);break;case 2:N=g.zY(H),ND("Caption downloading error",N,U.cotn),g.mI(H)}})},GfB=function(k,U){var D,b,N,H,F,p;
return g.O(function(c){switch(c.Z){case 1:if(k.V)return c.return();k.V=!0;k.Z=U;D=g.sy(k.Z.key);b=D.entityId;N=void 0;if(k.Z.transferState==="TRANSFER_STATE_TRANSFERRING")return g.q(c,u7(k,b),7);if(k.Z.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||k.Z.transferRetryCount||k.Z.hasLoggedFirstStarted){c.Xt(3);break}return g.q(c,u7(k,b),5);case 5:return N=c.S,k.Z.hasLoggedFirstStarted=!0,g.q(c,sIF(k),6);case 6:sDv({videoId:b,dT:k.Z,offlineModeType:N},void 0,void 0,!0);c.Xt(3);break;case 7:N=c.S,
pu({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:b,dT:k.Z,offlineModeType:N});case 3:return g.q(c,o_Y(k),8);case 8:return H=null,g.jh(c,9),g.q(c,VtR(k,U),11);case 11:H=c.S;k.K=H;g.io(c,10);break;case 9:return F=g.zY(c),ND("error getting player response",F,U.cotn),g.q(c,k.Sl("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return c.return();case 10:return p=i6Y(k.api.T(),U.cotn,H),g.q(c,P19(k,p),13);case 13:return g.q(c,zCr(p.videoId),
14);case 14:p.PB=c.S,W$B(k.B,p,U.maximumDownloadQuality),k.W.start(108E5),g.mI(c)}})},Iw9=function(k){var U,D;
return g.O(function(b){if(b.Z==1)return g.q(b,y2(k.S,"transfer"),2);U=b.S;D=U.filter(maB).sort(jIB);return D.length===0?b.return():b.return(D[0])})},o_Y=function(k){var U,D,b;
return g.O(function(N){if(N.Z==1){if(!k.Z)return l7(k,"onTransferStart"),N.return();k.W.start(108E5);return g.q(N,rM(k,"TRANSFER_STATE_TRANSFERRING"),2)}U=k.Z;return(b=((D=U)==null?0:D.key)?g.sy(U.key).entityId:"")&&k.j?g.q(N,Ku(b,k.j,k.S,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):N.Xt(0)})},auB=function(k){var U,D,b,N;
g.O(function(H){switch(H.Z){case 1:if(!k.Z){l7(k,"onTransferPausedByUser");H.Xt(2);break}U=k.Z;k.W.stop();return g.q(H,rM(k,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:b=((D=U)==null?0:D.key)?g.sy(U.key).entityId:"";if(!b||!k.j){H.Xt(4);break}return g.q(H,Ku(b,k.j,k.S,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.q(H,u7(k,b),6);case 6:N=H.S,ojr({videoId:b,dT:U,offlineModeType:N});case 2:YY(k),JO(k),g.mI(H)}})},wjF=function(k){var U,D,b;
g.O(function(N){if(N.Z==1){if(!k.Z)return l7(k,"onTransferPausedByNetwork"),N.return();k.W.stop();return g.q(N,rM(k,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(N.Z!=3)return U=k.Z,(b=((D=U)==null?0:D.key)?g.sy(U.key).entityId:"")&&k.j?g.q(N,Ku(b,k.j,k.S,"DOWNLOAD_STATE_PAUSED"),3):N.Xt(3);YY(k);g.mI(N)})},n_B=function(k){var U,D,b,N,H;
g.O(function(F){switch(F.Z){case 1:if(!k.Z)return l7(k,"onTransferComplete"),F.return();U=k.Z;k.W.stop();if(!U||!k.K){F.Xt(2);break}D=i6Y(k.api.T(),U.cotn,k.K);return g.q(F,P19(k,D),2);case 2:return g.q(F,rM(k,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:N=((b=U)==null?0:b.key)?g.sy(U.key).entityId:"";if(!N||!k.j){F.Xt(5);break}return g.q(F,Ku(N,k.j,k.S,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.q(F,p5r(k.S,N),7);case 7:return g.q(F,u7(k,N),8);case 8:H=F.S,pu({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:N,dT:U,offlineModeType:H}),YY(k),JO(k),g.mI(F)}})},iN9=function(k,U,D){var b,N;
g.O(function(H){switch(H.Z){case 1:if(!k.Z)return l7(k,"onTransferProgress: "+U),H.return();if(k.Z.transferState==="TRANSFER_STATE_TRANSFERRING"){H.Xt(2);break}return g.q(H,o_Y(k),2);case 2:b=Date.now();if(!(b-k.L2>1E3)){H.Xt(4);break}k.L2=b;return g.q(H,AFz(k.S,D.videoId,D.S,D.k9,D.bytesDownloaded,D.Z),5);case 5:if(k.D&&!(k.D&&b-k.dP>k.zV)){H.Xt(4);break}k.dP=b;return g.q(H,u7(k,U),7);case 7:N=H.S,sDv({videoId:U,dT:k.Z,offlineModeType:N},D.bytesDownloaded,D.Z);case 4:k.W.start(108E5),g.mI(H)}})},
zyG=function(k){var U=(k.Z.transferRetryCount||0)<3;
U&&(k=k.Z,k.transferRetryCount=(k.transferRetryCount||0)+1);return U},ZNB=function(k,U){U=U===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":U;
var D,b,N,H;return g.O(function(F){if(F.Z==1)return k.Z||l7(k,"setTransferToFailed: "+U),D="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",U==="TRANSFER_FAILURE_REASON_NETWORK"?D="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":U==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(D="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.q(F,rM(k,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",U),2);if(F.Z!=3)return gM(k.Ft,{entityKey:(b=k.Z)==null?void 0:b.key,failureReason:D}),
N=k.Z?g.sy(k.Z.key).entityId:"",g.q(F,u7(k,N),3);H=F.S;var p={videoId:N,dT:k.Z,offlineModeType:H},c=U,E={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};c&&(E.transferFailureReason=c,E.failureReason=Vo6(c));pu(E,p);g.mI(F)})},rM=function(k,U,D,b){var N;
return g.O(function(H){if(H.Z==1){if(!k.Z)return l7(k,"saveTransferState: "+U),H.return();k.Z.transferState=U;k.Z.failureReason=b;g.jh(H,2);return g.q(H,sIF(k,function(F){return D?ua(F,"offlineVideoStreams",k.Z.offlineVideoStreams).then(function(p){for(var c=g.z(p),E=c.next();!E.done;E=c.next())if((E=E.value)&&E.streamsProgress){E=g.z(E.streamsProgress);for(var I=E.next();!I.done;I=E.next())I.value.streamState=D}return zTB(F,p.filter(function(G){return!!G}),"offlineVideoStreams")}):g.Ls.resolve(void 0)}),
4)}if(H.Z!=2)return g.io(H,0);
N=g.zY(H);return N instanceof g.Xx&&N.type==="QUOTA_EXCEEDED"?g.q(H,k.Sl("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):H.Xt(0)})},sIF=function(k,U){var D;
return g.O(function(b){if(!k.Z)return b.return();D=k.Z;return g.q(b,$1(k.S,{mode:"readwrite",mV:!0},function(N){var H=[r4(N,D,"transfer")];U&&H.push(U(N));return g.Ls.all(H)}),0)})},YY=function(k){k.Z=void 0;
k.K=void 0;k.W.stop()},VtR=function(k,U){var D,b,N,H,F;
return g.O(function(p){if(p.Z==1)return D=g.sy(U.key),b=D.entityId,N=g.oY(b,"playbackData"),g.q(p,vc(k.S,N,"playbackData"),2);H=p.S;if((F=H)==null?0:F.playerResponseJson)return p.return(JSON.parse(H.playerResponseJson));throw Error("No PlayerResponse found");})},l7=function(k,U){k.api.Iu("woffle",{mcte:U});
ND("missing current transfer entity.")},u7=function(k,U){var D,b,N;
return g.O(function(H){if(H.Z==1)return g.q(H,vc(k.S,g.oY(U,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);D=H.S;return H.return((N=(b=D)==null?void 0:b.offlineModeType)!=null?N:void 0)})},maB=function(k){return aw6[k.transferState]!==void 0},jIB=function(k,U){var D=aw6[k.transferState],b=aw6[U.transferState];
return D!==b?D-b:Number(k.enqueuedTimestampMs)-Number(U.enqueuedTimestampMs)},Sv=function(k,U){var D=this;
this.ZN=k;this.api=U;this.N=new g.gS;this.K=new g.MF;this.dg={Yy:function(){return D.j.dg.Yy()},
MB:function(){return D.N},
mkt:function(){return D.j},
XR:function(){return D.XR()},
i7:function(){return D.i7()},
R$:function(){return D.R$()},
S5:function(){return D.S5()},
dL:function(){return D.dL()},
Hc:function(b){return D.Hc(b)}};
this.j=new Ejz(function(){return w56(D)},function(){D.R$()},this.api.e$(),this.api.U.bind(this.api));
this.Z=new H_(this.api);I7c(this.j)},w56=function(k){return g.O(function(U){k.api.f2("onOrchestrationBecameLeader");
return g.q(U,k.i7(),0)})},MtG=function(k){var U,D;
return g.O(function(b){if(b.Z==1)return g.q(b,kY(),2);if(b.Z!=3){U=b.S;if(!U)return ND("PES is undefined"),b.return();k.S=new cFz(U,k.api,k.j,k.Z);D=k.lR(U);return g.q(b,luG(U,D,k.j,k.Z,k.ZN),3)}k.B=b.S;return g.q(b,WR9(k),0)})},WR9=function(k){var U;
return g.O(function(D){switch(D.Z){case 1:if(!k.S)return ND("transferManager is undefined"),D.return();if(k.S.Z){D.Xt(2);break}return g.q(D,JO(k.S),2);case 2:if(!k.ZN.U("woffle_enable_main_downloads_library")){D.Xt(4);break}return g.q(D,k.p4(),4);case 4:if(!k.ZN.U("html5_offline_playback_position_sync")){D.Xt(6);break}return g.q(D,k.nA(),7);case 7:return g.q(D,k.Hc(864E5),6);case 6:return g.q(D,k.refreshAllStaleEntities(43200,!0),9);case 9:return g.q(D,k.Tf(),10);case 10:if(!k.ZN.U("html5_retry_downloads_for_expiration")){D.Xt(11);
break}return g.q(D,k.dL(),11);case 11:return k.V=g.dy(function(){k.refreshAllStaleEntities(43200,!0);k.Tf()},9E5),g.ES(g.GA(),function(){return k.S5()}),g.q(D,kY(),13);
case 13:return U=D.S,g.q(D,cfL(U),14);case 14:GCc(k.j),g.mI(D)}})},X5Y=function(){var k,U,D,b,N,H;
return g.O(function(F){switch(F.Z){case 1:return g.q(F,kY(),2);case 2:k=F.S;if(!k)return F.return([]);U=Date.now()/1E3;return g.q(F,y2(k,"offlineVideoPolicy"),3);case 3:D=F.S,b=g.z(D),N=b.next();case 4:if(N.done){F.Xt(6);break}H=N.value;if(!(H.expirationTimestamp&&Number(H.expirationTimestamp)<U)){F.Xt(5);break}H.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";H.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.q(F,Ro(k,H,"offlineVideoPolicy"),5);
case 5:N=b.next();F.Xt(4);break;case 6:return F.return(D.map(function(p){return p.key}))}})},Cu=function(k,U,D,b,N){var H,F,p;
return g.O(function(c){if(c.Z==1)return g.q(c,kY(),2);H=c.S;if(!H)return c.return([]);F=U.map(function(E){var I=g.oY(E,D);I={actionType:b,entityKey:I,actionMetadata:Object.assign({},zfv(),N)};b!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(I.actionMetadata.priority=0);E=new V$(D,E,I);return jv(E)});
p=qqz(H,F);I7c(k.j);return c.return(p)})},da9=function(k,U,D,b){var N,H,F,p,c,E,I,G;
return g.O(function(K){switch(K.Z){case 1:N=[],H=g.z(U),F=H.next();case 2:if(F.done){K.Xt(4);break}p=F.value;if(p.upToDate||D&&!p.shouldAutoSyncMetadata||!p.playlistId){K.Xt(3);break}c={};switch(b){case "mainPlaylistEntity":E={nextAutoRefreshIntervalSeconds:p.checkInSeconds,autoSync:D};c={mainPlaylistEntityActionMetadata:E};break;case "musicPlaylist":I={autoSync:D},c={musicPlaylistEntityActionMetadata:I}}return g.q(K,Cu(k,[p.playlistId],b,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",c),6);case 6:(G=
K.S)&&N.push.apply(N,g.a(G));case 3:F=H.next();K.Xt(2);break;case 4:return K.return(N)}})},fwB=function(k,U){var D;
return g.O(function(b){return U.length?(D=zfv(),g.RR(D,Q$,{isEnqueuedForExpiredStreamUrlRefetch:!0}),k.api.Iu("qrd",{v:U.length}),b.return(Cu(k,U,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",D))):b.return([])})},q69=function(k,U,D){this.Z=k;
this.ZN=U;this.j=D},QI6=function(k,U){var D,b,N,H,F,p,c,E,I,G,K,P,V,Z,w,M,d;
return g.O(function(t){switch(t.Z){case 1:return D=c_(U),b=g.sy(U.entityKey),N=b.entityId,H=[],g.jh(t,2),g.q(t,ttr(k,N),4);case 4:H=t.S;if(!(k.ZN.U("woffle_enable_main_downloads_library")&&((F=H)==null?0:F.length))){t.Xt(5);break}return g.q(t,Lo6(k.Z,[U.entityKey]),5);case 5:g.io(t,3);break;case 2:return p=g.zY(t),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",p instanceof g.Xx&&p.type==="QUOTA_EXCEEDED"?(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):ND("Playlist add error"),t.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,c,E));case 3:I=[];if(!k.ZN.U("html5_offline_prevent_redownload_downloaded_video")){t.Xt(7);break}return g.q(t,njG(k.Z,"mainVideoEntity",H),8);case 8:H=t.S;case 7:if((G=H)==null?0:G.length)for(K=g.z(H),P=K.next();!P.done;P=K.next())if(V=P.value,Z=V.offlineVideoData,w=void 0,(w=Z)==null?0:w.videoId)M=void 0,d=Number(((M=U.actionMetadata)==null?void 0:M.priority)||
0)+1,I.push(tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Z.videoId,"mainVideoEntity",d,hO,ONB(U,Z,N)));return t.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D,I))}})},xav=function(k,U){var D,b,N,H,F,p,c,E,I,G,K,P,V,Z,w,M,d,t,L,e,l,C,N9,Fv,kU,u,R,n,r,yW,n9,Ur,W9,$U,b9,sr,W,X,f,Q,T,Dh,H9,g0,x,E5,s5,pY,fY,GZ,Bz,GW,lo,TW,EV,tr,SV,KK,Jb,en,uu,iu,Pr,Qu,I9,L3,B6,YR,fi,Rs,lu,Nq,Xq,hc;
return g.O(function(KM){switch(KM.Z){case 1:return D=c_(U),b=U.entityKey,N=g.sy(b).entityId,H=[],F=!1,N==="!*$_ALL_ENTITIES_!*$"?(F=!0,g.q(KM,y2(k.Z,"mainPlaylistEntity"),5)):g.q(KM,vc(k.Z,b,"mainPlaylistEntity"),4);case 4:(p=KM.S)&&H.push(p);KM.Xt(3);break;case 5:H=KM.S;case 3:if((c=H)==null||!c.length)return KM.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D));E=g.J(U.actionMetadata,LRc);G=(I=E)==null?void 0:I.nextAutoRefreshIntervalSeconds;P=(K=E)==null?void 0:K.autoSync;V=[];w=Z=
!0;M=!1;if(!F&&P===!1){KM.Xt(6);break}g.jh(KM,7);return g.q(KM,RfL(0,!!P,!0,H),9);case 9:V=KM.S;g.io(KM,8);break;case 7:d=g.zY(KM);if(!(d instanceof Error&&d.message==="No data")){d instanceof Error&&d.message==="Empty response body"&&ND(d.message);KM.Xt(8);break}return N==="!*$_ALL_ENTITIES_!*$"?g.q(KM,dP9(k.Z,U,k.j,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.q(KM,MoF(N,k.Z,U,k.j),8);case 8:if(!V.length||!F&&V[0].playlistId!==N)return KM.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
D));case 6:if(F){t=[];L=g.z(V);for(e=L.next();!e.done;e=L.next())l=e.value,l.upToDate||P&&!l.shouldAutoSyncMetadata||!l.playlistId||(C={nextAutoRefreshIntervalSeconds:l.checkInSeconds,autoSync:P},t.push(tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",l.playlistId,"mainPlaylistEntity",0,hO,{mainPlaylistEntityActionMetadata:C})));return KM.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D,t))}V.length&&(N9=V[0],M=!!N9.upToDate,P&&(Z=(Fv=N9.shouldAutoSyncMetadata)!=null?Fv:!0,w=(kU=N9.shouldAutoSyncVideos)!=
null?kU:!0,N9.checkInSeconds&&(G=N9.checkInSeconds)));if(M||!Z)return KM.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D));u=[];R=H[0];if(!R.downloadState){n=void 0;KM.Xt(15);break}return g.q(KM,vc(k.Z,R.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:n=KM.S;case 15:return r=n,n9=((yW=r)==null?0:yW.addedTimestampMillis)?String(r.addedTimestampMillis):void 0,g.jh(KM,17),g.q(KM,ttr(k,N,n9,G),19);case 19:u=KM.S;g.io(KM,18);break;case 17:Ur=g.zY(KM);if(!(Ur instanceof Error&&
Ur.message==="No data for playlist")){if(Ur instanceof Error&&Ur.message==="Empty response body for playlist")ND(Ur.message);else return W9="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",$U="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Ur instanceof g.Xx&&Ur.type==="QUOTA_EXCEEDED"&&(W9="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",$U="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),KM.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,W9,$U));KM.Xt(18);
break}return g.q(KM,MoF(N,k.Z,U,k.j),18);case 18:if(!w)return KM.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D));b9=[];sr=new Map;if((W=u)==null?0:W.length)for(X=g.z(u),f=X.next();!f.done;f=X.next())Q=f.value,T=Q.offlineVideoData,Dh=void 0,((Dh=T)==null?0:Dh.videoId)&&sr.set(T.videoId,T);H9=new Map;g0=[];if((x=R)==null?0:(E5=x.videos)==null?0:E5.length)for(s5=g.z(R.videos),pY=s5.next();!pY.done;pY=s5.next())if(fY=pY.value,GZ=JSON.parse(g.sy(fY).entityId),Bz=GZ.videoId)sr.has(Bz)?(H9.set(Bz,
sr.get(Bz)),sr.delete(Bz)):g0.push(Bz);lo=Number(((GW=U.actionMetadata)==null?void 0:GW.priority)||0)+1;TW=g.z(sr.entries());for(EV=TW.next();!EV.done;EV=TW.next())tr=EV.value,SV=g.z(tr),KK=SV.next().value,Jb=SV.next().value,en=KK,uu=Jb,b9.push(tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",en,"mainVideoEntity",lo,hO,ONB(U,uu,N)));iu=g.z(H9.entries());for(Pr=iu.next();!Pr.done;Pr=iu.next())Qu=Pr.value,I9=g.z(Qu),L3=I9.next().value,B6=I9.next().value,YR=L3,fi=B6,b9.push(tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
YR,"mainVideoEntity",lo,hO,ONB(U,fi,N)));Rs=g.z(g0);for(lu=Rs.next();!lu.done;lu=Rs.next())Nq=lu.value,Xq={playlistId:N},hc={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Xq},b9.push(tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Nq,"mainVideoEntity",0,hO,hc));return KM.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D,b9))}})},T9r=function(k,U){var D,b,N,H;
return g.O(function(F){switch(F.Z){case 1:return D=c_(U),g.jh(F,2),b=g.sy(U.entityKey).entityId,b==="!*$_ALL_ENTITIES_!*$"?g.q(F,dP9(k.Z,U,k.j,(N=U.actionMetadata)==null?void 0:(H=N.offlineLoggingData)==null?void 0:H.offlineDeleteReason),5):g.q(F,MoF(b,k.Z,U,k.j),6);case 6:if(!k.ZN.U("woffle_enable_main_downloads_library")){F.Xt(5);break}return g.q(F,xPc(k.Z,U.entityKey),5);case 5:g.io(F,3);break;case 2:return g.zY(F),F.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return F.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D))}})},ttr=function(k,U,D,b){var N,H,F,p,c,E,I;
return g.O(function(G){switch(G.Z){case 1:return g.q(G,hfL([U]),2);case 2:return N=G.S,g.q(G,eyB(k,N[0],D,b),3);case 3:return H=G.S,F=H.mainPlaylistEntity,p=H.bxC,E=wsv(F,(c=p)==null?void 0:c.avatar),g.jh(G,4),g.q(G,i7(E),6);case 6:g.io(G,5);break;case 4:I=g.zY(G),I instanceof Error&&I.message==="Failed to fetch"&&ND(I.message);case 5:return G.return(N[0].videos)}})},eyB=function(k,U,D,b){var N,H,F,p,c,E,I,G,K,P,V,Z,w,M,d,t,L;
return g.O(function(e){switch(e.Z){case 1:N=Date.now().toString();D||(D=N);H=U.videos;F=U.playlistId;p=[];c=[];if(H)for(E=g.z(H),I=E.next();!I.done;I=E.next()){G=I.value;K=G.offlineVideoData;if(!K||!K.videoId)throw ND("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");P=K.videoId;V={videoId:P,playlistId:F};Z={id:g.oY(JSON.stringify(V),"mainPlaylistVideoEntity"),video:g.oY(P,"mainVideoEntity")};p.push(Z);c.push(Z.id)}M={key:g.oY(F,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:D,lastSyncedTimestampMillis:N};d={key:g.oY(F,"mainPlaylistEntity"),playlistId:F,videos:c,title:U.title,thumbnailStyleData:B9Z(U),visibility:Y6c(U),downloadState:M.key};U.channel&&(t=U.channel.offlineChannelData,w=JFz(g.oY(F,"ytMainChannelEntity"),t),d.channelOwner=w.id);((L=d)==null?0:L.entityMetadata)?(d.entityMetadata.offlineLastModifiedTimestampSeconds=U.lastModifiedTimestamp,b&&(d.entityMetadata.nextAutoRefreshIntervalSeconds=String(b))):d&&(d.entityMetadata={nextAutoRefreshIntervalSeconds:b?
String(b):void 0,offlineLastModifiedTimestampSeconds:U.lastModifiedTimestamp});g.jh(e,2);return g.q(e,$1(k.Z,{mode:"readwrite",mV:!0},function(l){var C=r4(l,d,"mainPlaylistEntity"),N9=r4(l,M,"mainPlaylistDownloadStateEntity");C=[C,N9];N9=g.z(p);for(var Fv=N9.next();!Fv.done;Fv=N9.next())C.push(r4(l,Fv.value,"mainPlaylistVideoEntity"));w&&C.push(r4(l,w,"ytMainChannelEntity"));return g.Ls.all(C)}),4);
case 4:g.io(e,3);break;case 2:throw g.zY(e),ND("PES failure for playlist"),Error("PES failure for playlist");case 3:return e.return({mainPlaylistEntity:d,bxC:w,kk4:p})}})},JFz=function(k,U){return{id:k,
channelId:U.channelId,title:U.title,avatar:U.thumbnail}},B9Z=function(k){var U=[],D=k.videos;
D&&D.length>0&&U.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:D[0].offlineVideoData.thumbnail}}});if((k=k.additionalMetadadatas)&&k.length>0)for(k=g.z(k),D=k.next();!D.done;D=k.next()){var b=D.value.offlineBundleItemPlaylistData,N=void 0;D=(N=b)==null?void 0:N.style;N=void 0;b={collageThumbnail:{coverThumbnail:(N=b)==null?void 0:N.coverThumbnail}};switch(D){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":U.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:b});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":U.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:b});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":U.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:b});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":U.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:b})}}return U},Y6c=function(k){switch(k.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},ONB=function(k,U,D){U={offlineVideoData:U,
playlistId:D};if(k=g.J(k.actionMetadata,LRc))U.maximumDownloadQuality=k.maximumDownloadQuality;return{mainVideoEntityActionMetadata:U}},uq9=function(k,U,D){this.Z=k;
this.ZN=U;this.j=D},S6B=function(k,U){var D,b,N,H,F,p,c,E,I,G,K,P,V;
return g.O(function(Z){switch(Z.Z){case 1:return D=c_(U),b=g.sy(U.entityKey),N=b.entityId,H=g.J(U.actionMetadata,$Y),p=!((F=H)==null?0:F.playlistId),g.jh(Z,2),g.q(Z,lwz(k,N,void 0,(c=H)==null?void 0:c.offlineVideoData,p),4);case 4:g.io(Z,3);break;case 2:return E=g.zY(Z),I="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.Xx&&E.type==="QUOTA_EXCEEDED"&&(I="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Z.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,I,G));case 3:K=1;K=Number(((P=U.actionMetadata)==null?void 0:P.priority)||0)+1;var w=(w=g.J(U.actionMetadata,$Y))?{playbackDataActionMetadata:{maximumDownloadQuality:w.maximumDownloadQuality}}:void 0;V=tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",N,"playbackData",K,rF9,w);return Z.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D,[V]))}})},C1z=function(k,U){var D,b,N,H,F,p,c,E,I,G,K,P,V,Z,w,M,d;
return g.O(function(t){switch(t.Z){case 1:return D=c_(U),b=g.sy(U.entityKey),N=b.entityId,g.q(t,vc(k.Z,U.entityKey,"mainVideoEntity"),2);case 2:H=t.S;if(!H){F=void 0;t.Xt(3);break}return g.q(t,vc(k.Z,H.downloadState,"mainVideoDownloadStateEntity"),4);case 4:F=t.S;case 3:p=F;if(!H||!p)return t.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D));g.jh(t,5);return g.q(t,lwz(k,N,p.addedTimestampMillis,(E=g.J(U.actionMetadata,$Y))==null?void 0:E.offlineVideoData),7);case 7:I=1;I=Number(((G=
U.actionMetadata)==null?void 0:G.priority)||0)+1;c=tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",N,"playbackData",I,rF9);g.io(t,6);break;case 5:K=g.zY(t);if(!(K instanceof Error&&K.message==="No data")){if(K instanceof Error&&K.message==="Empty response body")ND(K.message);else return P="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",K instanceof g.Xx&&K.type==="QUOTA_EXCEEDED"&&(P="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
V="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),t.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,P,V));t.Xt(6);break}return g.q(t,a3(k.Z,N),9);case 9:Z=t.S;w=g.J(U.actionMetadata,$Y);if(d=(M=w)==null?void 0:M.playlistId)Z.playlistId=d;Z.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.q(t,zg(N,k.Z,U,k.j,Z),6);case 6:return t.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D,c?[c]:void 0))}})},hyv=function(k,U){var D,b,N,H,F,p,c,E,I,G;
return g.O(function(K){switch(K.Z){case 1:return D=c_(U),g.jh(K,2),b=g.sy(U.entityKey).entityId,b==="!*$_ALL_ENTITIES_!*$"?g.q(K,dP9(k.Z,U,k.j,(I=U.actionMetadata)==null?void 0:(G=I.offlineLoggingData)==null?void 0:G.offlineDeleteReason),5):g.q(K,a3(k.Z,b),6);case 6:N=K.S;H=g.J(U.actionMetadata,$Y);if(p=(F=H)==null?void 0:F.playlistId)N.playlistId=p;N.offlineDeleteReason=(c=U.actionMetadata)==null?void 0:(E=c.offlineLoggingData)==null?void 0:E.offlineDeleteReason;return g.q(K,zg(b,k.Z,U,k.j,N),7);
case 7:if(!k.ZN.U("woffle_enable_main_downloads_library")){K.Xt(5);break}return g.q(K,xPc(k.Z,U.entityKey),5);case 5:g.io(K,3);break;case 2:return g.zY(K),K.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return K.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D))}})},lwz=function(k,U,D,b,N){var H,F,p,c,E,I;
return g.O(function(G){switch(G.Z){case 1:if(H=b){G.Xt(2);break}return g.q(G,C6B([U]),3);case 3:F=G.S,H=F[0];case 2:return g.q(G,$aI(k,H,D,N),4);case 4:p=G.S;c=p.mainVideoEntity;E=p.channelEntity;g.jh(G,5);var K=o3(c.thumbnail),P=o3(E.avatar);return g.q(G,i7(K.concat(P)),7);case 7:g.io(G,0);break;case 5:I=g.zY(G),I instanceof Error&&I.message==="Failed to fetch"&&ND(I.message),g.mI(G)}})},$aI=function(k,U,D,b){var N,H,F,p,c,E,I,G,K,P,V,Z,w;
return g.O(function(M){switch(M.Z){case 1:D||(D=Date.now().toString());H=(N=U.channel)==null?void 0:N.offlineChannelData;F={id:g.oY(U.videoId,"ytMainChannelEntity"),channelId:H.channelId,title:H.title,avatar:H.thumbnail};p={key:g.oY(U.videoId,"mainVideoDownloadStateEntity"),playbackData:g.oY(U.videoId,"playbackData"),addedTimestampMillis:D,videoDownloadContextEntity:g.oY(U.videoId,"videoDownloadContextEntity")};c={key:g.oY(U.videoId,"videoPlaybackPositionEntity"),videoId:U.videoId,lastPlaybackPositionSeconds:"0"};
k.ZN.U("html5_offline_playback_position_sync")&&(E={playbackPosition:c.key});I=g.oY(U.videoId,"mainVideoEntity");G={key:I,videoId:U.videoId,title:U.title,thumbnail:U.thumbnail,localizedStrings:{viewCount:U.shortViewCountText},userState:E,lengthSeconds:U.lengthSeconds?Number(U.lengthSeconds):void 0,publishedTimestampMillis:U.publishedTimestamp?(Number(U.publishedTimestamp)*1E3).toString():void 0,formattedDescription:U.description,owner:F.id,downloadState:p.key};if(!k.ZN.U("woffle_enable_main_downloads_library")||
!b){M.Xt(2);break}return g.q(M,QD6(k.Z,[I]),3);case 3:if(V=M.S)K=V.mainDownloadsLibraryEntity,P=V.mainDownloadsListEntity;case 2:return w=jDc,Z={key:g.oY(U.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.RR(p,w,Z),g.q(M,$1(k.Z,{mode:"readwrite",mV:!0},function(d){var t=r4(d,F,"ytMainChannelEntity"),L=r4(d,p,"mainVideoDownloadStateEntity"),e=r4(d,G,"mainVideoEntity");t=[t,L,e];k.ZN.U("html5_offline_playback_position_sync")&&(L=r4(d,c,"videoPlaybackPositionEntity"),
t.push(L));K&&(L=r4(d,K,"mainDownloadsLibraryEntity"),t.push(L));P&&(L=r4(d,P,"mainDownloadsListEntity"),t.push(L));Z&&(d=r4(d,Z,"downloadStatusEntity"),t.push(d));return g.Ls.all(t)}),4);
case 4:return M.return({mainVideoEntity:G,channelEntity:F})}})},Ryv=function(k,U,D){this.Z=k;
this.ZN=U;this.j=D},yFz=function(k,U){var D,b,N,H,F,p,c,E,I,G,K,P,V,Z,w,M,d,t,L,e,l,C,N9,Fv,kU,u,R;
return g.O(function(n){switch(n.Z){case 1:return D=c_(U),b=[],g.q(n,eX.getInstance(),2);case 2:N=n.S;if(!N){n.Xt(3);break}return g.q(n,N.get("sdois"),4);case 4:return H=n.S,g.q(n,(p=N)==null?void 0:p.get("lmqf"),5);case 5:F=n.S;case 3:g.jh(n,6);if(H===void 0)throw Error("prefStorage or opt-in state is undefined");c=[];if(H){n.Xt(8);break}return g.q(n,O69(k.Z),9);case 9:c=n.S,c.reverse();case 8:if(!c.length){n.Xt(10);break}E=g.z(c);I=E.next();case 11:if(I.done){n.Xt(10);break}G=I.value;if(!G){n.Xt(12);
break}K=g.sy(G).entityId;return g.q(n,a3(k.Z,K),14);case 14:return P=n.S,P.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.q(n,zg(K,k.Z,{entityKey:G,actionType:U.actionType},k.j,P),12);case 12:I=E.next();n.Xt(11);break;case 10:return g.q(n,yf9(H,(V=F)!=null?V:"SD"),16);case 16:return Z=n.S,g.q(n,f79(Z),17);case 17:w=toz(Z);if(!k.ZN.U("woffle_enable_main_downloads_library")){n.Xt(18);break}if(H){n.Xt(19);break}return g.q(n,xPc(k.Z,g.Q7),19);case 19:return g.q(n,Lo6(k.Z,[g.Q7]),18);
case 18:if((M=w)==null?0:M.length)for(d=g.z(w),t=d.next();!t.done;t=d.next())if(e=L=t.value,l=e.actionType,C=e.entityKey,N9=e.actionMetadata,l&&C&&N9&&!g.J(N9,v_G)){l==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(N9.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Fv=g.J(L.actionMetadata,$Y))Fv.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",L.actionMetadata=Object.assign({},L.actionMetadata,{mainVideoEntityActionMetadata:Fv});b.push(L)}g.io(n,7);break;
case 6:return kU=g.zY(n),u="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",R="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",kU instanceof g.Xx&&kU.type==="QUOTA_EXCEEDED"&&(u="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",R="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),n.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,u,R));case 7:return n.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D,b))}})},klZ=function(){Sv.apply(this,arguments);
this.D="mainVideoEntity"},UQR=function(k,U,D){U=U===void 0?43200:U;
D=D===void 0?!0:D;var b=b===void 0?!1:b;var N,H,F;return g.O(function(p){switch(p.Z){case 1:if(!k.N.U$())return p.return([]);N=[];g.jh(p,2);return g.q(p,RfL(U,D,b),4);case 4:N=p.S;g.io(p,3);break;case 2:H=g.zY(p),H instanceof Error&&H.message==="No data"||H instanceof Error&&H.message==="Empty response body"&&ND(H.message);case 3:return F=da9(k,N,D,"mainPlaylistEntity"),p.return(F)}})},DQF=function(k,U,D,b){b=b===void 0?!1:b;
var N,H,F,p,c,E,I,G,K,P,V,Z,w,M,d;return g.O(function(t){switch(t.Z){case 1:return N=[],g.q(t,vjr(),2);case 2:return(H=t.S)||b?g.q(t,ktB(U,D),3):t.return([]);case 3:F=t.S;if((p=F)==null||!p.length)return t.return([]);c={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};E=g.z(F);I=E.next();case 4:if(I.done){t.Xt(6);break}K=G=I.value;P=K.actionType;V=K.entityKey;Z=K.actionMetadata;if(!(P&&V&&Z)||g.J(Z,v_G)){t.Xt(5);break}P==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Z.offlineLoggingData=
c);w=g.sy(V);M=w.entityId;return g.q(t,Cu(k,[M],"mainVideoEntity",P,Z),8);case 8:d=t.S,N=N.concat(d);case 5:I=E.next();t.Xt(4);break;case 6:return t.return(N)}})},bCR=function(k,U){this.Z=k;
this.j=U},HCc=function(k,U){var D,b,N,H,F,p,c,E,I,G,K,P,V,Z,w,M;
return g.O(function(d){switch(d.Z){case 1:return D=c_(U),b=g.sy(U.entityKey),N=b.entityId,H=[],g.jh(d,2),g.q(d,N5L(k,N),4);case 4:H=d.S;if((F=H)==null||!F.length){d.Xt(5);break}return g.q(d,JfZ(k.Z,U.entityKey),5);case 5:g.io(d,3);break;case 2:return p=g.zY(d),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",p instanceof g.Xx&&p.type==="QUOTA_EXCEEDED"&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
d.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,c,E));case 3:return I=[],g.q(d,njG(k.Z,"musicTrack",H),7);case 7:H=d.S;if(H.length)for(G=g.z(H),K=G.next();!K.done;K=G.next())if(P=K.value,V=P.offlineVideoData,Z=void 0,(Z=V)==null?0:Z.videoId)w=void 0,M=Number(((w=U.actionMetadata)==null?void 0:w.priority)||0)+1,I.push(tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",V.videoId,"musicTrack",M,R3,XA(U,V,N)));return d.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D,I))}})},
gFG=function(k,U){var D,b,N,H,F,p,c,E,I,G,K,P,V,Z,w,M,d,t,L,e,l,C,N9,Fv,kU,u,R,n,r,yW,n9,Ur,W9,$U,b9,sr,W,X,f,Q,T,Dh,H9,g0,x,E5,s5,pY,fY,GZ,Bz,GW,lo,TW,EV,tr,SV,KK,Jb;
return g.O(function(en){switch(en.Z){case 1:return D=c_(U),b=U.entityKey,N=g.sy(b).entityId,H=[],F=!1,N==="!*$_ALL_ENTITIES_!*$"?(F=!0,g.q(en,y2(k.Z,"musicAlbumRelease"),5)):g.q(en,vc(k.Z,b,"musicAlbumRelease"),4);case 4:(p=en.S)&&H.push(p);en.Xt(3);break;case 5:H=en.S;case 3:if((c=H)==null||!c.length)return en.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D));if(F){E=[];I=g.z(H);for(G=I.next();!G.done;G=I.next())K=G.value,P=g.sy(K.id).entityId,E.push(tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
P,"musicAlbumRelease",0,R3));return en.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D,E))}V=[];Z=H[0];w=void 0;if(!Z.downloadMetadata){en.Xt(6);break}return g.q(en,vc(k.Z,Z.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:M=en.S,w=Number((t=(d=M)==null?void 0:d.addedTimestampMillis)!=null?t:"0")/1E3;case 6:return g.jh(en,8),g.q(en,N5L(k,N,(L=w)==null?void 0:L.toString()),10);case 10:V=en.S;g.io(en,9);break;case 8:e=g.zY(en);if(!(e instanceof Error&&e.message===
"No data")){if(e instanceof Error&&e.message==="Empty response body")ND(e.message);else return l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",e instanceof g.Xx&&e.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),en.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,l,C));en.Xt(9);break}return g.q(en,W_(N,"musicAlbumRelease",k.Z,
U,k.j),9);case 9:N9=[];Fv=new Map;if((kU=V)==null?0:kU.length)for(u=g.z(V),R=u.next();!R.done;R=u.next())n=R.value,r=n.offlineVideoData,yW=void 0,((yW=r)==null?0:yW.videoId)&&Fv.set(r.videoId,r);n9=new Map;Ur=[];if((W9=Z)==null?0:($U=W9.tracks)==null?0:$U.length)for(b9=g.z(Z.tracks),sr=b9.next();!sr.done;sr=b9.next())if(W=sr.value,X=g.sy(W).entityId)Fv.has(X)?(n9.set(X,Fv.get(X)),Fv.delete(X)):Ur.push(X);Q=Number(((f=U.actionMetadata)==null?void 0:f.priority)||0)+1;T=g.z(Fv.entries());for(Dh=T.next();!Dh.done;Dh=
T.next())H9=Dh.value,g0=g.z(H9),x=g0.next().value,E5=g0.next().value,s5=x,pY=E5,N9.push(tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",s5,"musicTrack",Q,R3,XA(U,pY)));fY=g.z(n9.entries());for(GZ=fY.next();!GZ.done;GZ=fY.next())Bz=GZ.value,GW=g.z(Bz),lo=GW.next().value,TW=GW.next().value,EV=lo,tr=TW,N9.push(tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",EV,"musicTrack",Q,R3,XA(U,tr)));SV=g.z(Ur);for(KK=SV.next();!KK.done;KK=SV.next())Jb=KK.value,N9.push(tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Jb,
"musicTrack",0,R3));return en.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D,N9))}})},FZG=function(k,U){var D,b;
return g.O(function(N){switch(N.Z){case 1:return D=c_(U),g.jh(N,2),b=g.sy(U.entityKey).entityId,b==="!*$_ALL_ENTITIES_!*$"?g.q(N,MD(k.Z,U,k.j),5):g.q(N,W_(b,"musicAlbumRelease",k.Z,U,k.j),6);case 6:return g.q(N,uFc(k.Z,U.entityKey),5);case 5:g.io(N,3);break;case 2:return g.zY(N),N.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return N.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
D))}})},N5L=function(k,U,D){var b,N,H;
return g.O(function(F){switch(F.Z){case 1:return g.q(F,hfL([U]),2);case 2:return b=F.S,g.q(F,ACB(k,b[0],D),3);case 3:return N=F.S,H=o3(N.thumbnailDetails),g.q(F,i7(H),4);case 4:return F.return(b[0].videos)}})},ACB=function(k,U,D){var b,N,H,F,p,c,E,I,G,K,P,V,Z,w;
return g.O(function(M){if(M.Z==1){b=U.additionalMetadadatas;N=void 0;if(b&&b.length>0)for(H=g.z(b),F=H.next();!F.done;F=H.next())if(p=F.value,p.offlineMusicPlaylistData){N=p.offlineMusicPlaylistData;break}c=U.playlistId;E=l7I(U);I=E.Y1;G=E.zU;K=D?(Number(D)*1E3).toString():Date.now().toString();P=U.lastModifiedTimestamp?(Number(U.lastModifiedTimestamp)*1E3).toString():"0";V={id:g.oY(c,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:G,lastModifiedTimestampMillis:P,addedTimestampMillis:K,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};Z={id:g.oY(c,"musicAlbumRelease"),title:U.title,audioPlaylistId:c,trackCount:U.totalVideoCount,tracks:I,downloadMetadata:V.id};N&&(Z.thumbnailDetails=(w=N.albumHqThumbnail)!=null?w:N.albumArtistThumbnail,Z.artistDisplayName=N.albumArtistDisplayName,Z.releaseDate=N.albumReleaseDate,Z.contentRating={explicitType:N.albumReleaseExplicitType},Z.releaseType=N.albumReleaseType);return g.q(M,$1(k.Z,{mode:"readwrite",mV:!0},function(d){var t=r4(d,Z,"musicAlbumRelease");
d=r4(d,V,"musicAlbumReleaseDownloadMetadataEntity");return g.Ls.all([t,d])}),2)}return M.return(Z)})},pq9=function(k,U){this.Z=k;
this.j=U},EFZ=function(k,U){var D,b,N,H,F,p,c,E,I,G,K,P,V,Z,w,M;
return g.O(function(d){switch(d.Z){case 1:return D=c_(U),b=g.sy(U.entityKey),N=b.entityId,H=[],g.jh(d,2),g.q(d,cC6(k,N),4);case 4:H=d.S;if((F=H)==null||!F.length){d.Xt(5);break}return g.q(d,JfZ(k.Z,U.entityKey),5);case 5:g.io(d,3);break;case 2:return p=g.zY(d),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",p instanceof g.Xx&&p.type==="QUOTA_EXCEEDED"&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
d.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,c,E));case 3:return I=[],g.q(d,njG(k.Z,"musicTrack",H),7);case 7:H=d.S;if(H.length)for(G=g.z(H),K=G.next();!K.done;K=G.next())if(P=K.value,V=P.offlineVideoData,Z=void 0,(Z=V)==null?0:Z.videoId)w=void 0,M=Number(((w=U.actionMetadata)==null?void 0:w.priority)||0)+1,I.push(tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",V.videoId,"musicTrack",M,v_,XA(U,V,N)));return d.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D,I))}})},
IgG=function(k,U){var D,b,N,H,F,p,c,E,I,G,K,P,V,Z,w,M,d,t,L,e,l,C,N9,Fv,kU,u,R,n,r,yW,n9,Ur,W9,$U,b9,sr,W,X,f,Q,T,Dh,H9,g0,x,E5,s5,pY,fY,GZ,Bz,GW,lo,TW,EV,tr,SV,KK,Jb,en,uu,iu,Pr,Qu,I9,L3,B6,YR,fi,Rs,lu;
return g.O(function(Nq){switch(Nq.Z){case 1:return D=c_(U),b=U.entityKey,N=g.sy(b).entityId,H=[],F=!1,N==="!*$_ALL_ENTITIES_!*$"?(F=!0,g.q(Nq,y2(k.Z,"musicPlaylist"),5)):g.q(Nq,vc(k.Z,b,"musicPlaylist"),4);case 4:(p=Nq.S)&&H.push(p);Nq.Xt(3);break;case 5:H=Nq.S;case 3:if((c=H)==null||!c.length)return Nq.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D));E=g.J(U.actionMetadata,rf9);G=(I=E)==null?void 0:I.autoSync;K=[];V=P=!0;Z=!1;w=void 0;if(!F&&G===!1){Nq.Xt(6);break}g.jh(Nq,7);return g.q(Nq,
UyZ(0,!!G,!0,H),9);case 9:K=Nq.S;g.io(Nq,8);break;case 7:M=g.zY(Nq);if(!(M instanceof Error&&M.message==="No data")){M instanceof Error&&M.message==="Empty response body"&&ND(M.message);Nq.Xt(8);break}return N==="!*$_ALL_ENTITIES_!*$"?g.q(Nq,MD(k.Z,U,k.j),8):g.q(Nq,W_(N,"musicPlaylist",k.Z,U,k.j),8);case 8:if(!K.length||!F&&K[0].playlistId!==N)return Nq.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D));case 6:if(F){d=[];t=g.z(K);for(L=t.next();!L.done;L=t.next())e=L.value,e.upToDate||
G&&!e.shouldAutoSyncMetadata||!e.playlistId||(l={autoSync:G},d.push(tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",e.playlistId,"musicPlaylist",0,v_,{musicPlaylistEntityActionMetadata:l})));return Nq.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D,d))}K.length&&(C=K[0],Z=!!C.upToDate,G&&(P=(N9=C.shouldAutoSyncMetadata)!=null?N9:!0,V=(Fv=C.shouldAutoSyncVideos)!=null?Fv:!0,C.checkInSeconds&&(w=C.checkInSeconds)));if(Z||!P)return Nq.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
D));kU=[];u=H[0];R=void 0;if(!u.downloadMetadata){Nq.Xt(15);break}return g.q(Nq,vc(k.Z,u.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:n=Nq.S,R=Number((yW=(r=n)==null?void 0:r.addedTimestampMillis)!=null?yW:"0")/1E3;case 15:return g.jh(Nq,17),g.q(Nq,cC6(k,N,(n9=R)==null?void 0:n9.toString(),w),19);case 19:kU=Nq.S;g.io(Nq,18);break;case 17:Ur=g.zY(Nq);if(!(Ur instanceof Error&&Ur.message==="No data")){if(Ur instanceof Error&&Ur.message==="Empty response body")ND(Ur.message);else return W9=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",$U="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Ur instanceof g.Xx&&Ur.type==="QUOTA_EXCEEDED"&&(W9="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",$U="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Nq.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,W9,$U));Nq.Xt(18);break}return g.q(Nq,W_(N,"musicPlaylist",k.Z,U,k.j),18);case 18:if(!V)return Nq.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
D));b9=[];sr=new Map;if((W=kU)==null?0:W.length)for(X=g.z(kU),f=X.next();!f.done;f=X.next())Q=f.value,T=Q.offlineVideoData,Dh=void 0,((Dh=T)==null?0:Dh.videoId)&&sr.set(T.videoId,T);H9=new Map;g0=[];if((x=u)==null?0:(E5=x.tracks)==null?0:E5.length)for(s5=g.z(u.tracks),pY=s5.next();!pY.done;pY=s5.next())if(fY=pY.value,GZ=g.sy(fY).entityId)sr.has(GZ)?(H9.set(GZ,sr.get(GZ)),sr.delete(GZ)):g0.push(GZ);GW=Number(((Bz=U.actionMetadata)==null?void 0:Bz.priority)||0)+1;lo=g.z(sr.entries());for(TW=lo.next();!TW.done;TW=
lo.next())EV=TW.value,tr=g.z(EV),SV=tr.next().value,KK=tr.next().value,Jb=SV,en=KK,b9.push(tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Jb,"musicTrack",GW,v_,XA(U,en)));uu=g.z(H9.entries());for(iu=uu.next();!iu.done;iu=uu.next())Pr=iu.value,Qu=g.z(Pr),I9=Qu.next().value,L3=Qu.next().value,B6=I9,YR=L3,b9.push(tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",B6,"musicTrack",GW,v_,XA(U,YR)));fi=g.z(g0);for(Rs=fi.next();!Rs.done;Rs=fi.next())lu=Rs.value,b9.push(tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
lu,"musicTrack",0,v_));return Nq.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D,b9))}})},Gl9=function(k,U){var D,b;
return g.O(function(N){switch(N.Z){case 1:return D=c_(U),g.jh(N,2),b=g.sy(U.entityKey).entityId,b==="!*$_ALL_ENTITIES_!*$"?g.q(N,MD(k.Z,U,k.j),5):g.q(N,W_(b,"musicPlaylist",k.Z,U,k.j),6);case 6:return g.q(N,uFc(k.Z,U.entityKey),5);case 5:g.io(N,3);break;case 2:return g.zY(N),N.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return N.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
D))}})},cC6=function(k,U,D,b){var N,H,F;
return g.O(function(p){switch(p.Z){case 1:return g.q(p,hfL([U]),2);case 2:return N=p.S,g.q(p,KZr(k,N[0],D,b),3);case 3:return H=p.S,F=o3(H.thumbnailDetails),g.q(p,i7(F),4);case 4:return p.return(N[0].videos)}})},KZr=function(k,U,D,b){var N,H,F,p,c,E,I,G,K;
return g.O(function(P){return P.Z==1?(N=U.playlistId,H=l7I(U),F=H.Y1,p=H.zU,c=D?(Number(D)*1E3).toString():Date.now().toString(),E=U.lastModifiedTimestamp?(Number(U.lastModifiedTimestamp)*1E3).toString():"0",I={id:g.oY(N,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:p,lastModifiedTimestampMillis:E,addedTimestampMillis:c,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},G={id:g.oY(N,"musicPlaylist"),title:U.title,playlistId:N,thumbnailDetails:U.thumbnail,visibility:PB6(U),trackCount:U.totalVideoCount,
tracks:F,downloadMetadata:I.id},b&&(((K=G)==null?0:K.entityMetadata)?G.entityMetadata.nextAutoRefreshIntervalSeconds=String(b):G&&(G.entityMetadata={nextAutoRefreshIntervalSeconds:String(b)})),g.q(P,$1(k.Z,{mode:"readwrite",mV:!0},function(V){var Z=r4(V,G,"musicPlaylist");V=r4(V,I,"musicPlaylistDownloadMetadataEntity");return g.Ls.all([Z,V])}),2)):P.return(G)})},PB6=function(k){switch(k.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},sB9=function(k,U){this.Z=k;
this.j=U},jBv=function(k,U){var D,b,N,H,F,p,c,E,I,G,K,P,V;
return g.O(function(Z){switch(Z.Z){case 1:return D=c_(U),b=g.sy(U.entityKey),N=b.entityId,H=g.J(U.actionMetadata,oFz),g.jh(Z,2),g.q(Z,VZv(k,N,void 0,(F=H)==null?void 0:F.track,(p=H)==null?void 0:p.albumRelease),4);case 4:if((c=H)==null?0:c.playlistId){Z.Xt(5);break}return g.q(Z,JfZ(k.Z,U.entityKey),5);case 5:g.io(Z,3);break;case 2:return E=g.zY(Z),I="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.Xx&&E.type==="QUOTA_EXCEEDED"&&
(I="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Z.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,I,G));case 3:P=Number(((K=U.actionMetadata)==null?void 0:K.priority)||0)+1;var w=(w=g.J(U.actionMetadata,oFz))?{playbackDataActionMetadata:{maximumDownloadQuality:w.maximumDownloadQuality}}:void 0;V=tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",N,"playbackData",P,mQ6,w);return Z.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
D,[V]))}})},nF6=function(k,U){var D,b,N,H,F,p,c,E,I,G,K,P,V,Z,w;
return g.O(function(M){switch(M.Z){case 1:return D=c_(U),b=g.sy(U.entityKey),N=b.entityId,g.q(M,vc(k.Z,U.entityKey,"musicTrack"),2);case 2:H=M.S;if(!H){F=void 0;M.Xt(3);break}return g.q(M,vc(k.Z,H.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:F=M.S;case 3:p=F;if(!H||!p)return M.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D));E=g.J(U.actionMetadata,oFz);g.jh(M,5);return g.q(M,VZv(k,N,p.addedTimestampMillis,(I=E)==null?void 0:I.track,(G=E)==null?void 0:G.albumRelease),
7);case 7:P=Number(((K=U.actionMetadata)==null?void 0:K.priority)||0)+1;c=tO("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",N,"playbackData",P,mQ6);g.io(M,6);break;case 5:V=g.zY(M);if(!(V instanceof Error&&V.message==="No data")){if(V instanceof Error&&V.message==="Empty response body")ND(V.message);else return Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",V instanceof g.Xx&&V.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
w="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),M.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,Z,w));M.Xt(6);break}return g.q(M,wM(N,k.Z,U,k.j),6);case 6:return M.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",D,c?[c]:void 0))}})},iCI=function(k,U){var D,b;
return g.O(function(N){switch(N.Z){case 1:return D=c_(U),g.jh(N,2),b=g.sy(U.entityKey).entityId,b==="!*$_ALL_ENTITIES_!*$"?g.q(N,MD(k.Z,U,k.j),5):g.q(N,wM(b,k.Z,U,k.j),6);case 6:return g.q(N,uFc(k.Z,U.entityKey),5);case 5:g.io(N,3);break;case 2:return g.zY(N),N.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",D,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return N.return(new O0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
D))}})},VZv=function(k,U,D,b,N){var H,F,p,c,E,I;
return g.O(function(G){switch(G.Z){case 1:if(H=b){G.Xt(2);break}return g.q(G,C6B([U]),3);case 3:F=G.S,p=F[0],H=Y96(p);case 2:return g.q(G,zB9(k,H,U,N,D),4);case 4:c=G.S;E=c.musicTrackEntity;I=c.Xm;var K=o3(E.thumbnailDetails),P=[];I&&(P=o3(I.thumbnailDetails));return g.q(G,i7(K.concat(P)),0)}})},zB9=function(k,U,D,b,N){var H;
return g.O(function(F){return F.Z==1?(N||(N=Date.now().toString()),H={id:g.oY(D,"musicTrackDownloadMetadataEntity"),playbackData:g.oY(D,"playbackData"),addedTimestampMillis:N,videoDownloadContextEntity:g.oY(D,"videoDownloadContextEntity")},b&&(U.albumRelease=b.id),g.q(F,$1(k.Z,{mode:"readwrite",mV:!0},function(p){var c=[],E=r4(p,H,"musicTrackDownloadMetadataEntity");c.push(E);E=r4(p,U,"musicTrack");c.push(E);b&&(p=r4(p,b,"musicAlbumRelease"),c.push(p));return g.Ls.all(c)}),2)):F.Z!=3?g.q(F,Ku(D,"musicTrackDownloadMetadataEntity",
k.Z,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):F.return({musicTrackEntity:U,
Xm:b})})},y$=function(){Sv.apply(this,arguments);
this.D="musicTrack"},ZCr=function(k,U,D){U=U===void 0?43200:U;
D=D===void 0?!0:D;var b=b===void 0?!1:b;var N,H;return g.O(function(F){switch(F.Z){case 1:if(!k.N.U$())return F.return([]);N=[];g.jh(F,2);return g.q(F,UyZ(U,D,b),4);case 4:N=F.S;g.io(F,3);break;case 2:g.zY(F);case 3:return H=da9(k,N,D,"musicPlaylist"),F.return(H)}})},agc=function(){g.d$.apply(this,arguments);
var k=this;this.events=new g.JI(this);this.ZN=this.player.T();this.dg={BHt:function(){return k.Z},
Bu:function(){return k.Bu()},
fB:function(U){return k.fB(U)}}},wq9=function(k){var U;
k=g.J((U=k.getWatchNextResponse())==null?void 0:U.currentVideoEndpoint,g.RO);if(k==null?0:k.playlistId)var D=k.playlistId;return D},WZF=function(k,U){var D,b,N,H;
return g.O(function(F){if(F.Z==1){D=U.clientPlaybackNonce;b={cpn:D,offlineSourceVisualElement:g.tJ(U.L2||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};U.S&&(b.videoFmt=Number(U.S.itag));U.W&&(b.audioFmt=Number(U.W.itag));if((N=wq9(U))&&U.videoId){var p=U.videoId;p=N!=="PPSV"?Promise.resolve(!1):k.Z.JX(p);F=g.q(F,p,3)}else F=F.Xt(2);return F}F.Z!=2&&(H=F.S)&&(b.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");k.S=D;g.iO("offlinePlaybackStarted",b);g.mI(F)})};
g.aj.prototype.xi=g.bo(45,function(k){return this.app.xi(k)});
g.nO.prototype.xi=g.bo(44,function(k){return g.iP(this,9,k)});
g.m(x1,LU);g.AR.Object.defineProperties(x1.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.Z.entityMetadata},
set:function(k){this.Z.entityMetadata=k}}});
g.m(aMB,x1);aMB.prototype.S=function(){return[]};
g.m(w$Z,x1);w$Z.prototype.S=function(){return[]};
g.m(WBB,x1);WBB.prototype.S=function(){return[]};
g.m(MCZ,x1);MCZ.prototype.S=function(){return[]};
g.m(X$c,x1);X$c.prototype.S=function(){var k=[];this.Z.alternateChannel&&k.push(this.Z.alternateChannel);this.Z.alternateChannelList&&k.push.apply(k,g.a(this.Z.alternateChannelList));this.Z.oneofChannelEntity&&k.push(this.Z.oneofChannelEntity);return[].concat(g.a(new Set(k)))};
g.m(dFB,x1);dFB.prototype.S=function(){var k=[];this.Z.entryCollection&&k.push(this.Z.entryCollection);return[].concat(g.a(new Set(k)))};
g.m(fMG,LU);fMG.prototype.S=function(){var k=[];this.Z.video&&k.push(this.Z.video);return[].concat(g.a(new Set(k)))};
g.m(qT6,x1);qT6.prototype.S=function(){var k=[];this.Z.parentPlaylist&&k.push(this.Z.parentPlaylist);if(this.Z.entries)for(var U=g.z(this.Z.entries),D=U.next();!D.done;D=U.next())k.push.apply(k,g.a((new fMG(D.value)).S()));return[].concat(g.a(new Set(k)))};
g.m(tCY,x1);tCY.prototype.S=function(){var k=[];this.Z.descriptionEntity&&k.push(this.Z.descriptionEntity);this.Z.creators&&k.push.apply(k,g.a(this.Z.creators));this.Z.theBiggestFan&&k.push(this.Z.theBiggestFan);return[].concat(g.a(new Set(k)))};
g.m(Oi9,x1);Oi9.prototype.S=function(){return[]};
g.m(QUz,x1);QUz.prototype.S=function(){return[]};
g.m(LBB,x1);LBB.prototype.S=function(){return[]};
g.m(xF9,x1);xF9.prototype.S=function(){return[]};
g.m(Ta9,x1);Ta9.prototype.S=function(){return[]};
g.m(ezr,x1);ezr.prototype.S=function(){return[]};
g.m(BaR,x1);BaR.prototype.S=function(){return[]};
g.m(YTB,x1);YTB.prototype.S=function(){return[]};
g.m(JYZ,x1);JYZ.prototype.S=function(){return[]};
g.m(u2z,x1);u2z.prototype.S=function(){var k=[];this.Z.downloadsList&&k.push(this.Z.downloadsList);this.Z.smartDownloadsList&&k.push(this.Z.smartDownloadsList);this.Z.recommendedDownloadsList&&k.push(this.Z.recommendedDownloadsList);this.Z.refresh&&k.push(this.Z.refresh);return[].concat(g.a(new Set(k)))};
g.m(lMB,LU);lMB.prototype.S=function(){var k=[];this.Z.video&&k.push(this.Z.video);this.Z.playlist&&k.push(this.Z.playlist);this.Z.videoItem&&k.push(this.Z.videoItem);this.Z.playlistItem&&k.push(this.Z.playlistItem);return[].concat(g.a(new Set(k)))};
g.m(rYI,x1);rYI.prototype.S=function(){var k=[];this.Z.refresh&&k.push(this.Z.refresh);if(this.Z.downloads)for(var U=g.z(this.Z.downloads),D=U.next();!D.done;D=U.next())k.push.apply(k,g.a((new lMB(D.value)).S()));return[].concat(g.a(new Set(k)))};
g.m(STI,x1);STI.prototype.S=function(){var k=[];this.Z.localImageEntities&&k.push.apply(k,g.a(this.Z.localImageEntities));return[].concat(g.a(new Set(k)))};
g.m(Cb9,x1);Cb9.prototype.S=function(){var k=[];this.Z.playbackData&&k.push(this.Z.playbackData);this.Z.localImageEntities&&k.push.apply(k,g.a(this.Z.localImageEntities));this.Z.videoDownloadContextEntity&&k.push(this.Z.videoDownloadContextEntity);return[].concat(g.a(new Set(k)))};
g.m(hzB,x1);hzB.prototype.S=function(){return[]};
g.m($Fc,x1);$Fc.prototype.S=function(){var k=[];this.Z.fakeChildren&&k.push.apply(k,g.a(this.Z.fakeChildren));return[].concat(g.a(new Set(k)))};
g.m(Rzr,x1);Rzr.prototype.S=function(){var k=[];this.Z.video&&k.push(this.Z.video);this.Z.playbackData&&k.push(this.Z.playbackData);this.Z.offlineVideoPolicy&&k.push(this.Z.offlineVideoPolicy);return[].concat(g.a(new Set(k)))};
g.m(vtL,x1);vtL.prototype.S=function(){return[]};
g.m(yYG,x1);yYG.prototype.S=function(){var k=[];this.Z.channelOwner&&k.push(this.Z.channelOwner);this.Z.videos&&k.push.apply(k,g.a(this.Z.videos));this.Z.collaboratorChannels&&k.push.apply(k,g.a(this.Z.collaboratorChannels));this.Z.downloadState&&k.push(this.Z.downloadState);this.Z.refresh&&k.push(this.Z.refresh);return[].concat(g.a(new Set(k)))};
g.m(kGY,x1);kGY.prototype.S=function(){var k=[];this.Z.video&&k.push(this.Z.video);this.Z.channelContributor&&k.push(this.Z.channelContributor);return[].concat(g.a(new Set(k)))};
g.m(Uz9,LU);Uz9.prototype.S=function(){var k=[];this.Z.localImageEntities&&k.push.apply(k,g.a(this.Z.localImageEntities));this.Z.videoDownloadContextEntity&&k.push(this.Z.videoDownloadContextEntity);return[].concat(g.a(new Set(k)))};
g.m(DzG,LU);DzG.prototype.S=function(){var k=[];this.Z.recommendedVideoMetadata&&k.push.apply(k,g.a((new Uz9(this.Z.recommendedVideoMetadata)).S()));return[].concat(g.a(new Set(k)))};
g.m(bS6,LU);bS6.prototype.S=function(){var k=[];this.Z.playbackPosition&&k.push(this.Z.playbackPosition);return[].concat(g.a(new Set(k)))};
g.m(N6r,x1);N6r.prototype.S=function(){var k=[];this.Z.owner&&k.push(this.Z.owner);this.Z.downloadState&&k.push(this.Z.downloadState);this.Z.userState&&k.push.apply(k,g.a((new bS6(this.Z.userState)).S()));this.Z.additionalMetadata&&k.push.apply(k,g.a((new DzG(this.Z.additionalMetadata)).S()));return[].concat(g.a(new Set(k)))};
g.m(HSL,x1);HSL.prototype.S=function(){var k=[];this.Z.userChannelDetails&&k.push(this.Z.userChannelDetails);return[].concat(g.a(new Set(k)))};
g.m(gRZ,x1);gRZ.prototype.S=function(){var k=[];this.Z.channelOwner&&k.push(this.Z.channelOwner);this.Z.playbackPosition&&k.push(this.Z.playbackPosition);this.Z.localImageEntities&&k.push.apply(k,g.a(this.Z.localImageEntities));this.Z.downloadStatus&&k.push(this.Z.downloadStatus);return[].concat(g.a(new Set(k)))};
g.m(FrF,x1);FrF.prototype.S=function(){return[]};
g.m(AVZ,x1);AVZ.prototype.S=function(){return[]};
g.m(p6F,x1);p6F.prototype.S=function(){return[]};
g.m(cVI,x1);cVI.prototype.S=function(){return[]};
g.m(ER6,x1);ER6.prototype.S=function(){return[]};
g.m(IKc,x1);IKc.prototype.S=function(){return[]};
g.m(GG9,x1);GG9.prototype.S=function(){return[]};
g.m(KrZ,x1);KrZ.prototype.S=function(){return[]};
g.m(PHB,x1);PHB.prototype.S=function(){return[]};
g.m(sPc,x1);sPc.prototype.S=function(){return[]};
g.m(oR9,x1);oR9.prototype.S=function(){var k=[];this.Z.trackDownloadMetadatas&&k.push.apply(k,g.a(this.Z.trackDownloadMetadatas));return[].concat(g.a(new Set(k)))};
g.m(VTL,x1);
VTL.prototype.S=function(){var k=[];this.Z.downloadedTracks&&k.push.apply(k,g.a(this.Z.downloadedTracks));this.Z.smartDownloadedTracks&&k.push.apply(k,g.a(this.Z.smartDownloadedTracks));this.Z.downloadedEpisodes&&k.push.apply(k,g.a(this.Z.downloadedEpisodes));this.Z.downloadedAlbumReleases&&k.push.apply(k,g.a(this.Z.downloadedAlbumReleases));this.Z.smartDownloadedAlbumReleases&&k.push.apply(k,g.a(this.Z.smartDownloadedAlbumReleases));this.Z.downloadedPlaylists&&k.push.apply(k,g.a(this.Z.downloadedPlaylists));this.Z.smartDownloadedPlaylists&&
k.push.apply(k,g.a(this.Z.smartDownloadedPlaylists));this.Z.metadataOnlyTracks&&k.push.apply(k,g.a(this.Z.metadataOnlyTracks));return[].concat(g.a(new Set(k)))};
g.m(mzZ,x1);mzZ.prototype.S=function(){var k=[];this.Z.trackDownloadMetadatas&&k.push.apply(k,g.a(this.Z.trackDownloadMetadatas));return[].concat(g.a(new Set(k)))};
g.m(jPL,x1);jPL.prototype.S=function(){var k=[];this.Z.playbackData&&k.push(this.Z.playbackData);this.Z.localImageEntities&&k.push.apply(k,g.a(this.Z.localImageEntities));this.Z.videoDownloadContextEntity&&k.push(this.Z.videoDownloadContextEntity);return[].concat(g.a(new Set(k)))};
g.m(nR9,x1);nR9.prototype.S=function(){var k=[];this.Z.musicLibraryStatusEntity&&k.push(this.Z.musicLibraryStatusEntity);this.Z.primaryArtists&&k.push.apply(k,g.a(this.Z.primaryArtists));this.Z.details&&k.push(this.Z.details);this.Z.userDetails&&k.push(this.Z.userDetails);this.Z.tracks&&k.push.apply(k,g.a(this.Z.tracks));this.Z.share&&k.push(this.Z.share);this.Z.downloadMetadata&&k.push(this.Z.downloadMetadata);this.Z.refresh&&k.push(this.Z.refresh);return[].concat(g.a(new Set(k)))};
g.m(iSv,x1);iSv.prototype.S=function(){var k=[];this.Z.albumRelease&&k.push(this.Z.albumRelease);this.Z.tracks&&k.push.apply(k,g.a(this.Z.tracks));return[].concat(g.a(new Set(k)))};
g.m(zUY,x1);zUY.prototype.S=function(){var k=[];this.Z.albumRelease&&k.push(this.Z.albumRelease);return[].concat(g.a(new Set(k)))};
g.m(ZSZ,x1);ZSZ.prototype.S=function(){var k=[];this.Z.details&&k.push(this.Z.details);this.Z.userDetails&&k.push(this.Z.userDetails);return[].concat(g.a(new Set(k)))};
g.m(aKB,x1);aKB.prototype.S=function(){var k=[];this.Z.parentArtist&&k.push(this.Z.parentArtist);return[].concat(g.a(new Set(k)))};
g.m(w69,x1);w69.prototype.S=function(){var k=[];this.Z.parentArtist&&k.push(this.Z.parentArtist);return[].concat(g.a(new Set(k)))};
g.m(WrY,x1);WrY.prototype.S=function(){return[]};
g.m(MT9,x1);MT9.prototype.S=function(){return[]};
g.m(X6F,LU);X6F.prototype.S=function(){var k=[];this.Z.creatorEntity&&k.push(this.Z.creatorEntity);return[].concat(g.a(new Set(k)))};
g.m(dzv,x1);
dzv.prototype.S=function(){var k=[];this.Z.tracks&&k.push.apply(k,g.a(this.Z.tracks));this.Z.refresh&&k.push(this.Z.refresh);this.Z.musicLibraryStatusEntity&&k.push(this.Z.musicLibraryStatusEntity);this.Z.details&&k.push(this.Z.details);this.Z.downloadMetadata&&k.push(this.Z.downloadMetadata);this.Z.sideloadMetadata&&k.push(this.Z.sideloadMetadata);this.Z.userDetails&&k.push(this.Z.userDetails);this.Z.entryCollection&&k.push(this.Z.entryCollection);this.Z.share&&k.push(this.Z.share);this.Z.podcastShowAdditionalMetadata&&k.push.apply(k,
g.a((new X6F(this.Z.podcastShowAdditionalMetadata)).S()));return[].concat(g.a(new Set(k)))};
g.m(fKR,x1);fKR.prototype.S=function(){return[]};
g.m(q$c,x1);
q$c.prototype.S=function(){var k=[];this.Z.musicLibraryStatusEntity&&k.push(this.Z.musicLibraryStatusEntity);this.Z.artists&&k.push.apply(k,g.a(this.Z.artists));this.Z.audioModeVersion&&k.push(this.Z.audioModeVersion);this.Z.videoModeVersion&&k.push(this.Z.videoModeVersion);this.Z.userDetails&&k.push(this.Z.userDetails);this.Z.details&&k.push(this.Z.details);this.Z.albumRelease&&k.push(this.Z.albumRelease);this.Z.share&&k.push(this.Z.share);this.Z.libraryEdit&&k.push(this.Z.libraryEdit);this.Z.downloadMetadata&&
k.push(this.Z.downloadMetadata);this.Z.playbackPosition&&k.push(this.Z.playbackPosition);this.Z.lyrics&&k.push(this.Z.lyrics);return[].concat(g.a(new Set(k)))};
g.m(tTr,x1);tTr.prototype.S=function(){var k=[];this.Z.parentTrack&&k.push(this.Z.parentTrack);return[].concat(g.a(new Set(k)))};
g.m(OSr,x1);OSr.prototype.S=function(){var k=[];this.Z.parentTrack&&k.push(this.Z.parentTrack);return[].concat(g.a(new Set(k)))};
g.m(QP6,x1);QP6.prototype.S=function(){return[]};
g.m(LrG,x1);LrG.prototype.S=function(){return[]};
g.m(xzI,x1);xzI.prototype.S=function(){return[]};
g.m(T6G,x1);T6G.prototype.S=function(){return[]};
g.m(eUB,x1);eUB.prototype.S=function(){var k=[];this.Z.transfer&&k.push(this.Z.transfer);this.Z.adsPlaybackData&&k.push.apply(k,g.a(this.Z.adsPlaybackData));this.Z.drmLicense&&k.push(this.Z.drmLicense);this.Z.offlineVideoPolicy&&k.push(this.Z.offlineVideoPolicy);this.Z.videoDownloadContextEntity&&k.push(this.Z.videoDownloadContextEntity);return[].concat(g.a(new Set(k)))};
g.m(B6Y,x1);B6Y.prototype.S=function(){return[]};
g.m(Y$L,x1);Y$L.prototype.S=function(){var k=[];this.Z.offlineVideoStreams&&k.push.apply(k,g.a(this.Z.offlineVideoStreams));this.Z.captionTrack&&k.push.apply(k,g.a(this.Z.captionTrack));return[].concat(g.a(new Set(k)))};
g.m(JVr,x1);JVr.prototype.S=function(){return[]};
g.m(u79,x1);u79.prototype.S=function(){return[]};
g.m(lKI,x1);lKI.prototype.S=function(){return[]};
g.m(rVr,x1);rVr.prototype.S=function(){return[]};
g.m(S$Y,x1);S$Y.prototype.S=function(){return[]};
g.m(CHY,x1);CHY.prototype.S=function(){return[]};
g.m(hUR,x1);hUR.prototype.S=function(){return[]};
g.m($zc,x1);$zc.prototype.S=function(){return[]};
g.m(RUv,x1);RUv.prototype.S=function(){return[]};
g.m(vRr,x1);vRr.prototype.S=function(){return[]};
g.m(yV9,x1);yV9.prototype.S=function(){return[]};
g.m(kxY,x1);kxY.prototype.S=function(){return[]};
g.m(UK9,x1);UK9.prototype.S=function(){return[]};
g.m(DKB,x1);DKB.prototype.S=function(){return[]};
g.m(bpF,x1);bpF.prototype.S=function(){return[]};
g.m(NBY,x1);NBY.prototype.S=function(){return[]};
g.m(Hpv,x1);Hpv.prototype.S=function(){return[]};
var Dyv=["browse","music/browse","unplugged/browse"],F$9=["offline/playlist_sync_check"],S9Z=["offline"],bB9=["offline/offline_video_playback_position_sync"],HBr=["offline/get_playback_data_entity"],TQ;eX.getInstance=function(){return g.O(function(k){return k.return(new Promise(function(U){g.Eg().then(function(D){D?(eX.instance||(eX.instance=new eX(D)),U(eX.instance)):U(void 0)})}))})};
eX.prototype.get=function(k){var U=this,D,b,N;return g.O(function(H){if(H.Z==1)return g.q(H,pS6(U.token),2);if(H.Z!=3)return D=H.S,g.q(H,D.get("prefs",k),3);b=H.S;if(!b)return H.return();N=(0,g.BW)();return b.expirationTimestampMs<=N?H.return():H.return(b.value)})};
eX.prototype.set=function(k,U,D){D=D===void 0?31536E3:D;var b=this,N,H,F;return g.O(function(p){if(p.Z==1)return N=(0,g.BW)(),H={key:k,value:U,expirationTimestampMs:N+D*1E3},g.q(p,pS6(b.token),2);F=p.S;return g.q(p,g.Sq(F,"prefs",H),0)})};
eX.prototype.remove=function(k){var U=this,D;return g.O(function(b){if(b.Z==1)return g.q(b,pS6(U.token),2);D=b.S;return g.q(b,D.delete("prefs",k),0)})};
g.m(Bc,g.gv);g.m(Y1,KuB);Y1.prototype.j=function(k,U){U=sz6(U);k=(new TextEncoder).encode(JSON.stringify(k));return this.Z.encrypt(k,U)};
Y1.prototype.S=function(k,U){if(!(k instanceof Uint8Array))throw cp9(1);var D=new TextDecoder;U=sz6(U);k=this.Z.decrypt(k,U);return JSON.parse(D.decode(k))};
var oMY={accountLinkStatusEntity:LBB,booleanEntity:WBB,buttonEntity:vRr,captionTrack:QP6,channelHandle:aMB,commerceAcquisitionClientPayloadEntity:kxY,commerceCartListEntity:UK9,contextNoteFeedEntityPayload:w$Z,continuationTokenEntity:vtL,downloadQualityPickerEntity:BaR,downloadsPageRefreshTokenEntity:JYZ,downloadsPageViewConfigurationEntity:FrF,downloadStatusEntity:YTB,sfvAudioItemCurrentlyPlayingEntity:u79,emojiFountainDataEntity:$zc,emojiCustomizationSetEntity:hUR,fakeChannel:X$c,fakePlaylist:dFB,
fakePlaylistEntryCollection:qT6,fakeVideo:tCY,fakeVideoDescription:Oi9,featuredProductsEntity:KrZ,flowStateEntity:QUz,iconBadgeEntity:DKB,interstitialInteractionStateEntity:Ta9,liveChatPollStateEntity:ezr,liveReactionsDataEntity:RUv,logoEntity:xF9,macroMarkerEntity:AVZ,mainDownloadsLibraryEntity:u2z,mainDownloadsListEntity:rYI,mainPlaylistDownloadStateEntity:STI,mainPlaylistEntity:yYG,mainPlaylistVideoEntity:kGY,mainVideoDownloadStateEntity:Cb9,mainVideoEntity:N6r,markersEngagementPanelSyncEntity:p6F,
markersVisibilityOverrideEntity:cVI,musicAlbumReleaseDetail:iSv,musicAlbumReleaseDownloadMetadataEntity:oR9,musicAlbumRelease:nR9,musicAlbumReleaseUserDetail:zUY,musicArtistDetail:aKB,musicArtist:ZSZ,musicArtistUserDetail:w69,musicDownloadsLibraryEntity:VTL,musicLibraryEdit:WrY,musicLibraryStatusEntity:MT9,musicPlaylist:dzv,musicPlaylistDownloadMetadataEntity:mzZ,musicShare:fKR,musicTrackDetail:tTr,musicTrackDownloadMetadataEntity:jPL,musicTrack:q$c,musicTrackUserDetail:OSr,offlineOrchestrationActionWrapperEntity:LrG,
offlineVideoPolicy:xzI,offlineVideoStreams:T6G,offlineabilityEntity:hzB,orchestrationWebSamplingEntity:$Fc,pageHeaderEntity:S$Y,pdpStateEntity:bpF,pinnedProductEntity:PHB,playbackData:eUB,playerStateEntity:ER6,quantityIncrementerEntity:NBY,refresh:B6Y,saveToPlaylistListEntity:lKI,settingEntity:rVr,stringEntity:MCZ,suggestedFeedbackChipStateEntity:IKc,transfer:Y$L,trendingOfferEntity:sPc,videoDownloadContextEntity:JVr,videoOverviewAsyncDataEntity:Hpv,videoPlaybackPositionEntity:yV9,votingEntity:CHY,
ytMainChannelEntity:HSL,youchatPendingResponseEntity:GG9,ytMainDownloadedVideoEntity:Rzr,ytMainVideoEntity:gRZ};g.m(CU,KuB);CU.prototype.j=function(k){return k};
CU.prototype.S=function(k){if(k instanceof Uint8Array)throw cp9(0);return k};
g.m(ht,g.B);ht.prototype.observe=function(k){var U=this;this.observers.push(k);return function(){var D=U.observers.indexOf(k);D>=0&&U.observers.splice(D,1)}};
ht.prototype.S=function(k){fov(this,k.data)};
ht.prototype.Sw=function(){this.channel.close()};
var LuG,q9G=new g.eG("elementsCommand");var ZN=new g.eG("entityBatchUpdate");var jDc=new g.eG("downloadStatusEntity");var LRc=new g.eG("mainPlaylistEntityActionMetadata");var $Y=new g.eG("mainVideoEntityActionMetadata");var rf9=new g.eG("musicPlaylistEntityActionMetadata");var oFz=new g.eG("musicTrackEntityActionMetadata");var v_G=new g.eG("localImageEntityActionMetadata");var Q$=new g.eG("playbackDataActionMetadata");var tPB=new g.eG("transferEntityActionMetadata");var VPB=new g.eG("videoPlaybackPositionEntityActionMetadata");var vM6;new g.MF;new g.MF;b6z.prototype.request=function(k,U,D){U=U===void 0?{}:U;return this.locks.request(k,U,function(b){return D(b)})};var b7=g.TY.caches,DN,Af6;U0.prototype.open=function(k){return b7.open(gjG(k))};
U0.prototype.has=function(k){return b7.has(gjG(k))};
U0.prototype.delete=function(k){return b7.delete(gjG(k))};
U0.prototype.match=function(k,U){var D=this,b,N,H,F,p,c;return g.O(function(E){switch(E.Z){case 1:return g.q(E,D.keys(),2);case 2:b=E.S,N=g.z(b),H=N.next();case 3:if(H.done){E.Xt(5);break}F=H.value;return g.q(E,D.open(F),6);case 6:return p=E.S,g.q(E,p.match(k,U),7);case 7:if(c=E.S)return E.return(c);H=N.next();E.Xt(3);break;case 5:return E.return()}})};
g.m(H69,U0);H69.prototype.keys=function(){var k,U,D,b,N,H,F,p,c;return g.O(function(E){if(E.Z==1)return k=[],U=g.Fx("CacheStorage keys"),g.q(E,b7.keys(),2);D=E.S;b=g.z(D);for(N=b.next();!N.done;N=b.next()){H=N.value;var I=H.indexOf(":");F=I===-1?{WO:H}:{WO:H.substring(0,I),datasyncId:H.substring(I+1)};p=F.WO;c=F.datasyncId;c===U&&k.push(p)}return E.return(k)})};g.m(H_,g.B);H_.prototype.j=function(k){this.api.f2("onOfflineOperationFailure",k.data)};
H_.prototype.W=function(k){this.api.publish("offlinetransferpause",k.data)};
H_.prototype.Sw=function(){var k;(k=this.Z)==null||k.close();var U;(U=this.S)==null||U.close()};Ejz.prototype.Za=function(){this.Z&&FA(this)};
Ejz.prototype.EV=function(){this.S&&this.S.resolve();this.j=this.Z=!1;this.D()};var $y6=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var XsR="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var Bfc="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.m(pjz,qD);pjz.prototype.S=function(k){return E0(k)?IuL(this,k):I3(k)?PjB(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.m(sZ9,qD);sZ9.prototype.S=function(k){return I3(k)?of6(this,k):mPc(k)?myF(this,k):Gg(k)?jZB(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.A=nf9.prototype;g.A.qdu=function(k){var U=this,D,b,N,H;return g.O(function(F){if(!g.h(k.state,128))return F.Xt(0);D=k.state.JK;var p=(b=D)==null?void 0:b.errorCode,c=(N=D)==null?void 0:N.NN;H=p==="net.connect"&&c===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(p==null?0:p.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.q(F,U.Sl(U.player.getVideoData().videoId,H),0)})};
g.A.Sl=function(k,U){var D=this;return g.O(function(b){if(b.Z==1){if(D.S)return b.return();D.S=!0;return U==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Tg(D,k,!1,!0),b.Xt(0)):g.q(b,xY(D,k),3)}g.XM(k,4);return g.q(b,D.Z.Sl(U),0)})};
g.A.Z_=function(k){k.status===2?(k.status!==this.j&&(o_Y(this.Z),g.XM(k.videoId,2)),k.Qs&&iN9(this.Z,k.videoId,k.Qs)):k.status===4?(xY(this,k.videoId),this.Sl(k.videoId,k.z$?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):k.status===1&&n_B(this.Z);this.j=k.status;this.api.f2("localmediachange",{videoId:k.videoId,status:k.status})};
g.A.YY=function(){var k=this,U;return g.O(function(D){if(D.Z==1){if(k.S)return D.return();k.S=!0;U=k.player.getVideoData().videoId;return g.q(D,xY(k,U),2)}return g.q(D,k.Z.YY(),0)})};
g.A.qr=function(k){switch(k){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.A.U=function(k){return this.api.T().U(k)};g.m(MPr,qD);MPr.prototype.S=function(k){return E0(k)?dyR(this,k):I3(k)?fuc(this,k):mPc(k)?qNz(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};T1z.prototype.Z=function(k,U){var D=k.action.actionMetadata.priority-U.action.actionMetadata.priority;D===0&&(k.Z<U.Z?D=-1:k.Z>U.Z&&(D=1));return D};g.m(ev,g.B);ev.prototype.Sw=function(){this.D&&this.D();g.B.prototype.Sw.call(this)};
ev.prototype.createAction=function(k,U){var D=g.sy(k.entityKey).entityType,b=g.Oe(16);return new V$(D,b,k,U.actionId,U.rootActionId)};
ev.prototype.Ft=function(k){var U=this,D,b,N,H,F,p,c,E,I;return g.O(function(G){if(G.Z==1){if(U.K2())return G.return();b=(D=k.offlineOrchestrationActionWrapperEntity)!=null?D:new Set;N=[];H=g.z(b);for(F=H.next();!F.done;F=H.next())p=F.value,c=g.sy(p),E=c.entityId,YNz(U.Z,E)||N.push(p);return g.q(G,ymR(U,N),2)}I=G.S;return g.q(G,vf9(U,I),0)})};
ev.prototype.retry=function(){var k=this;return g.O(function(U){return g.q(U,kfr(k),0)})};DaI.prototype.Vh=function(k,U){U=U===void 0?!0:U;var D=this,b,N,H,F,p,c,E,I;return g.O(function(G){switch(G.Z){case 1:if(!D.Z)return G.return();b=[];N=g.VE(D.Z.S,U);H=[];for(F={py:0};F.py<N.length;F={py:F.py},F.py++)p=N[F.py],c=D.Z.dG(p,"json3"),E=g.uT(c,{withCredentials:!0,format:"RAW"},3,500).then(function(K){return function(P){P={metadata:g.KW(N[K.py]),trackData:P.xhr.responseText};H.push(P)}}(F)).qy(function(K){ND("Caption fetch error",K)}),b.push(E);
return g.q(G,Zi9(b),2);case 2:return g.jh(G,3),g.q(G,loB(k,H),5);case 5:g.io(G,0);break;case 3:I=g.zY(G),ND("Caption DB transaction error",I),g.mI(G)}})};g.m(B_,g.B);B_.prototype.Sw=function(){this.S&&this.S();g.B.prototype.Sw.call(this)};
B_.prototype.j=function(k){var U=this,D,b,N,H,F,p,c,E;return g.O(function(I){b=(D=k.transfer)!=null?D:new Set;N=[];H=g.z(b);for(F=H.next();!F.done;F=H.next())p=F.value,c=g.sy(p),E=c.entityId,N.push(E);return N.length===0?I.return():g.q(I,HNz(U,N),0)})};g.m(cFz,g.B);g.A=cFz.prototype;g.A.Sw=function(){this.jw&&this.jw();this.Wg.dispose();this.W.dispose();this.tQ&&g.vv(this.N.Bt,this.tQ);this.U4&&g.vv(this.N.Bt,this.U4);g.B.prototype.Sw.call(this)};
g.A.X6I=function(k){var U=this,D,b,N;return g.O(function(H){switch(H.Z){case 1:D=g.oY(k,"transfer");if(U.Z&&D===U.Z.key){Tg(U.B,U.K,!0);U.W.stop();H.Xt(0);break}return g.q(H,$1(U.S,{mode:"readwrite",mV:!0},function(F){return Jt(F,D,"transfer").then(function(p){if(p&&p.transferState!=="TRANSFER_STATE_COMPLETE"&&p.transferState!=="TRANSFER_STATE_FAILED")return p.transferState="TRANSFER_STATE_PAUSED_BY_USER",r4(F,p,"transfer").then(function(){return p})})}),3);
case 3:b=H.S;if(!b){H.Xt(0);break}if(!k||!U.j){H.Xt(5);break}return g.q(H,Ku(k,U.j,U.S,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.q(H,u7(U,k),7);case 7:N=H.S,ojr({videoId:k,dT:b,offlineModeType:N}),g.mI(H)}})};
g.A.WUg=function(){var k=this;if(this.Z&&this.K){Tg(this.B,this.K,!1);var U=this.Z,D=(U==null?0:U.key)?g.sy(U.key).entityId:"";D&&this.j&&(new Promise(function(b,N){Ku(D,k.j,k.S,"DOWNLOAD_STATE_PAUSED").catch(function(H){N(H)})})).catch(function(b){ND("Download state setting error",b)})}this.W.stop()};
g.A.pN=function(){this.Z?GfB(this,this.Z):JO(this)};
g.A.Tq=function(k){var U=this;return g.O(function(D){switch(D.Z){case 1:if(!U.Z){D.Xt(2);break}if(U.Z.transferState==="TRANSFER_STATE_COMPLETE"||U.Z.transferState==="TRANSFER_STATE_FAILED"||!k.transfer||!k.transfer.has(U.Z.key)){D.Xt(3);break}return g.q(D,vc(U.S,U.Z.key,"transfer"),4);case 4:U.Z=D.S;if(U.Z){D.Xt(3);break}return g.q(D,KRL(U),3);case 3:if(U.Z)return D.return();case 2:return g.q(D,JO(U),0)}})};
g.A.Sl=function(k,U){var D=this,b,N,H,F,p;return g.O(function(c){switch(c.Z){case 1:if(!D.Z){l7(D,"onTransferFailure: "+k);c.Xt(2);break}b=D.Z;H=((N=b)==null?0:N.key)?g.sy(b.key).entityId:"";a:switch(k){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var E=!1;break a;default:E=!0}return E&&zyG(D)?g.q(c,rM(D,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.q(c,
ZNB(D,k),5);case 5:if(!H||!D.j){c.Xt(2);break}return g.q(c,Ku(H,D.j,D.S,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.q(c,u7(D,H),9);case 9:F=c.S;pu({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:H,dT:b,offlineModeType:F});if(!H||!D.j){c.Xt(2);break}return g.q(c,Ku(H,D.j,D.S,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:YY(D),p=JO(D,!0),U&&U(p),g.mI(c)}})};
g.A.YY=function(k){var U=this,D,b,N,H,F,p,c,E,I,G,K,P;return g.O(function(V){switch(V.Z){case 1:if(!U.Z){l7(U,"onMaybeTransferStreamsExpired");V.Xt(2);break}return zyG(U)?g.q(V,rM(U,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.q(V,ZNB(U,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!U.j){V.Xt(2);break}D=U.Z;N=((b=D)==null?0:b.key)?g.sy(D.key).entityId:"";if(!N){V.Xt(2);break}return g.q(V,Ku(N,U.j,U.S,"DOWNLOAD_STATE_FAILED"),2);case 9:return U.Z||l7(U,"onMaybeTransferStreamsExpiredRetryAttempting"),
H=U.Z,p=((F=H)==null?0:F.key)?g.sy(H.key).entityId:"",g.q(V,u7(U,p),10);case 10:return c=V.S,pu({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:p,dT:H,offlineModeType:c}),E=zfv(),g.RR(E,Q$,{isEnqueuedForExpiredStreamUrlRefetch:!0}),I=g.oY(p,"playbackData"),G={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:I,actionMetadata:E},K=jv(new V$("playbackData",p,G)),g.q(V,Ro(U.S,K,"offlineOrchestrationActionWrapperEntity"),2);case 2:YY(U),P=JO(U,!0),
k&&k(P),g.mI(V)}})};
var MZG={},aw6=(MZG.TRANSFER_STATE_TRANSFERRING=1,MZG.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,MZG);g.A=Sv.prototype;g.A.XR=function(){return this.K.promise};
g.A.i7=function(){if(this.S&&this.B)return this.K.promise;MtG(this).then(this.K.resolve).catch(this.K.reject);return this.K.promise};
g.A.lR=function(k){var U={};return U.playbackData=new pjz(k,this.ZN,this.Z),U.transfer=new MPr(k,this.ZN),U.videoPlaybackPositionEntity=new sZ9(k,this.ZN),U};
g.A.S5=function(){var k=this;return g.O(function(U){return k.S?g.q(U,E_B(k.S),0):U.Xt(0)})};
g.A.R$=function(){var k=this,U,D;return g.O(function(b){if(b.Z==1)return k.S||k.B?g.q(b,k.XR(),2):b.return();k.V!==void 0&&(g.qg(k.V),k.V=void 0);k.W!==void 0&&(g.qg(k.W),k.W=void 0);(U=k.S)==null||U.dispose();k.S=void 0;(D=k.B)==null||D.dispose();k.B=void 0;k.api.f2("onOrchestrationLostLeader");k.K=new g.MF;g.mI(b)})};
g.A.isOrchestrationLeader=function(){return this.j.Z};
g.A.JX=function(){return g.O(function(k){return k.return(!1)})};
g.A.Lf=function(k){var U=this.Z;U.api.publish("offlinetransferpause",k);var D;(D=U.S)==null||D.postMessage(k)};
g.A.pN=function(k){var U,D;return g.O(function(b){if(b.Z==1)return g.q(b,kY(),2);U=b.S;if(!U)return b.return();D=g.oY(k,"transfer");return g.q(b,$1(U,{mode:"readwrite",mV:!0},function(N){var H=Jt(N,D,"transfer"),F=Jt(N,g.oY(k,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Ls.all([H,F]).then(function(p){p=g.z(p);var c=p.next().value;var E=p.next().value;return c&&c.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(c.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",r4(N,c,"transfer").then(function(){pu({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:k,dT:c,offlineModeType:E==null?void 0:E.offlineModeType});return g.Ls.resolve(null)})):g.Ls.resolve(null)})}),0)})};
g.A.OL=function(k){k=k===void 0?43200:k;var U=this,D,b,N,H,F,p,c,E;return g.O(function(I){if(I.Z==1)return U.N.U$()?g.q(I,kY(),2):I.return(X5Y());if(I.Z!=3){D=I.S;if(!D)return I.return([]);b=Date.now()/1E3;return g.q(I,y2(D,"offlineVideoPolicy"),3)}N=I.S;H=[];F=g.z(N);for(p=F.next();!p.done;p=F.next())c=p.value,Number(c.lastUpdatedTimestampSeconds)+k<=b&&(E=g.sy(c.key).entityId,H.push(E));return H.length?I.return(Cu(U,H,U.D,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):I.return([])})};
g.A.deleteAll=function(){return Cu(this,["!*$_ALL_ENTITIES_!*$"],this.D,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.A.refreshAllStaleEntities=function(k){var U=this;return g.O(function(D){return D.Z==1?g.q(D,U.OL(k),2):D.return(D.S)})};
g.A.setUpPositionSyncInterval=function(k){var U=this;this.W!==void 0&&(g.qg(this.W),this.W=void 0);var D=k!=null?k:864E5;this.W=g.dy(function(){U.Hc(D)},D)};
g.A.Hc=function(k){var U=this,D,b,N,H,F,p;return g.O(function(c){switch(c.Z){case 1:return g.jh(c,2),g.q(c,eX.getInstance(),4);case 4:D=c.S;if(!D)throw Error("prefStorage is undefined");return g.q(c,D.get("psi"),5);case 5:b=c.S;H=((N=b)==null?0:N.y6)?Number(b.y6)/1E3:0;F=Date.now();if(!(H+k<=F)){c.Xt(6);break}return g.q(c,Cu(U,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.io(c,0);break;case 2:p=g.zY(c),ND("Offline manager error",p),
g.mI(c)}})};
g.A.dL=function(){var k=this,U,D,b,N,H,F,p;return g.O(function(c){if(c.Z==1)return g.q(c,kY(),2);if(c.Z!=3)return(U=c.S)?g.q(c,y2(U,"transfer"),3):c.return([]);D=c.S;b=[];N=g.z(D);for(H=N.next();!H.done;H=N.next())F=H.value,F.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&F.key&&(p=g.sy(F.key).entityId,b.push(p));return c.return(fwB(k,b))})};
g.A.Tf=function(){return g.O(function(k){return k.return([])})};
g.A.p4=function(){return g.O(function(k){g.mI(k)})};
g.A.nA=function(){return g.O(function(k){g.mI(k)})};g.m(q69,qD);q69.prototype.S=function(k){return E0(k)?QI6(this,k):I3(k)?xav(this,k):Gg(k)?T9r(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var hO=[10];g.m(uq9,qD);uq9.prototype.S=function(k){return E0(k)?S6B(this,k):I3(k)?C1z(this,k):Gg(k)?hyv(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var rF9=[10];g.m(Ryv,qD);Ryv.prototype.S=function(k){return I3(k)?yFz(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.m(klZ,Sv);g.A=klZ.prototype;g.A.lR=function(k){var U=Sv.prototype.lR.call(this,k);U.mainVideoEntity=new uq9(k,this.ZN,this.Z);U.mainPlaylistEntity=new q69(k,this.ZN,this.Z);U.mainDownloadsListEntity=new Ryv(k,this.ZN,this.Z);return U};
g.A.refreshAllStaleEntities=function(k,U){var D=this,b,N,H,F,p,c,E,I,G,K,P;return g.O(function(V){switch(V.Z){case 1:b=[];if(!D.ZN.U("web_player_offline_playlist_auto_refresh")){V.Xt(2);break}return g.q(V,UQR(D,k,U),3);case 3:b=V.S;case 2:return g.q(V,eX.getInstance(),4);case 4:return N=V.S,g.q(V,(H=N)==null?void 0:H.get("sdois"),5);case 5:return F=V.S,g.q(V,(p=N)==null?void 0:p.get("lmqf"),6);case 6:c=V.S;if(!F){V.Xt(7);break}I=b;G=I.concat;return g.q(V,DQF(D,F,(E=c)!=null?E:"SD",k===0),8);case 8:b=
G.call(I,V.S);case 7:return K=b,P=K.concat,g.q(V,Sv.prototype.refreshAllStaleEntities.call(D,k,U),9);case 9:return b=P.call(K,V.S),V.return(b)}})};
g.A.JX=function(k){var U,D,b,N,H,F,p,c;return g.O(function(E){if(E.Z==1)return g.q(E,kY(),2);if(E.Z!=3)return(U=E.S)?g.q(E,vc(U,g.Q7,"mainDownloadsListEntity"),3):E.return(!1);D=E.S;if((b=D)==null?0:(N=b.downloads)==null?0:N.length)for(H=g.oY(k,"mainVideoEntity"),F=g.z(D.downloads),p=F.next();!p.done;p=F.next())if(c=p.value,c.videoItem===H)return E.return(!0);return E.return(!1)})};
g.A.Tf=function(){var k=this,U,D,b,N,H,F,p,c;return g.O(function(E){if(E.Z==1)return g.q(E,kY(),2);if(E.Z!=3)return(U=E.S)?g.q(E,y2(U,"downloadStatusEntity"),3):E.return([]);D=E.S;b=[];N=g.z(D);for(H=N.next();!H.done;H=N.next())F=H.value,F.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&F.key&&(p=g.sy(F.key).entityId,b.push(p));return b.length?(c={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},E.return(Cu(k,b,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
c))):E.return([])})};
g.A.nA=function(){var k;return g.O(function(U){return U.Z==1?g.q(U,kY(),2):(k=U.S)?g.q(U,$1(k,{mode:"readwrite",mV:!0},function(D){return ua(D,"mainVideoEntity").then(function(b){var N=[];b=g.z(b);for(var H=b.next();!H.done;H=b.next()){H=H.value;var F=void 0;(F=H.userState)!=null&&F.playbackPosition||(F=g.sy(H.key).entityId,F={key:g.oY(F,"videoPlaybackPositionEntity"),videoId:F,lastPlaybackPositionSeconds:"0"},N.push(r4(D,F,"videoPlaybackPositionEntity")),H.userState={playbackPosition:F.key},N.push(r4(D,
H,"mainVideoEntity")))}return g.Ls.all(N)})}),0):U.return()})};
g.A.p4=function(){var k,U,D,b,N,H,F,p,c,E,I,G,K,P,V,Z,w,M,d,t,L,e,l,C,N9,Fv,kU,u,R,n,r,yW,n9,Ur,W9,$U,b9,sr;return g.O(function(W){if(W.Z==1)return g.q(W,kY(),2);if(W.Z!=3){k=W.S;if(!k)return W.return();U=g.oY("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.q(W,$1(k,{mode:"readonly",mV:!0},function(X){return g.Ls.all([Jt(X,U,"mainDownloadsListEntity"),Jt(X,g.Q7,"mainDownloadsListEntity"),ua(X,"mainVideoEntity"),ua(X,"mainPlaylistEntity")])}),3)}D=W.S;
b=g.z(D);N=b.next().value;H=b.next().value;F=b.next().value;p=b.next().value;c=N;E=H;I=F;G=p;K=new Set;if((P=c)==null?0:(V=P.downloads)==null?0:V.length)for(Z=g.z(c.downloads),w=Z.next();!w.done;w=Z.next())M=w.value,d=void 0,(t=(d=M.videoItem)!=null?d:M.playlistItem)&&K.add(t);if((L=E)==null?0:(e=L.downloads)==null?0:e.length)for(l=g.z(E.downloads),C=l.next();!C.done;C=l.next())N9=C.value,N9.videoItem&&K.add(N9.videoItem);Fv=new Set;kU=[];u=g.z(G);for(R=u.next();!R.done;R=u.next()){n=R.value;if(n.videos)for(r=
g.z(n.videos),yW=r.next();!yW.done;yW=r.next())n9=yW.value,(Ur=JSON.parse(g.sy(n9).entityId).videoId)&&Fv.add(Ur);n.key&&!K.has(n.key)&&kU.push(n.key)}W9=g.z(I);for($U=W9.next();!$U.done;$U=W9.next())b9=$U.value,b9.key&&!K.has(b9.key)&&(sr=g.sy(b9.key).entityId,Fv.has(sr)||kU.push(b9.key));return kU.length?g.q(W,Lo6(k,kU),0):W.Xt(0)})};g.m(bCR,qD);bCR.prototype.S=function(k){return E0(k)?HCc(this,k):I3(k)?gFG(this,k):Gg(k)?FZG(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var R3=[10];g.m(pq9,qD);pq9.prototype.S=function(k){return E0(k)?EFZ(this,k):I3(k)?IgG(this,k):Gg(k)?Gl9(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var v_=[10];g.m(sB9,qD);sB9.prototype.S=function(k){return E0(k)?jBv(this,k):I3(k)?nF6(this,k):Gg(k)?iCI(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var mQ6=[10];g.m(y$,Sv);y$.prototype.lR=function(k){var U=Sv.prototype.lR.call(this,k);U.musicTrack=new sB9(k,this.Z);U.musicPlaylist=new pq9(k,this.Z);U.musicAlbumRelease=new bCR(k,this.Z);return U};
y$.prototype.refreshAllStaleEntities=function(k,U){var D=this,b,N,H;return g.O(function(F){if(F.Z==1)return g.q(F,ZCr(D,k,U),2);if(F.Z!=3)return N=b=F.S,H=N.concat,g.q(F,Sv.prototype.refreshAllStaleEntities.call(D,k,U),3);b=H.call(N,F.S);return F.return(b)})};g.m(agc,g.d$);g.A=agc.prototype;g.A.create=function(){var k=this;g.Y(this,this.events);g.$8(this.ZN)?this.Z=new klZ(this.ZN,this.player):g.Cz(this.ZN)&&(this.Z=new y$(this.ZN,this.player));this.events.G(this.player,"onPlaybackStartExternal",function(){k.Bu()});
this.events.G(this.player,"videodatachange",function(){k.Bu()});
this.ZN.U("html5_offline_playback_position_sync")&&this.events.G(this.player,"presentingplayerstatechange",this.fB)};
g.A.jc=function(){return!1};
g.A.LG=function(k,U,D,b){var N=this;return g.O(function(H){return N.Z?H.return(Cu(N.Z,k,U,D,b)):H.return(Promise.reject())})};
g.A.deleteAll=function(){return this.Z.deleteAll()};
g.A.OL=function(k){return this.Z.OL(k)};
g.A.refreshAllStaleEntities=function(k){return this.Z.refreshAllStaleEntities(k)};
g.A.setUpPositionSyncInterval=function(k){this.Z.setUpPositionSyncInterval(k)};
g.A.Lf=function(k){this.Z.Lf(k)};
g.A.pN=function(k){return this.Z.pN(k)};
g.A.Bu=function(){var k=this,U;return g.O(function(D){U=k.player.getVideoData();return g.Rq(U)?wq9(U)&&k.S!==U.clientPlaybackNonce?g.q(D,WZF(k,U),0):D.Xt(0):D.return()})};
g.A.fB=function(k){var U=this,D,b,N,H,F,p,c;return g.O(function(E){if(E.Z==1)return D=U.player.getVideoData(),b=D.RO,g.a1(k,2)||g.a1(k,512)?g.q(E,kY(),2):E.return();if(E.Z!=3){N=E.S;if(!N)return ND("PES is undefined"),E.return();H=D.videoId;return g.q(E,vc(N,g.oY(H,"mainVideoEntity"),"mainVideoEntity"),3)}F=E.S;if(!F)return E.return();p=Math.floor(b).toString();c={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:p}};return g.q(E,U.LG([H],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
c),0)})};
g.A.isOrchestrationLeader=function(){return this.Z.isOrchestrationLeader()};
g.A.updateDownloadState=function(k,U){var D,b,N,H;return g.O(function(F){if(F.Z==1)return g.q(F,kY(),2);D=F.S;if(!D)return ND("PES is undefined"),F.return();b=g.sy(k);N=b.entityType;H=b.entityId;return g.q(F,Ku(H,N,D,U,!0),0)})};g.Xp("offline",agc);})(_yt_player);
